/*! For license information please see heap.js.LICENSE.txt */
!function(){var e={294:function(e,t,n){e=n.nmd(e),function(t){var n,r=null,i=4096,a=i,o=null,s=function e(t,n){return n||0===n||(n=16),e.generator(t=t||128,n)()};"exports"in e?e.exports=s:("undefined"!=typeof globalThis&&(t=globalThis),t.cryptohat=s),"subtle"in globalThis.crypto?n=globalThis.crypto:"webcrypto"in globalThis.crypto&&(n=globalThis.crypto.webcrypto),"function"==typeof(n||{}).getRandomValues?(i/=4,r=new Uint32Array(i),a=i,o=function(){a===i&&(a=0,n.getRandomValues(r));var e=r[a];return a+=1,e},s._engine="window.crypto.getRandomValues()"):(o=function(){return Math.floor(4294967296*Math.random())},s._engine="Math.random()");var u={};s.generator=function(e,t){var n=t?e.toString()+"."+t.toString():e.toString(),r=u[n];return r||(r=t?p(e,t):c(e),u[n]=r),r};var c=function(e){if(e>53)throw RangeError("JavaScript numbers can accurately represent at most 53 bits");if(e<32){var t=(1<<e)-1;return function(){return o()&t}}if(e>32){t=Math.pow(2,e-32)-1;return function(){return o()+4294967296*(o()&t)}}return o},l="0123456789abcdefghijklmnopqrstuvwxyz".split(""),f=function(e,t,n){for(var r=n.length,i=e.length,a=r-1;a>=0;--a){for(var o=0,s=0;s<i;++s)o=4294967296*o+e[s],e[s]=Math.floor(o/t),o%=t;n[a]=l[o]}return n.join("")};s._array32ToString=f;var d=null;d="function"==typeof String.prototype.repeat?function(e){return"0".repeat(e)}:function(e){for(var t="",n=0;n<e;++n)t+="0";return t},s._zeroRepeat=d;var v=function(e,t){var n=t-e.length;return n>0&&(e=d(n)+e),e};s._zeroPad=v;var h=function(e,t,n){for(var r="",i=0;i<e.length;++i)r+=v(e[i].toString(16),8);var a=r.length-n.length;return a>0&&(r=r.substring(a)),r};s._array32ToHexString=h;var p=function(e,t){if(t<2||t>36)throw RangeError("The base argument must be between 2 and 36");var n=function(e,t){return Math.ceil(e*Math.LN2/Math.log(t))}(e,t);if(e<=53){var r=s.generator(e,0);return function(){return v(r().toString(t),n)}}for(var i=[],a=0;a<n;++a)i[a]="0";var u=Math.floor((e+31)/32),c=[];for(a=0;a<u;++a)c[a]=0;var l=16===t?h:f;return e%32==0?function(){for(var e=0;e<u;++e)c[e]=o();return l(c,t,i)}:(mask=Math.pow(2,e%32)-1,function(){c[0]=o()&mask;for(var e=1;e<u;++e)c[e]=o();return l(c,t,i)})}}(this)},636:function(e,t,n){var r=n(91).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(e,n,s)}),a}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h={};function p(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(P([])));b&&b!==n&&a.call(b,u)&&(y=b);var _=m.prototype=p.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(i,o,s,u){var c=v(e[i],e,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function S(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return N()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=E(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=v(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function E(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=v(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:N}}function N(){return{value:void 0,done:!0}}return g.prototype=m,o(_,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,l,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},k(I.prototype),f(I.prototype,c,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new I(d(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(_),f(_,l,"Generator"),f(_,u,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=P,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},91:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},971:function(e,t,n){var r=n(91),i=n(636)();e.exports=i;try{regeneratorRuntime=i}catch(e){"object"===("undefined"==typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){"use strict";function e(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=t.apply(n,r);function s(t){e(o,i,a,s,u,"next",t)}function u(t){e(o,i,a,s,u,"throw",t)}s(void 0)}))}}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}function a(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n(971),s=n.n(o);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function l(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},v.apply(this,arguments)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function g(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function w(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var b=function(e){return e.NONE="none",e.ERROR="error",e.WARN="warn",e.INFO="info",e.DEBUG="debug",e.TRACE="trace",e}({}),_=function(e){return e.METADATA_USER="meta_user",e.METADATA_SESSION="meta_session",e.METADATA_PAGEVIEW="meta_pageview",e}({}),k=function(e){return e.CORE_TRACK="core_track",e.CORE_IDENTIFY_v3="core_identify_v3",e.CORE_ADD_USER_PROPERTIES="core_aup",e}({}),I=function(e){return e.COOKIES="cookies",e.LOCAL_STORAGE="localstorage",e}({}),S=l((function e(){u(this,e),a(this,"setItem",(function(e,t){sessionStorage.setItem(e,JSON.stringify(t))})),a(this,"getItem",(function(e){var t=sessionStorage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return t}})),a(this,"removeItem",(function(e){sessionStorage.removeItem(e)}))})),E="_hp5_logger",T=function(){function e(t){var n=this;u(this,e),a(this,"persistentStorage",new S),a(this,"getLogLevelFromStorage",(function(e){return n.persistentStorage.getItem("".concat(E,".").concat(e))})),a(this,"setLogLevel",(function(e,t){n.logLevel=e,t&&n.persistentStorage.setItem("".concat(E,".").concat(t),e)})),this.logLevel=null!=t?t:b.NONE}return l(e,[{key:"log",value:function(e,t,n){if(this.logLevel!==b.NONE){var i=Array.isArray(t)||"object"===r(t)&&null!==t?t:{context:t};console.log(e,t?i:"")}}},{key:"error",value:function(e,t){[b.TRACE,b.DEBUG,b.INFO,b.WARN,b.ERROR].includes(this.logLevel)&&this.log(e,t,b.ERROR)}},{key:"warn",value:function(e,t){[b.TRACE,b.DEBUG,b.INFO,b.WARN].includes(this.logLevel)&&this.log(e,t,b.DEBUG)}},{key:"info",value:function(e,t){[b.TRACE,b.DEBUG,b.INFO].includes(this.logLevel)&&this.log(e,t,b.DEBUG)}},{key:"debug",value:function(e,t){[b.TRACE,b.DEBUG].includes(this.logLevel)&&this.log(e,t,b.DEBUG)}},{key:"trace",value:function(e,t){this.logLevel===b.TRACE&&this.log(e,t,b.TRACE)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e(b.NONE)),e.instance}}]),e}(),O=T.getInstance();function A(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var N=n(294),R=function(){return String((0,N.generator)(53)())},C=604800,x=255,D=1024,j=340776e5,B=18e5,M=["data-heap-redact-text","data-cs-mask"],U=function(e){return"[object String]"===Object.prototype.toString.call(e)},L=function(e){return"[object Number]"===Object.prototype.toString.call(e)},F=function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},z=function(e){return"[object Object]"===Object.prototype.toString.call(e)},q=function(e){return"[object Array]"===Object.prototype.toString.call(e)},V=function(e){return"function"==typeof e},H=function(e,t){return(new n.g.TextEncoder).encode(e).length<=t},J=function(e){return/^\d+$/.test(e)},K=function(e){return void 0===e||""===e||null===e};function Q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G=function(e){var t=e.codePointAt(0);return t&&t>65535?2:1},Y=function(e){var t,n=0,r=Q(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=G(i)}}catch(e){r.e(e)}finally{r.f()}return n},W=function(e,t){var n,r="",i=0,a=Q(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=G(o);if(!(i+s<=t))break;r+=o,i+=s}}catch(e){a.e(e)}finally{a.f()}return r},X=function(e){var t={};return Object.entries(e).forEach((function(e){var n=P(e,2),r=n[0],i=n[1];if(H(r,512))if(K(i))O.warn("Property ".concat(r," was omitted because its value is blank."));else if(U(i)||L(i)||F(i)||q(i)){var a=i;if(U(a)&&!H(a,D))a=W(a,D),O.warn("Property ".concat(r," exceeded ").concat(D," UTF-16 code units and was truncated."));if(q(i)){var o=function(e){return e.every((function(e){return U(e)||L(e)||F(e)}))}(i);if(!o)return void O.warn("Property ".concat(r," was omitted: arrays must contain only strings, numbers, and booleans."));a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D,n="",r=0,i=0,a=0;a<e.length;a++){var o=e[a];if(!K(o)){var s=0===i?o.toString():"".concat("||").concat(o),u=Y(s);if(!(r+u<=t))break;n+=s,r+=u,i++}}return n}(i)}t[r]=a}else O.warn("Property ".concat(r," was omitted because its value is not a string, number, boolean, or array."));else O.warn("Property ".concat(r," was omitted because its name exceeds ").concat(512," UTF-16 code units."))})),O.trace("Sanitized properties",{before:e,after:t}),t},$=function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=P(e,2);t[0];return void 0!==t[1]})))},ee=/[a-zA-Z0-9._%+-]+(?:@|%40|%2540)[a-zA-Z0-9.%-_]+((?:\.|%2[eE])[a-zA-Z0-9-]+)+/g,te=/[a-zA-Z0-9+_-](?:@|%40|%2540)/,ne="([-A-Za-z0-9+/=_]|=[^=]|={3,})+",re=new RegExp("(ey".concat(ne,"\\.ey").concat(ne,"\\.").concat(ne,")"),"g"),ie=/[0-9]{4}/,ae=/(^|[^a-zA-Z0-9*.,-])([45*][0-9*]{3}([ -]?)[0-9*]{4}\3[0-9*]{4}\3[0-9*]{4})($|[^a-zA-Z0-9*.,-])/g,oe=function(){function e(){u(this,e)}return l(e,[{key:"anonymizePII",value:function(e){return"string"==typeof e&&(e=this.anonymizeEmail(e)),e}},{key:"anonymizeEmail",value:function(e){return te.test(e)?e.replace(ee,"CS_ANONYMIZED_EMAIL"):e}},{key:"anonymizeCreditCard",value:function(e){var t=this;return ie.test(e)?e.replace(ae,(function(e,n,r,i,a){if(-1===r.indexOf("*")){var o=i.length?r.split(i).join(""):r;if(!t.checkLuhn(o))return e}return"".concat(n).concat("CS_ANONYMIZED_PII").concat(a)})):e}},{key:"checkLuhn",value:function(e){for(var t=parseInt(e[e.length-1],10),n=0,r=e.length-2;r>=0;r--){var i=parseInt(e[r],10);r%2==0&&(i*=2),n+=Math.floor(i/10)+i%10}return 10-n%10===t}},{key:"anonymizeJwt",value:function(e){return e.replace(re,"CS_ANONYMIZED_JWT")}},{key:"anonymizeFields",value:function(e,t){var n=this;return t.forEach((function(t){e[t]=n.anonymizeEmail(e[t])})),e}}]),e}(),se=function(e){return e.HeapSideloadsCS="heap_sideloads_cs",e.CsSideloadsHeap="cs_sideloads_heap",e.HeapDrivesCS="heap_drives_cs",e.MappingOnly="mapping_only",e.CsCrossWritesHeap="cs_crosswrites_heap",e}({}),ue=[se.HeapSideloadsCS,se.HeapDrivesCS],ce=function(){if(le())return!1;var e=ri.getInstance().getCsHeapTagStatus();return e&&ue.includes(e)},le=function(){return!("236035469"!==Zl.getInstance().getEnvironmentId()||!window.location.hostname.includes("contentsquare.com"))},fe=[se.CsSideloadsHeap],de=[se.CsSideloadsHeap,se.HeapSideloadsCS],ve=function(){var e=ri.getInstance().getCsHeapTagStatus();return e&&de.includes(e)},he=function(){var e=ri.getInstance().getCsHeapTagStatus();return e&&fe.includes(e)},pe=function(e){return e.OnNextPageviewOnly="onNextPageviewOnly",e.UserSession="userSession",e}({}),ge=["id_token","access_token","refresh_token","auth_token"].map((function(e){return new RegExp(e+"(=|%3D).*?(?=%26|&|$)","gi")})),me=function(e){var t;(t=function(e){if(!e||!U(e))return e;var t=e;return ge.forEach((function(e){t=t.replace(e,(function(e){var t=-1===e.indexOf("=")?"%3D":"=";return e.split(t)[0]+t+"heap_redacted"}))})),t}(e),he())&&(t=(new oe).anonymizeJwt(t));return t},ye=l((function e(){var t=this;u(this,e),a(this,"setItem",(function(e,t,n){var r={value:t};if(null!=n&&n.expires){var i=new Date;r.expires=i.getTime()+ +(null==n?void 0:n.expires)}localStorage.setItem(e,JSON.stringify(r))})),a(this,"getItem",(function(e){var n=localStorage.getItem(e);if(!n)return null;var r=JSON.parse(n);return r.expires&&t.hasExpired(r.expires)?(t.removeItem(e),null):r.value})),a(this,"hasExpired",(function(e){return(new Date).getTime()>=e})),a(this,"removeItem",(function(e){localStorage.removeItem(e)}))})),we="props",be="id",_e="ses_props";function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Se=function(e){var t=Zl.getInstance().getEnvironmentId();return"".concat("_hp2_").concat(e,".").concat(t)},Ee=function(e){var t=new Ms,n=Se(e);return t.getItem(n)},Te=function(){var e=Ee(be);if(e){var t=null,n=e.userId,r=e.identity,i=e.sessionId,a={userId:n,identity:r};i!==Zl.getInstance().getSessionId()&&(t=function(e){var t,n,r,i,a,o,s,u,c,l,f,d,v=Ee(_e);if(!v)return null;var h=(new Date).getTime();return{sessionId:e,sessionProperties:{id:e,time:null!==(t=v.time)&&void 0!==t?t:h,referrer:null!==(n=v.referrer)&&void 0!==n?n:"",utm:{source:null!==(r=v.source)&&void 0!==r?r:"",medium:null!==(i=v.medium)&&void 0!==i?i:"",term:null!==(a=v.term)&&void 0!==a?a:"",content:null!==(o=v.content)&&void 0!==o?o:"",campaign:null!==(s=v.campaign)&&void 0!==s?s:""},initial_pageview_info:{time:null!==(u=v.time)&&void 0!==u?u:h,id:"",url:{domain:null!==(c=v.domain)&&void 0!==c?c:"",path:null!==(l=v.path)&&void 0!==l?l:"",query:null!==(f=v.query)&&void 0!==f?f:"",hash:null!==(d=v.hash)&&void 0!==d?d:""}}},lastEventTime:e?(new Date).getTime():void 0}}(i));var o,s=Ie(Ie({},a),t);O.debug("Migration -- updating metadata",{metadata:s}),o=s,Zl.getInstance().setMetadata(o)}},Oe=function(){var e;Te(),(e=Ee(we))&&(O.debug("Migration -- updating event properties",{properties:e}),window.heap.clearEventProperties(),window.heap.addEventProperties(e)),(new Ae).removeClassicCookiesIfNeeded()},Ae=function(){function e(){var t=this;u(this,e),a(this,"_storage",new Ms),a(this,"_idCookie",Se(be)),a(this,"_sessionPropertiesCookie",Se(_e)),a(this,"_eventPropertiesCookie",Se(we)),a(this,"shouldWriteToV4",(function(){var e;return null!==(e=ri.getInstance().getConfig().classicSDKCompatibility&&t.classicCookiesExist())&&void 0!==e&&e})),a(this,"classicCookiesExist",(function(){return t._storage.getItem(t._idCookie)||t._storage.getItem(t._sessionPropertiesCookie)||t._storage.getItem(t._eventPropertiesCookie)})),a(this,"updateIdCookie",(function(e){t._storage.setItem(t._idCookie,JSON.stringify(e),{expires:j}),O.trace("Updated v4 cookie id ".concat(t._idCookie),e)})),a(this,"updateSessionPropertiesCookie",(function(e){var n,r,i,a,o,s,u,c,l,f,d,v,h;if(e){var p={ts:e.time,r:e.referrer,us:null===(n=e.utm)||void 0===n?void 0:n.source,um:null===(r=e.utm)||void 0===r?void 0:r.medium,ut:null===(i=e.utm)||void 0===i?void 0:i.term,uc:null===(a=e.utm)||void 0===a?void 0:a.content,ua:null===(o=e.utm)||void 0===o?void 0:o.campaign,d:null===(s=e.initial_pageview_info)||void 0===s||null===(u=s.url)||void 0===u?void 0:u.domain,h:null===(c=e.initial_pageview_info)||void 0===c||null===(l=c.url)||void 0===l?void 0:l.path,q:null===(f=e.initial_pageview_info)||void 0===f||null===(d=f.url)||void 0===d?void 0:d.query,g:null===(v=e.initial_pageview_info)||void 0===v||null===(h=v.url)||void 0===h?void 0:h.hash},g=t._removeEmptyValues(p);t._storage.setItem(t._sessionPropertiesCookie,JSON.stringify(g),{expires:B}),O.trace("Updated v4 session properties ".concat(t._sessionPropertiesCookie),g)}else t._storage.removeItem(t._sessionPropertiesCookie)})),a(this,"updateMetadata",(function(e){var n={userId:e.userId,sessionId:e.sessionId,identity:e.identity},r=e.sessionProperties;t.updateIdCookie(n),t.updateSessionPropertiesCookie(r)})),a(this,"updateEventProperties",(function(e){t._storage.setItem(t._eventPropertiesCookie,JSON.stringify(e),{expires:j}),O.trace("Updated v4 event properties ".concat(t._eventPropertiesCookie),e)})),a(this,"updateSessionPropsExpiration",(function(e){var n=t._storage.getItem(t._sessionPropertiesCookie);n&&(t._storage.setItem(t._sessionPropertiesCookie,n,{expires:e}),O.trace("Updated v4 session properties ".concat(t._sessionPropertiesCookie," expiration"),e))})),a(this,"removeClassicCookiesIfNeeded",(function(){t.shouldWriteToV4()||(t._storage.removeItem(t._idCookie),t._storage.removeItem(t._sessionPropertiesCookie),t._storage.removeItem(t._eventPropertiesCookie))}))}return l(e,[{key:"_removeEmptyValues",value:function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=P(e,2);t[0];return""!==t[1]})))}}],[{key:"deleteV4Cookies",value:function(){var e=Se(be),t=Se(_e),n=Se(we),r=new Ms;r.removeItem(e),r.removeItem(t),r.removeItem(n)}}]),e}(),Pe=function(){function e(){u(this,e)}return l(e,[{key:"equals",value:function(e){return this.getType().runtime.util.equals(this.getType(),this,e)}},{key:"clone",value:function(){return this.getType().runtime.util.clone(this)}},{key:"fromBinary",value:function(e,t){var n=this.getType().runtime.bin,r=n.makeReadOptions(t);return n.readMessage(this,r.readerFactory(e),e.byteLength,r),this}},{key:"fromJson",value:function(e,t){var n=this.getType(),r=n.runtime.json,i=r.makeReadOptions(t);return r.readMessage(n,e,i,this),this}},{key:"fromJsonString",value:function(e,t){var n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}},{key:"toBinary",value:function(e){var t=this.getType().runtime.bin,n=t.makeWriteOptions(e),r=n.writerFactory();return t.writeMessage(this,r,n),r.finish()}},{key:"toJson",value:function(e){var t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}},{key:"toJsonString",value:function(e){var t,n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}},{key:"toJSON",value:function(){return this.toJson({emitDefaultValues:!0})}},{key:"getType",value:function(){return Object.getPrototypeOf(this).constructor}}]),e}();function Ne(e,t){if(!e)throw new Error(t)}function Re(e){if("number"!=typeof e)throw new Error("invalid int 32: "+r(e));if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function Ce(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+r(e));if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function xe(e){if("number"!=typeof e)throw new Error("invalid float 32: "+r(e));if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function De(){for(var e=0,t=0,n=0;n<28;n+=7){var r=this.buf[this.pos++];if(e|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}var i=this.buf[this.pos++];if(e|=(15&i)<<28,t=(112&i)>>4,!(128&i))return this.assertBounds(),[e,t];for(var a=3;a<=31;a+=7){var o=this.buf[this.pos++];if(t|=(127&o)<<a,!(128&o))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function je(e,t,n){for(var r=0;r<28;r+=7){var i=e>>>r,a=!(i>>>7==0&&0==t),o=255&(a?128|i:i);if(n.push(o),!a)return}var s=e>>>28&15|(7&t)<<4,u=!!(t>>3);if(n.push(255&(u?128|s:s)),u){for(var c=3;c<31;c+=7){var l=t>>>c,f=!(l>>>7==0),d=255&(f?128|l:l);if(n.push(d),!f)return}n.push(t>>>31&1)}}var Be=4294967296;function Me(e){var t="-"===e[0];t&&(e=e.slice(1));var n=1e6,r=0,i=0;function a(t,a){var o=Number(e.slice(t,a));i*=n,(r=r*n+o)>=Be&&(i+=r/Be|0,r%=Be)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?Fe(r,i):Le(r,i)}function Ue(e,t){var n=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t);if(e=n.lo,(t=n.hi)<=2097151)return String(Be*t+e);var r=16777215&(e>>>24|t<<8),i=t>>16&65535,a=(16777215&e)+6777216*r+6710656*i,o=r+8147497*i,s=2*i,u=1e7;return a>=u&&(o+=Math.floor(a/u),a%=u),o>=u&&(s+=Math.floor(o/u),o%=u),s.toString()+ze(o)+ze(a)}function Le(e,t){return{lo:0|e,hi:0|t}}function Fe(e,t){return t=~t,e?e=1+~e:t+=1,Le(e,t)}var ze=function(e){var t=String(e);return"0000000".slice(t.length)+t};function qe(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(var n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function Ve(){var e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<7,!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<14,!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<21,!(128&e))return this.assertBounds(),t;t|=(15&(e=this.buf[this.pos++]))<<28;for(var n=5;128&e&&n<10;n++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var He=function(){var e=new DataView(new ArrayBuffer(8));if(void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=("undefined"==typeof process?"undefined":r(process))||"object"!=r(process.env)||"1"!==process.env.BUF_BIGINT_DISABLE)){var t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse:function(e){var r="bigint"==typeof e?e:BigInt(e);if(r>n||r<t)throw new Error("int64 invalid: ".concat(e));return r},uParse:function(e){var t="bigint"==typeof e?e:BigInt(e);if(t>a||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc:function(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc:function(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:function(t,n){return e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)},uDec:function(t,n){return e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0)}}}var o=function(e){return Ne(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e))},s=function(e){return Ne(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e))};return{zero:"0",supported:!1,parse:function(e){return"string"!=typeof e&&(e=e.toString()),o(e),e},uParse:function(e){return"string"!=typeof e&&(e=e.toString()),s(e),e},enc:function(e){return"string"!=typeof e&&(e=e.toString()),o(e),Me(e)},uEnc:function(e){return"string"!=typeof e&&(e=e.toString()),s(e),Me(e)},dec:function(e,t){return function(e,t){var n=Le(e,t),r=2147483648&n.hi;r&&(n=Fe(n.lo,n.hi));var i=Ue(n.lo,n.hi);return r?"-"+i:i}(e,t)},uDec:function(e,t){return Ue(e,t)}}}();function Je(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ke(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Qe,Ze,Ge=Symbol("@bufbuild/protobuf/enum-type");function Ye(e){var t=e[Ge];return Ne(t,"missing enum type on enum object"),t}function We(e,t,n,r){e[Ge]=Xe(t,n.map((function(t){return{no:t.no,name:t.name,localName:e[t.no]}})),r)}function Xe(e,t,n){var r,i=Object.create(null),a=Object.create(null),o=[],s=Je(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=et(u);o.push(c),i[u.name]=c,a[u.no]=c}}catch(e){s.e(e)}finally{s.f()}return{typeName:e,values:o,findName:function(e){return i[e]},findNumber:function(e){return a[e]}}}function $e(e,t,n){var r,i={},a=Je(t);try{for(a.s();!(r=a.n()).done;){var o=et(r.value);i[o.localName]=o.no,i[o.no]=o.localName}}catch(e){a.e(e)}finally{a.f()}return We(i,e,t,n),i}function et(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(Qe||(Qe={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Ze||(Ze={}));var tt=function(){function e(t){u(this,e),this.stack=[],this.textEncoder=null!=t?t:new TextEncoder,this.chunks=[],this.buf=[]}return l(e,[{key:"finish",value:function(){this.chunks.push(new Uint8Array(this.buf));for(var e=0,t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;for(var n=new Uint8Array(e),r=0,i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}},{key:"fork",value:function(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}},{key:"join",value:function(){var e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}},{key:"tag",value:function(e,t){return this.uint32((e<<3|t)>>>0)}},{key:"raw",value:function(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}},{key:"uint32",value:function(e){for(Ce(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}},{key:"int32",value:function(e){return Re(e),qe(e,this.buf),this}},{key:"bool",value:function(e){return this.buf.push(e?1:0),this}},{key:"bytes",value:function(e){return this.uint32(e.byteLength),this.raw(e)}},{key:"string",value:function(e){var t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}},{key:"float",value:function(e){xe(e);var t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}},{key:"double",value:function(e){var t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}},{key:"fixed32",value:function(e){Ce(e);var t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}},{key:"sfixed32",value:function(e){Re(e);var t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}},{key:"sint32",value:function(e){return Re(e),qe(e=(e<<1^e>>31)>>>0,this.buf),this}},{key:"sfixed64",value:function(e){var t=new Uint8Array(8),n=new DataView(t.buffer),r=He.enc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}},{key:"fixed64",value:function(e){var t=new Uint8Array(8),n=new DataView(t.buffer),r=He.uEnc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}},{key:"int64",value:function(e){var t=He.enc(e);return je(t.lo,t.hi,this.buf),this}},{key:"sint64",value:function(e){var t=He.enc(e),n=t.hi>>31;return je(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}},{key:"uint64",value:function(e){var t=He.uEnc(e);return je(t.lo,t.hi,this.buf),this}}]),e}(),nt=function(){function e(t,n){u(this,e),this.varint64=De,this.uint32=Ve,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=null!=n?n:new TextDecoder}return l(e,[{key:"tag",value:function(){var e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}},{key:"skip",value:function(e){var t=this.pos;switch(e){case Ze.Varint:for(;128&this.buf[this.pos++];);break;case Ze.Bit64:this.pos+=4;case Ze.Bit32:this.pos+=4;break;case Ze.LengthDelimited:var n=this.uint32();this.pos+=n;break;case Ze.StartGroup:for(var r;(r=this.tag()[1])!==Ze.EndGroup;)this.skip(r);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}},{key:"assertBounds",value:function(){if(this.pos>this.len)throw new RangeError("premature EOF")}},{key:"int32",value:function(){return 0|this.uint32()}},{key:"sint32",value:function(){var e=this.uint32();return e>>>1^-(1&e)}},{key:"int64",value:function(){return He.dec.apply(He,w(this.varint64()))}},{key:"uint64",value:function(){return He.uDec.apply(He,w(this.varint64()))}},{key:"sint64",value:function(){var e=P(this.varint64(),2),t=e[0],n=e[1],r=-(1&t);return t=(t>>>1|(1&n)<<31)^r,n=n>>>1^r,He.dec(t,n)}},{key:"bool",value:function(){var e=P(this.varint64(),2),t=e[0],n=e[1];return 0!==t||0!==n}},{key:"fixed32",value:function(){return this.view.getUint32((this.pos+=4)-4,!0)}},{key:"sfixed32",value:function(){return this.view.getInt32((this.pos+=4)-4,!0)}},{key:"fixed64",value:function(){return He.uDec(this.sfixed32(),this.sfixed32())}},{key:"sfixed64",value:function(){return He.dec(this.sfixed32(),this.sfixed32())}},{key:"float",value:function(){return this.view.getFloat32((this.pos+=4)-4,!0)}},{key:"double",value:function(){return this.view.getFloat64((this.pos+=8)-8,!0)}},{key:"bytes",value:function(){var e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}},{key:"string",value:function(){return this.textDecoder.decode(this.bytes())}}]),e}();function rt(e,t){return t instanceof Pe||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}Qe.DOUBLE,Qe.FLOAT,Qe.INT64,Qe.UINT64,Qe.INT32,Qe.UINT32,Qe.BOOL,Qe.STRING,Qe.BYTES;function it(e,t,n){if(t===n)return!0;if(e==Qe.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==n[r])return!1;return!0}switch(e){case Qe.UINT64:case Qe.FIXED64:case Qe.INT64:case Qe.SFIXED64:case Qe.SINT64:return t==n}return!1}function at(e){switch(e){case Qe.BOOL:return!1;case Qe.UINT64:case Qe.FIXED64:case Qe.INT64:case Qe.SFIXED64:case Qe.SINT64:return He.zero;case Qe.DOUBLE:case Qe.FLOAT:return 0;case Qe.BYTES:return new Uint8Array(0);case Qe.STRING:return"";default:return 0}}function ot(e,t){var n=void 0===t,r=Ze.Varint,i=0===t;switch(e){case Qe.STRING:i=n||!t.length,r=Ze.LengthDelimited;break;case Qe.BOOL:i=!1===t;break;case Qe.DOUBLE:r=Ze.Bit64;break;case Qe.FLOAT:r=Ze.Bit32;break;case Qe.INT64:case Qe.UINT64:i=n||0==t;break;case Qe.FIXED64:i=n||0==t,r=Ze.Bit64;break;case Qe.BYTES:i=n||!t.byteLength,r=Ze.LengthDelimited;break;case Qe.FIXED32:case Qe.SFIXED32:r=Ze.Bit32;break;case Qe.SFIXED64:i=n||0==t,r=Ze.Bit64;break;case Qe.SINT64:i=n||0==t}return[r,Qe[e].toLowerCase(),n||i]}function st(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ut(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ct=Symbol("@bufbuild/protobuf/unknown-fields"),lt={readUnknownFields:!0,readerFactory:function(e){return new nt(e)}},ft={writeUnknownFields:!0,writerFactory:function(){return new tt}};function dt(e){return e?Object.assign(Object.assign({},lt),e):lt}function vt(e){return e?Object.assign(Object.assign({},ft),e):ft}function ht(e,t,n){for(var r,i,a=t.uint32(),o=t.pos+a;t.pos<o;){switch(P(t.tag(),1)[0]){case 1:r=pt(t,e.K);break;case 2:switch(e.V.kind){case"scalar":i=pt(t,e.V.T);break;case"enum":i=t.int32();break;case"message":i=e.V.T.fromBinary(t.bytes(),n)}}}if(void 0===r){var s=at(e.K);r=e.K==Qe.BOOL?s.toString():s}if("string"!=typeof r&&"number"!=typeof r&&(r=r.toString()),void 0===i)switch(e.V.kind){case"scalar":i=at(e.V.T);break;case"enum":i=0;break;case"message":i=new e.V.T}return[r,i]}function pt(e,t){return e[P(ot(t),2)[1]]()}function gt(e,t,n,r,i){e.tag(n.no,Ze.LengthDelimited),e.fork();var a=r;switch(n.K){case Qe.INT32:case Qe.FIXED32:case Qe.UINT32:case Qe.SFIXED32:case Qe.SINT32:a=Number.parseInt(r);break;case Qe.BOOL:Ne("true"==r||"false"==r),a="true"==r}switch(yt(e,n.K,1,a,!0),n.V.kind){case"scalar":yt(e,n.V.T,2,i,!0);break;case"enum":yt(e,Qe.INT32,2,i,!0);break;case"message":mt(e,t,n.V.T,2,i)}e.join()}function mt(e,t,n,r,i){if(void 0!==i){var a=rt(n,i);e.tag(r,Ze.LengthDelimited).bytes(a.toBinary(t))}}function yt(e,t,n,r,i){var a=P(ot(t,r),3),o=a[0],s=a[1];a[2]&&!i||e.tag(n,o)[s](r)}function wt(e,t,n,r){if(r.length){e.tag(n,Ze.LengthDelimited).fork();for(var i=P(ot(t),2)[1],a=0;a<r.length;a++)e[i](r[a]);e.join()}}function bt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}for(var kt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),It=[],St=0;St<kt.length;St++)It[kt[St].charCodeAt(0)]=St;It["-".charCodeAt(0)]=kt.indexOf("+"),It["_".charCodeAt(0)]=kt.indexOf("/");var Et=function(e){var t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);for(var n,r=new Uint8Array(t),i=0,a=0,o=0,s=0;s<e.length;s++){if(void 0===(n=It[e.charCodeAt(s)]))switch(e[s]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=n,a=1;break;case 1:r[i++]=o<<2|(48&n)>>4,o=n,a=2;break;case 2:r[i++]=(15&o)<<4|(60&n)>>2,o=n,a=3;break;case 3:r[i++]=(3&o)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return r.subarray(0,i)},Tt=function(e){for(var t,n="",r=0,i=0,a=0;a<e.length;a++)switch(t=e[a],r){case 0:n+=kt[t>>2],i=(3&t)<<4,r=1;break;case 1:n+=kt[i|t>>4],i=(15&t)<<2,r=2;break;case 2:n+=kt[i|t>>6],n+=kt[63&t],r=0}return r&&(n+=kt[i],n+="=",1==r&&(n+="=")),n};function Ot(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return At(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return At(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Pt={ignoreUnknownFields:!1},Nt={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Rt(e){return e?Object.assign(Object.assign({},Pt),e):Pt}function Ct(e){return e?Object.assign(Object.assign({},Nt),e):Nt}function xt(e){if(null===e)return"null";switch(r(e)){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return e.toString()}}function Dt(e,t){switch(e){case Qe.DOUBLE:case Qe.FLOAT:if(null===t)return 0;if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;var n=Number(t);if(Number.isNaN(n))break;if(!Number.isFinite(n))break;return e==Qe.FLOAT&&xe(n),n;case Qe.INT32:case Qe.FIXED32:case Qe.SFIXED32:case Qe.SINT32:case Qe.UINT32:if(null===t)return 0;var r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==Qe.UINT32?Ce(r):Re(r),r;case Qe.INT64:case Qe.SFIXED64:case Qe.SINT64:if(null===t)return He.zero;if("number"!=typeof t&&"string"!=typeof t)break;return He.parse(t);case Qe.FIXED64:case Qe.UINT64:if(null===t)return He.zero;if("number"!=typeof t&&"string"!=typeof t)break;return He.uParse(t);case Qe.BOOL:if(null===t)return!1;if("boolean"!=typeof t)break;return t;case Qe.STRING:if(null===t)return"";if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case Qe.BYTES:if(null===t||""===t)return new Uint8Array(0);if("string"!=typeof t)break;return Et(t)}throw new Error}function jt(e,t,n){if(null===t)return 0;switch(r(t)){case"number":if(Number.isInteger(t))return t;break;case"string":var i=e.findName(t);if(i||n)return null==i?void 0:i.no}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(xt(t)))}function Bt(e,t,n,r){var i;if(void 0===t)return t;if(0!==t||n){if(r)return t;if("google.protobuf.NullValue"==e.typeName)return null;var a=e.findNumber(t);return null!==(i=null==a?void 0:a.name)&&void 0!==i?i:t}}function Mt(e,t,n){if(void 0!==t)switch(e){case Qe.INT32:case Qe.SFIXED32:case Qe.SINT32:case Qe.FIXED32:case Qe.UINT32:return Ne("number"==typeof t),0!=t||n?t:void 0;case Qe.FLOAT:case Qe.DOUBLE:return Ne("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":0!==t||n?t:void 0;case Qe.STRING:return Ne("string"==typeof t),t.length>0||n?t:void 0;case Qe.BOOL:return Ne("boolean"==typeof t),t||n?t:void 0;case Qe.UINT64:case Qe.FIXED64:case Qe.INT64:case Qe.SFIXED64:case Qe.SINT64:return Ne("bigint"==typeof t||"string"==typeof t||"number"==typeof t),n||0!=t?t.toString(10):void 0;case Qe.BYTES:return Ne(t instanceof Uint8Array),n||t.byteLength>0?Tt(t):void 0}}function Ut(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ft(e,t){if(void 0===t)return t;if(t instanceof Pe)return t.clone();if(t instanceof Uint8Array){var n=new Uint8Array(t.byteLength);return n.set(t),n}return t}function zt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vt=function(){function e(t,n){u(this,e),this._fields=t,this._normalizer=n}return l(e,[{key:"findJsonName",value:function(e){if(!this.jsonNames){var t,n={},r=zt(this.list());try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i.jsonName]=n[i.name]=i}}catch(e){r.e(e)}finally{r.f()}this.jsonNames=n}return this.jsonNames[e]}},{key:"find",value:function(e){if(!this.numbers){var t,n={},r=zt(this.list());try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i.no]=i}}catch(e){r.e(e)}finally{r.f()}this.numbers=n}return this.numbers[e]}},{key:"list",value:function(){return this.all||(this.all=this._normalizer(this._fields)),this.all}},{key:"byNumber",value:function(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((function(e,t){return e.no-t.no}))),this.numbersAsc}},{key:"byMember",value:function(){if(!this.members){this.members=[];var e,t,n=this.members,r=zt(this.list());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.oneof?i.oneof!==e&&(e=i.oneof,n.push(e)):n.push(i)}}catch(e){r.e(e)}finally{r.f()}}return this.members}}]),e}();function Ht(e,t){var n=Qt(e);return t?n:Xt(Wt(n))}function Jt(e){return Ht(e,!1)}var Kt=Qt;function Qt(e){for(var t=!1,n=[],r=0;r<e.length;r++){var i=e.charAt(r);switch(i){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),t=!1;break;default:t&&(t=!1,i=i.toUpperCase()),n.push(i)}}return n.join("")}new Set(["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","yield","enum","implements","interface","let","package","private","protected","public","static","Object","bigint","number","boolean","string","object","globalThis","Uint8Array","Partial"]);var Zt=new Set(["constructor","toString","toJSON","valueOf"]),Gt=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Yt=function(e){return"".concat(e,"$")},Wt=function(e){return Gt.has(e)?Yt(e):e},Xt=function(e){return Zt.has(e)?Yt(e):e},$t=function(){function e(t){u(this,e),this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Jt(t)}return l(e,[{key:"addField",value:function(e){Ne(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}},{key:"findField",value:function(e){if(!this._lookup){this._lookup=Object.create(null);for(var t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}]),e}();function en(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return tn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var nn,rn,an,on,sn,un,cn=(nn="proto3",sn=function(e,t){return function(n,r,i){if("map"==n.kind){var a={};switch(n.V.kind){case"scalar":for(var o=0,s=Object.entries(r);o<s.length;o++){var u=P(s[o],2),c=u[0],l=u[1],f=t(n.V.T,l,!0);Ne(void 0!==f),a[c.toString()]=f}break;case"message":for(var d=0,v=Object.entries(r);d<v.length;d++){var h=P(v[d],2),p=h[0],g=h[1];a[p.toString()]=g.toJson(i)}break;case"enum":for(var m=n.V.T,y=0,w=Object.entries(r);y<w.length;y++){var b=P(w[y],2),_=b[0],k=b[1];Ne(void 0===k||"number"==typeof k);var I=e(m,k,!0,i.enumAsInteger);Ne(void 0!==I),a[_.toString()]=I}}return i.emitDefaultValues||Object.keys(a).length>0?a:void 0}if(n.repeated){var S=[];switch(n.kind){case"scalar":for(var E=0;E<r.length;E++)S.push(t(n.T,r[E],!0));break;case"enum":for(var T=0;T<r.length;T++)S.push(e(n.T,r[T],!0,i.enumAsInteger));break;case"message":for(var O=0;O<r.length;O++)S.push(rt(n.T,r[O]).toJson(i))}return i.emitDefaultValues||S.length>0?S:void 0}switch(n.kind){case"scalar":return t(n.T,r,!!n.oneof||n.opt||i.emitDefaultValues);case"enum":return e(n.T,r,!!n.oneof||n.opt||i.emitDefaultValues,i.enumAsInteger);case"message":return void 0!==r?rt(n.T,r).toJson(i):void 0}}},un=sn(Bt,Mt),rn={makeReadOptions:Rt,makeWriteOptions:Ct,readMessage:function(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=r(t))throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(this.debug(t)));i=null!=i?i:new e;for(var a={},o=0,s=Object.entries(t);o<s.length;o++){var u=P(s[o],2),c=u[0],l=u[1],f=e.fields.findJsonName(c);if(f){var d=f.localName,v=i;if(f.oneof){if(null===l&&"scalar"==f.kind)continue;var h=a[f.oneof.localName];if(h)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(h,'", "').concat(c,'"'));a[f.oneof.localName]=c,v=v[f.oneof.localName]={case:d},d="value"}if(f.repeated){if(null===l)continue;if(!Array.isArray(l))throw new Error("cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(l)));var p,g=v[d],m=Ot(l);try{for(m.s();!(p=m.n()).done;){var y=p.value;if(null===y)throw new Error("cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(y)));var w=void 0;switch(f.kind){case"message":w=f.T.fromJson(y,n);break;case"enum":if(void 0===(w=jt(f.T,y,n.ignoreUnknownFields)))continue;break;case"scalar":try{w=Dt(f.T,y)}catch(t){var b="cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(y));throw t instanceof Error&&t.message.length>0&&(b+=": ".concat(t.message)),new Error(b)}}g.push(w)}}catch(e){m.e(e)}finally{m.f()}}else if("map"==f.kind){if(null===l)continue;if(Array.isArray(l)||"object"!=r(l))throw new Error("cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(l)));for(var _=v[d],k=0,I=Object.entries(l);k<I.length;k++){var S=P(I[k],2),E=S[0],T=S[1];if(null===T)throw new Error("cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: map value null"));var O=void 0;switch(f.V.kind){case"message":O=f.V.T.fromJson(T,n);break;case"enum":if(void 0===(O=jt(f.V.T,T,n.ignoreUnknownFields)))continue;break;case"scalar":try{O=Dt(f.V.T,T)}catch(t){var A="cannot decode map value for field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(l));throw t instanceof Error&&t.message.length>0&&(A+=": ".concat(t.message)),new Error(A)}}try{_[Dt(f.K,f.K==Qe.BOOL?"true"==E||"false"!=E&&E:E).toString()]=O}catch(t){var N="cannot decode map key for field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(l));throw t instanceof Error&&t.message.length>0&&(N+=": ".concat(t.message)),new Error(N)}}}else switch(f.kind){case"message":var R=f.T;if(null===l&&"google.protobuf.Value"!=R.typeName){if(f.oneof)throw new Error("cannot decode field ".concat(e.typeName,".").concat(f.name,' from JSON: null is invalid for oneof field "').concat(c,'"'));continue}v[d]instanceof Pe?v[d].fromJson(l,n):(v[d]=R.fromJson(l,n),R.fieldWrapper&&!f.oneof&&(v[d]=R.fieldWrapper.unwrapField(v[d])));break;case"enum":var C=jt(f.T,l,n.ignoreUnknownFields);void 0!==C&&(v[d]=C);break;case"scalar":try{v[d]=Dt(f.T,l)}catch(t){var x="cannot decode field ".concat(e.typeName,".").concat(f.name," from JSON: ").concat(this.debug(l));throw t instanceof Error&&t.message.length>0&&(x+=": ".concat(t.message)),new Error(x)}}}else if(!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(c,'" is unknown'))}return i},writeMessage:function(e,t){var n,r=e.getType(),i={};try{var a,o=Ot(r.fields.byMember());try{for(o.s();!(a=o.n()).done;){var s=a.value,u=void 0;if("oneof"==s.kind){var c=e[s.localName];if(void 0===c.value)continue;if(!(n=s.findField(c.case)))throw"oneof case not found: "+c.case;u=un(n,c.value,t)}else u=un(n=s,e[n.localName],t);void 0!==u&&(i[t.useProtoFieldName?n.name:n.jsonName]=u)}}catch(e){o.e(e)}finally{o.f()}}catch(e){var l=n?"cannot encode field ".concat(r.typeName,".").concat(n.name," to JSON"):"cannot encode message ".concat(r.typeName," to JSON"),f=e instanceof Error?e.message:String(e);throw new Error(l+(f.length>0?": ".concat(f):""))}return i},readScalar:Dt,writeScalar:Mt,debug:xt},an=Object.assign(Object.assign({},{makeReadOptions:dt,makeWriteOptions:vt,listUnknownFields:function(e){var t;return null!==(t=e[ct])&&void 0!==t?t:[]},discardUnknownFields:function(e){delete e[ct]},writeUnknownFields:function(e,t){var n=e[ct];if(n){var r,i=st(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.tag(a.no,a.wireType).raw(a.data)}}catch(e){i.e(e)}finally{i.f()}}},onUnknownField:function(e,t,n,r){var i=e;Array.isArray(i[ct])||(i[ct]=[]),i[ct].push({no:t,wireType:n,data:r})},readMessage:function(e,t,n,r){for(var i=e.getType(),a=void 0===n?t.len:t.pos+n;t.pos<a;){var o=P(t.tag(),2),s=o[0],u=o[1],c=i.fields.find(s);if(c){var l=e,f=c.repeated,d=c.localName;switch(c.oneof&&((l=l[c.oneof.localName]).case!=d&&delete l.value,l.case=d,d="value"),c.kind){case"scalar":case"enum":var v="enum"==c.kind?Qe.INT32:c.T;if(f){var h=l[d];if(u==Ze.LengthDelimited&&v!=Qe.STRING&&v!=Qe.BYTES)for(var p=t.uint32()+t.pos;t.pos<p;)h.push(pt(t,v));else h.push(pt(t,v))}else l[d]=pt(t,v);break;case"message":var g=c.T;f?l[d].push(g.fromBinary(t.bytes(),r)):l[d]instanceof Pe?l[d].fromBinary(t.bytes(),r):(l[d]=g.fromBinary(t.bytes(),r),!g.fieldWrapper||c.oneof||c.repeated||(l[d]=g.fieldWrapper.unwrapField(l[d])));break;case"map":var m=P(ht(c,t,r),2),y=m[0],w=m[1];l[d][y]=w}}else{var b=t.skip(u);r.readUnknownFields&&this.onUnknownField(e,s,u,b)}}}}),{writeMessage:function(e,t,n){var r,i=bt(e.getType().fields.byNumber());try{for(i.s();!(r=i.n()).done;){var a=r.value,o=void 0,s=a.repeated,u=a.localName;if(a.oneof){var c=e[a.oneof.localName];if(c.case!==u)continue;o=c.value}else o=e[u];switch(a.kind){case"scalar":case"enum":var l="enum"==a.kind?Qe.INT32:a.T;if(s)if(a.packed)wt(t,l,a.no,o);else{var f,d=bt(o);try{for(d.s();!(f=d.n()).done;){var v=f.value;yt(t,l,a.no,v,!0)}}catch(e){d.e(e)}finally{d.f()}}else void 0!==o&&yt(t,l,a.no,o,!!a.oneof||a.opt);break;case"message":if(s){var h,p=bt(o);try{for(p.s();!(h=p.n()).done;){var g=h.value;mt(t,n,a.T,a.no,g)}}catch(e){p.e(e)}finally{p.f()}}else mt(t,n,a.T,a.no,o);break;case"map":for(var m=0,y=Object.entries(o);m<y.length;m++){var w=P(y[m],2);gt(t,n,a,w[0],w[1])}}}}catch(e){i.e(e)}finally{i.f()}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t}}),on=Object.assign(Object.assign({},{setEnumType:We,initPartial:function(e,t){if(void 0!==e){var n,r=Ut(t.getType().fields.byMember());try{var i=function(){var r=n.value,i=r.localName,a=t,o=e;if(void 0===o[i])return"continue";switch(r.kind){case"oneof":var s=o[i].case;if(void 0===s)return"continue";var u=r.findField(s),c=o[i].value;!u||"message"!=u.kind||c instanceof u.T||(c=new u.T(c)),a[i]={case:s,value:c};break;case"scalar":case"enum":a[i]=o[i];break;case"map":switch(r.V.kind){case"scalar":case"enum":Object.assign(a[i],o[i]);break;case"message":for(var l=r.V.T,f=0,d=Object.keys(o[i]);f<d.length;f++){var v=d[f],h=o[i][v];l.fieldWrapper||(h=new l(h)),a[i][v]=h}}break;case"message":var p=r.T;if(r.repeated)a[i]=o[i].map((function(e){return e instanceof p?e:new p(e)}));else if(void 0!==o[i]){var g=o[i];p.fieldWrapper?a[i]=g:a[i]=g instanceof p?g:new p(g)}}};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}},equals:function(e,t,n){return t===n||!(!t||!n)&&e.fields.byMember().every((function(e){var r=t[e.localName],i=n[e.localName];if(e.repeated){if(r.length!==i.length)return!1;switch(e.kind){case"message":return r.every((function(t,n){return e.T.equals(t,i[n])}));case"scalar":return r.every((function(t,n){return it(e.T,t,i[n])}));case"enum":return r.every((function(e,t){return it(Qe.INT32,e,i[t])}))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(r,i);case"enum":return it(Qe.INT32,r,i);case"scalar":return it(e.T,r,i);case"oneof":if(r.case!==i.case)return!1;var a=e.findField(r.case);if(void 0===a)return!0;switch(a.kind){case"message":return a.T.equals(r.value,i.value);case"enum":return it(Qe.INT32,r.value,i.value);case"scalar":return it(a.T,r.value,i.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":var o=Object.keys(r).concat(Object.keys(i));switch(e.V.kind){case"message":var s=e.V.T;return o.every((function(e){return s.equals(r[e],i[e])}));case"enum":return o.every((function(e){return it(Qe.INT32,r[e],i[e])}));case"scalar":var u=e.V.T;return o.every((function(e){return it(u,r[e],i[e])}))}}}))},clone:function(e){var t,n=e.getType(),r=new n,i=r,a=Ut(n.fields.byMember());try{var o=function(){var n,r=t.value,a=e[r.localName];if(r.repeated)n=a.map((function(e){return Ft(0,e)}));else if("map"==r.kind){n=i[r.localName];for(var o=0,s=Object.entries(a);o<s.length;o++){var u=P(s[o],2),c=u[0],l=u[1];n[c]=Ft(r.V,l)}}else if("oneof"==r.kind){var f=r.findField(a.case);n=f?{case:a.case,value:Ft(0,a.value)}:{case:void 0}}else n=Ft(0,a);i[r.localName]=n};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return r}}),{newFieldList:function(e){return new Vt(e,ln)},initFields:function(e){var t,n=en(e.getType().fields.byMember());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!r.opt){var i=r.localName,a=e;if(r.repeated)a[i]=[];else switch(r.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=at(r.T)}}}}catch(e){n.e(e)}finally{n.f()}}}),{syntax:nn,json:rn,bin:an,util:on,makeMessageType:function(e,t,n){return function(e,t,n,r){var i,o=null!==(i=null==r?void 0:r.localName)&&void 0!==i?i:t.substring(t.lastIndexOf(".")+1),s=a({},o,(function(t){e.util.initFields(this),e.util.initPartial(t,this)}))[o];return Object.setPrototypeOf(s.prototype,new Pe),Object.assign(s,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:function(e,t){return(new s).fromBinary(e,t)},fromJson:function(e,t){return(new s).fromJson(e,t)},fromJsonString:function(e,t){return(new s).fromJsonString(e,t)},equals:function(t,n){return e.util.equals(s,t,n)}}),s}(this,e,t,n)},makeEnum:$e,makeEnumType:Xe,getEnumType:Ye});function ln(e){var t,n,r,i,a,o=[],s=en("function"==typeof e?e():e);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u;if(c.localName=Ht(u.name,void 0!==u.oneof),c.jsonName=null!==(t=u.jsonName)&&void 0!==t?t:Kt(u.name),c.repeated=null!==(n=u.repeated)&&void 0!==n&&n,c.packed=null!==(r=u.packed)&&void 0!==r?r:"enum"==u.kind||"scalar"==u.kind&&u.T!=Qe.BYTES&&u.T!=Qe.STRING,void 0!==u.oneof){var l="string"==typeof u.oneof?u.oneof:u.oneof.name;i&&i.name==l||(i=new $t(l)),c.oneof=i,i.addField(c)}o.push(c)}}catch(e){s.e(e)}finally{s.f()}return o}function fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var dn=function(e){p(n,e);var t=fn(n);function n(e){var r;return u(this,n),(r=t.call(this)).seconds=He.zero,r.nanos=0,cn.util.initPartial(e,f(r)),r}return l(n,[{key:"fromJson",value:function(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(cn.json.debug(e)));var n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");var r=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=He.parse(r/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}},{key:"toJson",value:function(e){var t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");var n="Z";if(this.nanos>0){var r=(this.nanos+1e9).toString().substring(1);n="000000"===r.substring(3)?"."+r.substring(0,3)+"Z":"000"===r.substring(6)?"."+r.substring(0,6)+"Z":"."+r+"Z"}return new Date(t).toISOString().replace(".000Z",n)}},{key:"toDate",value:function(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}}],[{key:"now",value:function(){return n.fromDate(new Date)}},{key:"fromDate",value:function(e){var t=e.getTime();return new n({seconds:He.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}},{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}dn.runtime=cn,dn.typeName="google.protobuf.Timestamp",dn.fields=cn.util.newFieldList((function(){return[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]}));var hn=function(e){p(n,e);var t=vn(n);function n(e){var r;return u(this,n),r=t.call(this),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}hn.runtime=cn,hn.typeName="google.protobuf.Empty",hn.fields=cn.util.newFieldList((function(){return[]}));var gn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"string",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(gn,"runtime",cn),a(gn,"typeName","core_sdk.v1.Value"),a(gn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"string",kind:"scalar",T:9}]})));var mn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"name",""),a(f(r),"version",""),a(f(r),"platform",""),a(f(r),"properties",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(mn,"runtime",cn),a(mn,"typeName","core_sdk.v1.LibraryInfo"),a(mn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"platform",kind:"scalar",T:9},{no:4,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var yn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),r=t.call(this),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(yn,"runtime",cn),a(yn,"typeName","core_sdk.v1.ApplicationInfo"),a(yn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"identifier",kind:"scalar",T:9,opt:!0},{no:3,name:"version_string",kind:"scalar",T:9,opt:!0}]})));var wn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"platformVersion",""),a(f(r),"browserVersion",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(wn,"runtime",cn),a(wn,"typeName","core_sdk.v1.UserAgentClientHintsInfo"),a(wn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"platform_version",kind:"scalar",T:9},{no:2,name:"browser_version",kind:"scalar",T:9},{no:3,name:"model",kind:"scalar",T:9,opt:!0}]})));var bn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"model",""),a(f(r),"platform",""),a(f(r),"type",_n.UNKNOWN_UNSPECIFIED),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(bn,"runtime",cn),a(bn,"typeName","core_sdk.v1.DeviceInfo"),a(bn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"model",kind:"scalar",T:9},{no:2,name:"platform",kind:"scalar",T:9},{no:3,name:"user_agent",kind:"scalar",T:9,opt:!0},{no:4,name:"type",kind:"enum",T:cn.getEnumType(_n)},{no:5,name:"carrier",kind:"scalar",T:9,opt:!0},{no:6,name:"vendor_id",kind:"scalar",T:9,opt:!0},{no:7,name:"advertiser_id",kind:"scalar",T:9,opt:!0},{no:13,name:"uach",kind:"message",T:wn,opt:!0}]})));var _n=function(e){return e[e.UNKNOWN_UNSPECIFIED=0]="UNKNOWN_UNSPECIFIED",e[e.MOBILE=1]="MOBILE",e[e.TABLET=2]="TABLET",e[e.DESKTOP=3]="DESKTOP",e[e.TV=4]="TV",e[e.WATCH=5]="WATCH",e[e.AUTOMOTIVE=6]="AUTOMOTIVE",e}({});cn.util.setEnumType(_n,"core_sdk.v1.DeviceInfo.DeviceType",[{no:0,name:"DEVICE_TYPE_UNKNOWN_UNSPECIFIED"},{no:1,name:"DEVICE_TYPE_MOBILE"},{no:2,name:"DEVICE_TYPE_TABLET"},{no:3,name:"DEVICE_TYPE_DESKTOP"},{no:4,name:"DEVICE_TYPE_TV"},{no:5,name:"DEVICE_TYPE_WATCH"},{no:6,name:"DEVICE_TYPE_AUTOMOTIVE"}]);var kn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"id",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(kn,"runtime",cn),a(kn,"typeName","core_sdk.v1.SessionInfo"),a(kn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"time",kind:"message",T:dn},{no:3,name:"referrer",kind:"scalar",T:9,opt:!0},{no:4,name:"search_keyword",kind:"scalar",T:9,opt:!0},{no:5,name:"utm",kind:"message",T:En,opt:!0},{no:6,name:"initial_pageview_info",kind:"message",T:In,opt:!0}]})));var In=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"id",""),a(f(r),"sourceProperties",{}),a(f(r),"properties",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(In,"runtime",cn),a(In,"typeName","core_sdk.v1.PageviewInfo"),a(In,"fields",cn.util.newFieldList((function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"time",kind:"message",T:dn},{no:3,name:"component_or_class_name",kind:"scalar",T:9,opt:!0},{no:4,name:"title",kind:"scalar",T:9,opt:!0},{no:5,name:"url",kind:"message",T:Sn,opt:!0},{no:6,name:"source_properties",kind:"map",K:9,V:{kind:"message",T:gn}},{no:7,name:"previous_page",kind:"scalar",T:9,opt:!0},{no:8,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var Sn=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"domain",""),a(f(r),"path",""),a(f(r),"query",""),a(f(r),"hash",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Sn,"runtime",cn),a(Sn,"typeName","core_sdk.v1.PageviewInfo.Url"),a(Sn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"domain",kind:"scalar",T:9},{no:2,name:"path",kind:"scalar",T:9},{no:3,name:"query",kind:"scalar",T:9},{no:4,name:"hash",kind:"scalar",T:9}]})));var En=function(e){p(n,e);var t=pn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"source",""),a(f(r),"medium",""),a(f(r),"term",""),a(f(r),"content",""),a(f(r),"campaign",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}a(En,"runtime",cn),a(En,"typeName","core_sdk.v1.Utm"),a(En,"fields",cn.util.newFieldList((function(){return[{no:1,name:"source",kind:"scalar",T:9},{no:2,name:"medium",kind:"scalar",T:9},{no:3,name:"term",kind:"scalar",T:9},{no:4,name:"content",kind:"scalar",T:9},{no:5,name:"campaign",kind:"scalar",T:9}]})));var On=function(e){p(n,e);var t=Tn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"envId",""),a(f(r),"userId",""),a(f(r),"properties",{}),a(f(r),"sessionReplay",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(On,"runtime",cn),a(On,"typeName","core_sdk.v1.UserProperties"),a(On,"fields",cn.util.newFieldList((function(){return[{no:1,name:"env_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}},{no:4,name:"initial_device",kind:"message",T:bn},{no:5,name:"initial_application",kind:"message",T:yn},{no:6,name:"library",kind:"message",T:mn},{no:7,name:"initial_session_info",kind:"message",T:kn},{no:8,name:"session_replay",kind:"scalar",T:9}]})));var An=function(e){p(n,e);var t=Tn(n);function n(e){var r;return u(this,n),r=t.call(this),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(An,"runtime",cn),a(An,"typeName","core_sdk.v1.PostMobileAddUserPropertiesRequest"),a(An,"fields",cn.util.newFieldList((function(){return[{no:1,name:"user_properties",kind:"message",T:On}]})));var Pn=function(e){p(n,e);var t=Tn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"status",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function Nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}a(Pn,"runtime",cn),a(Pn,"typeName","core_sdk.v1.PostMobileAddUserPropertiesResponse"),a(Pn,"fields",cn.util.newFieldList((function(){return[{no:2,name:"status",kind:"scalar",T:9}]})));var Rn=function(e){p(n,e);var t=Nn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"envId",""),a(f(r),"userId",""),a(f(r),"identity",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}a(Rn,"runtime",cn),a(Rn,"typeName","core_sdk.v1.UserIdentification"),a(Rn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"env_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"identity",kind:"scalar",T:9},{no:4,name:"time",kind:"message",T:dn},{no:5,name:"library",kind:"message",T:mn}]})));var xn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"csPid",""),a(f(r),"csPvid",""),a(f(r),"csSn",""),a(f(r),"csTs",""),a(f(r),"csUu",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(xn,"runtime",cn),a(xn,"typeName","core_sdk.v1.CSProperties"),a(xn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"cs_pid",kind:"scalar",T:9},{no:2,name:"cs_pvid",kind:"scalar",T:9},{no:3,name:"cs_sn",kind:"scalar",T:9},{no:4,name:"cs_ts",kind:"scalar",T:9},{no:5,name:"cs_uu",kind:"scalar",T:9}]})));var Dn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"platform",jn.UNSPECIFIED),a(f(r),"urlMetadata",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Dn,"runtime",cn),a(Dn,"typeName","core_sdk.v1.SessionReplayInfo"),a(Dn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"platform",kind:"enum",T:cn.getEnumType(jn)},{no:2,name:"time",kind:"message",T:dn},{no:3,name:"url_metadata",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var jn=function(e){return e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.AURYC=1]="AURYC",e[e.LOGROCKET=2]="LOGROCKET",e}({});cn.util.setEnumType(jn,"core_sdk.v1.SessionReplayInfo.SessionReplayPlatform",[{no:0,name:"SESSION_REPLAY_PLATFORM_UNSPECIFIED"},{no:1,name:"SESSION_REPLAY_PLATFORM_AURYC"},{no:2,name:"SESSION_REPLAY_PLATFORM_LOGROCKET"}]);var Bn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"id",""),a(f(r),"identity",""),a(f(r),"properties",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Bn,"runtime",cn),a(Bn,"typeName","core_sdk.v1.User"),a(Bn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"initial_referrer",kind:"scalar",T:9,opt:!0},{no:4,name:"initial_search_keyword",kind:"scalar",T:9,opt:!0},{no:5,name:"initial_utm",kind:"message",T:En,opt:!0},{no:6,name:"initial_pageview_info",kind:"message",T:In},{no:7,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var Mn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"attributes",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Mn,"runtime",cn),a(Mn,"typeName","core_sdk.v1.ElementNode"),a(Mn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"node_name",kind:"scalar",T:9,opt:!0},{no:2,name:"node_html_class",kind:"scalar",T:9,opt:!0},{no:3,name:"node_id",kind:"scalar",T:9,opt:!0},{no:4,name:"node_text",kind:"scalar",T:9,opt:!0},{no:5,name:"href",kind:"scalar",T:9,opt:!0},{no:6,name:"accessibility_label",kind:"scalar",T:9,opt:!0},{no:7,name:"referencing_property_name",kind:"scalar",T:9,opt:!0},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var Un=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"kind",{case:void 0}),a(f(r),"nodes",[]),a(f(r),"sourceProperties",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Un,"runtime",cn),a(Un,"typeName","core_sdk.v1.Interaction"),a(Un,"fields",cn.util.newFieldList((function(){return[{no:1,name:"callback_name",kind:"scalar",T:9,opt:!0},{no:2,name:"custom",kind:"scalar",T:9,oneof:"kind"},{no:3,name:"builtin",kind:"enum",T:cn.getEnumType(Ln),oneof:"kind"},{no:4,name:"hierarchy",kind:"scalar",T:9,opt:!0},{no:5,name:"nodes",kind:"message",T:Mn,repeated:!0},{no:6,name:"source_properties",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var Ln=function(e){return e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.CLICK=1]="CLICK",e[e.TOUCH=2]="TOUCH",e[e.CHANGE=3]="CHANGE",e[e.SUBMIT=4]="SUBMIT",e}({});cn.util.setEnumType(Ln,"core_sdk.v1.Interaction.BuiltinKind",[{no:0,name:"BUILTIN_KIND_UNSPECIFIED"},{no:1,name:"BUILTIN_KIND_CLICK"},{no:2,name:"BUILTIN_KIND_TOUCH"},{no:3,name:"BUILTIN_KIND_CHANGE"},{no:4,name:"BUILTIN_KIND_SUBMIT"}]);var Fn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),r=t.call(this),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Fn,"runtime",cn),a(Fn,"typeName","core_sdk.v1.VersionChange"),a(Fn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"previous_version",kind:"message",T:yn,opt:!0},{no:2,name:"current_version",kind:"message",T:yn}]})));var zn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"invisibleToVisible",[]),a(f(r),"visibleToInvisible",[]),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(zn,"runtime",cn),a(zn,"typeName","core_sdk.v1.ComponentTransition"),a(zn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"invisible_to_visible",kind:"message",T:Mn,repeated:!0},{no:2,name:"visible_to_invisible",kind:"message",T:Mn,repeated:!0}]})));var qn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"kind",{case:void 0}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(qn,"runtime",cn),a(qn,"typeName","core_sdk.v1.Event"),a(qn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"custom",kind:"message",T:Hn,oneof:"kind"},{no:2,name:"interaction",kind:"message",T:Un,oneof:"kind"},{no:3,name:"version_change",kind:"message",T:Fn,oneof:"kind"},{no:4,name:"component_transition",kind:"message",T:zn,oneof:"kind"},{no:20,name:"app_visibility_state",kind:"enum",T:cn.getEnumType(Vn),opt:!0}]})));var Vn=function(e){return e[e.UNKNOWN_UNSPECIFIED=0]="UNKNOWN_UNSPECIFIED",e[e.BACKGROUNDED=1]="BACKGROUNDED",e[e.FOREGROUNDED=2]="FOREGROUNDED",e}({});cn.util.setEnumType(Vn,"core_sdk.v1.Event.AppVisibility",[{no:0,name:"APP_VISIBILITY_UNKNOWN_UNSPECIFIED"},{no:1,name:"APP_VISIBILITY_BACKGROUNDED"},{no:2,name:"APP_VISIBILITY_FOREGROUNDED"}]);var Hn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"name",""),a(f(r),"properties",{}),a(f(r),"sourceProperties",{}),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Hn,"runtime",cn),a(Hn,"typeName","core_sdk.v1.Event.Custom"),a(Hn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}},{no:3,name:"source_properties",kind:"map",K:9,V:{kind:"message",T:gn}}]})));var Jn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"id",""),a(f(r),"envId",""),a(f(r),"userId",""),a(f(r),"identity",""),a(f(r),"properties",{}),a(f(r),"kind",{case:void 0}),a(f(r),"activeContexts",[]),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Jn,"runtime",cn),a(Jn,"typeName","core_sdk.v1.Message"),a(Jn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"env_id",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:19,name:"identity",kind:"scalar",T:9},{no:4,name:"time",kind:"message",T:dn},{no:5,name:"base_library",kind:"message",T:mn},{no:6,name:"source_library",kind:"message",T:mn,opt:!0},{no:7,name:"application",kind:"message",T:yn,opt:!0},{no:8,name:"device",kind:"message",T:bn},{no:9,name:"session_info",kind:"message",T:kn},{no:10,name:"pageview_info",kind:"message",T:In,opt:!0},{no:11,name:"properties",kind:"map",K:9,V:{kind:"message",T:gn}},{no:12,name:"session",kind:"message",T:hn,oneof:"kind"},{no:13,name:"pageview",kind:"message",T:hn,oneof:"kind"},{no:14,name:"event",kind:"message",T:qn,oneof:"kind"},{no:15,name:"user",kind:"message",T:Bn,oneof:"kind"},{no:16,name:"session_replay_info",kind:"message",T:Dn,opt:!0},{no:17,name:"session_replay",kind:"scalar",T:9,opt:!0},{no:18,name:"active_contexts",kind:"message",T:Mn,repeated:!0},{no:20,name:"cs_properties",kind:"message",T:xn}]})));var Kn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"events",[]),a(f(r),"ipOverride",""),a(f(r),"timeOverride",!1),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Kn,"runtime",cn),a(Kn,"typeName","core_sdk.v1.MessageBatch"),a(Kn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"events",kind:"message",T:Jn,repeated:!0},{no:2,name:"ip_override",kind:"scalar",T:9},{no:3,name:"time_override",kind:"scalar",T:8}]})));var Qn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),r=t.call(this),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);a(Qn,"runtime",cn),a(Qn,"typeName","core_sdk.v1.PostMobileTrackRequest"),a(Qn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"message_batch",kind:"message",T:Kn}]})));var Zn=function(e){p(n,e);var t=Cn(n);function n(e){var r;return u(this,n),a(f(r=t.call(this)),"status",""),cn.util.initPartial(e,f(r)),r}return l(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return cn.util.equals(n,e,t)}}]),n}(Pe);function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}a(Zn,"runtime",cn),a(Zn,"typeName","core_sdk.v1.PostMobileTrackResponse"),a(Zn,"fields",cn.util.newFieldList((function(){return[{no:1,name:"status",kind:"scalar",T:9}]})));var Wn=function(e){return e[e.Track=0]="Track",e[e.Identify=1]="Identify",e[e.AUP=2]="AUP",e[e.Telemetry=3]="Telemetry",e}({}),Xn=function(e){return e[e.Event=0]="Event",e[e.Meta=1]="Meta",e}({}),$n=function(e){try{switch(e.type){case k.CORE_TRACK:return dr(e);case _.METADATA_SESSION:case _.METADATA_PAGEVIEW:return cr(e);case _.METADATA_USER:case k.CORE_ADD_USER_PROPERTIES:return sr(e);case k.CORE_IDENTIFY_v3:return ur(e);default:return O.error("Schematizers -- Found invalid message type"),null}}catch(t){return O.error("Schematizers -- Failed to verify message",e),null}},er=function(e){if(void 0!==e){var t=Math.floor(e/1e3),n=1e6*(e-1e3*t);return new dn({seconds:He.parse(t),nanos:n})}},tr=function(e){if(null!=e)return Object.entries(e).reduce((function(e,t){var n=P(t,2),r=n[0],i=n[1];return e[r]=new gn({string:null==i?void 0:i.toString()}),e}),{})},nr=function(e){return new mn({name:null==e?void 0:e.name,version:null==e?void 0:e.version,platform:null==e?void 0:e.platform,properties:tr(null==e?void 0:e.properties)})},rr=function(e){var t,n,r;return new bn({userAgent:null==e?void 0:e.user_agent,uach:new wn({browserVersion:null==e||null===(t=e.uach)||void 0===t?void 0:t.browser_version,platformVersion:null==e||null===(n=e.uach)||void 0===n?void 0:n.platform_version,model:null==e||null===(r=e.uach)||void 0===r?void 0:r.model})})},ir=function(e){return new In(Yn(Yn({},e),{},{id:null==e?void 0:e.id,url:(t=null==e?void 0:e.url,t?new Sn(t):void 0),previousPage:null==e?void 0:e.previous_page,time:er(null==e?void 0:e.time),properties:tr(null==e?void 0:e.properties),sourceProperties:tr(null==e?void 0:e.source_properties)}));var t},ar=function(e){return new kn(Yn(Yn({},e),{},{utm:new En(Yn({},null==e?void 0:e.utm)),time:er(null==e?void 0:e.time),initialPageviewInfo:ir(null==e?void 0:e.initial_pageview_info)}))},or=function(e){return new xn({csPid:null==e?void 0:e.cs_pid,csPvid:null==e?void 0:e.cs_pvid,csSn:null==e?void 0:e.cs_sn,csTs:null==e?void 0:e.cs_ts,csUu:null==e?void 0:e.cs_uu})},sr=function(e){var t,n=e.type,r=e.data,i=null!==(t=r.time)&&void 0!==t?t:Date.now();return{payload:new On(Yn({envId:r.env_id,userId:r.user_id,initialDevice:rr(r.device)},n===_.METADATA_USER?{library:nr(r.base_library),initialApplication:new yn(r.application),initialSessionInfo:ar(r.user.initial_session_info),sessionReplay:r.session_replay}:{library:nr(r.library),properties:tr(r.properties)})),type:Wn.AUP,timestamp:i}},ur=function(e){var t,n=e.data,r=null!==(t=n.time)&&void 0!==t?t:Date.now();return{payload:new Rn({envId:n.env_id,userId:n.user_id,identity:n.identity,library:nr(n.library),time:er(n.time)}),type:Wn.Identify,timestamp:r}},cr=function(e){var t,n=e.data,r=null!==(t=n.time)&&void 0!==t?t:Date.now(),i={id:n.id,envId:Zl.getInstance().getEnvironmentId(),userId:n.user_id,identity:n.identity,time:er(n.time),baseLibrary:nr(n.base_library),sessionInfo:ar(n.session_info),application:new yn(Yn({},n.application)),device:rr(n.device),sessionReplay:n.session_replay,csProperties:or(n.cs_properties)};switch(e.type){case _.METADATA_PAGEVIEW:i.pageviewInfo=ir(n.pageview_info),i.kind={case:"pageview",value:new hn},i.properties=tr(n.properties);break;case _.METADATA_SESSION:i.kind={case:"session",value:new hn}}return{payload:new Jn(i),type:Wn.Track,kind:Xn.Meta,timestamp:r}},lr={BUILTIN_KIND_UNSPECIFIED:Ln.UNSPECIFIED,BUILTIN_KIND_CLICK:Ln.CLICK,BUILTIN_KIND_TOUCH:Ln.TOUCH,BUILTIN_KIND_CHANGE:Ln.CHANGE,BUILTIN_KIND_SUBMIT:Ln.SUBMIT},fr=function(e){return"interaction"in e?function(e){return new qn({kind:{case:"interaction",value:new Un({kind:{case:"builtin",value:lr[e.interaction.kind]},hierarchy:e.interaction.hierarchy,nodes:(t=e.interaction.nodes,t.map((function(e){var t=function(e){return e.reduce((function(e,t){var n=t.name,r=t.value;return e[n]=r,e}),{})}(e.attributes);return{nodeName:e.tagName||"",nodeHtmlClass:e.classes?e.classes.join(" "):"",nodeId:e.id||"",nodeText:e.targetText||"",href:e.href||"",attributes:tr(t)}}))),sourceProperties:tr(e.interaction.source_properties)})}});var t}(e):function(e){return new qn({kind:{case:"custom",value:new Hn({name:e.custom.name,properties:tr(e.custom.properties),sourceProperties:tr(e.custom.source_properties)})}})}(e)},dr=function(e){var t,n=e.data,r=null!==(t=n.time)&&void 0!==t?t:Date.now();return{payload:new Jn(Yn(Yn(Yn({id:n.id,envId:Zl.getInstance().getEnvironmentId(),userId:n.user_id,identity:n.identity,time:er(n.time),baseLibrary:nr(n.base_library)},n.source_library&&{sourceLibrary:nr(n.source_library)}),{},{application:Yn({},n.application),device:rr(n.device),sessionInfo:ar(n.session_info),pageviewInfo:ir(n.pageview_info),sessionReplayInfo:n.session_replay_info,sessionReplay:n.session_replay,properties:tr(n.properties)},n.event&&{kind:{case:"event",value:fr(n.event)}}),{},{csProperties:or(n.cs_properties)})),type:Wn.Track,kind:Xn.Event,timestamp:r}},vr=function(e,t){return e<+new Date-1e3*t},hr=function(e){return null!==e&&(!(!e.payload.envId||!e.payload.userId)&&(e.type!==Wn.Track||!!(t=e.payload.sessionInfo)&&!!t.id&&!!t.time));var t},pr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e6,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e7,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ye;u(this,e),this.maxLocalStorageBufferSize=t,this.maxOverflowBufferSize=n,this.storage=r;var i=Zl.getInstance().getEnvironmentId();this.bufferKey="_hp5_network_buffer.".concat(i),this.overflowBuffer=[],this.storage.getItem(this.bufferKey)||(O.trace("MessageBatcherBuffer -- there are no queued items in the buffer, creating empty buffer"),this.storage.setItem(this.bufferKey,JSON.stringify([])))}return l(e,[{key:"addMessages",value:function(e){O.trace("MessageBatcherBuffer -- Adding events to buffer",e),this.appendBuffer(e)}},{key:"peakBuffer",value:function(e){return this.getFullBuffer().slice(0,e)}},{key:"commitPop",value:function(e){var t=this.getPrimaryBuffer().primaryBuffer,n=Math.min(this.overflowBuffer.length,e);this.overflowBuffer.splice(0,n);var r=e-n;t.splice(0,r),this.storage.setItem(this.bufferKey,JSON.stringify(t))}},{key:"getBufferSize",value:function(){var e=this.getPrimaryBuffer().primaryBuffer;return this.overflowBuffer.length+e.length}},{key:"getFullBuffer",value:function(){var e,t=JSON.parse(null!==(e=this.storage.getItem(this.bufferKey))&&void 0!==e?e:"[]"),n=[],r=t.map((function(e){try{if(vr(e.timestamp,C))throw new Error("Message is older than 7 days, discarding");switch(e.type){case Wn.Track:return{type:Wn.Track,payload:Jn.fromJson(e.payload),kind:e.kind,timestamp:e.timestamp};case Wn.AUP:return{type:Wn.AUP,payload:On.fromJson(e.payload),timestamp:e.timestamp};case Wn.Identify:return{type:Wn.Identify,payload:Rn.fromJson(e.payload),timestamp:e.timestamp};default:throw new Error("Unsupported message type")}}catch(t){return O.warn("MessageBatcherBuffer -- invalid message for network flush, removing from buffer",{message:e,error:t.message}),n.push(e),null}})).filter((function(e){return null!==e})),i=t.filter((function(e){return!n.includes(e)}));if(i.length!==t.length){O.warn("MessageBatcherBuffer -- failed to parse messages, removing from primary buffer");var a=JSON.stringify(i);this.storage.setItem(this.bufferKey,a)}return r.concat(this.overflowBuffer)}},{key:"getPrimaryBuffer",value:function(){var e,t,n=(null!==(e=this.storage.getItem(this.bufferKey))&&void 0!==e?e:"").length;return{primaryBuffer:JSON.parse(null!==(t=this.storage.getItem(this.bufferKey))&&void 0!==t?t:"[]"),primaryBufferSizeInBytes:n}}},{key:"appendOverflowBuffer",value:function(e,t){var n;t+JSON.stringify(this.overflowBuffer).length>this.maxOverflowBufferSize?O.warn("MessageBatcherBuffer -- overflow buffer is too large, dropping messages",e):(n=this.overflowBuffer).push.apply(n,w(e))}},{key:"appendBuffer",value:function(e){var t=this.getPrimaryBuffer(),n=t.primaryBuffer,r=t.primaryBufferSizeInBytes,i=JSON.stringify(e);if(r+i.length>this.maxLocalStorageBufferSize)O.trace("MessageBatcherBuffer -- using overflow buffer",e),this.appendOverflowBuffer(e,i.length);else{n.push.apply(n,w(e));var a=JSON.stringify(n);O.trace("MessageBatcherBuffer -- Saving primary buffer",a);try{this.storage.setItem(this.bufferKey,a)}catch(t){O.error("MessageBatcherBuffer -- Failed to save to primary buffer, using overflow buffer",{e:t}),this.appendOverflowBuffer(e,i.length)}}}}],[{key:"deleteQueue",value:function(){var e=Zl.getInstance();(new ye).removeItem("_hp5_network_buffer.".concat(e.getEnvironmentId()))}}]),e}(),gr=pr,mr=function(e){var t=e.map((function(e){return new Jn(e.payload)}));return new Kn({events:t}).toBinary()},yr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e6,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ye;u(this,e),this.maxLocalStorageBufferSize=t,this.storage=n;var r=Zl.getInstance().getEnvironmentId();this.bufferKey="_hp5_retry_buffer.".concat(r),this.storage.getItem(this.bufferKey)||this.storage.setItem(this.bufferKey,JSON.stringify([]))}return l(e,[{key:"addMessages",value:function(e){var t=e.filter((function(e){return hr(e)}));O.debug("RetryMessageBuffer -- Adding events to buffer after failed retries",{before:e,after:t}),this.appendBuffer(t)}},{key:"commitPop",value:function(e){var t=this.getPrimaryBuffer().primaryBuffer,n=t.splice(0,e);O.trace("RetryMessageBuffer -- removing messages from the buffer",{removedMessages:n}),this.storage.setItem(this.bufferKey,JSON.stringify(t))}},{key:"peakBuffer",value:function(e){var t=this.getPrimaryBuffer().primaryBuffer,n=t.splice(0,e),r=[],i=n.map((function(e){try{switch(e.type){case Wn.Track:return{type:Wn.Track,payload:Jn.fromJson(e.payload),kind:e.kind,timestamp:e.timestamp};case Wn.AUP:return{type:Wn.AUP,payload:On.fromJson(e.payload),timestamp:e.timestamp};case Wn.Identify:return{type:Wn.Identify,payload:Rn.fromJson(e.payload),timestamp:e.timestamp};default:throw new Error("Unsupported message type")}}catch(t){return O.error("RetryMessageBatcher -- Failed to parse the following message for network flush, dropping the message",{message:e,error:t.message}),r.push(e),null}})).filter((function(e){return null!==e})),a=t.filter((function(e){return!r.includes(e)}));if(a.length!==t.length){O.trace("RetryMessageBatcher -- failed to parse messages, removing from primary buffer");var o=JSON.stringify(a);this.storage.setItem(this.bufferKey,o)}return i}},{key:"getBufferSize",value:function(){return this.getPrimaryBuffer().primaryBuffer.length}},{key:"getPrimaryBuffer",value:function(){var e,t,n=(null!==(e=this.storage.getItem(this.bufferKey))&&void 0!==e?e:"").length;return{primaryBuffer:JSON.parse(null!==(t=this.storage.getItem(this.bufferKey))&&void 0!==t?t:"[]"),primaryBufferSizeInBytes:n}}},{key:"appendBuffer",value:function(e){var t=this,n=this.getPrimaryBuffer(),r=n.primaryBuffer,i=n.primaryBufferSizeInBytes;e.forEach((function(e){var n=JSON.stringify(e),a=i+n.length;a>t.maxLocalStorageBufferSize?O.debug("RetryMessageBuffer -- capped out on failed messages, no longer adding"):(r.push(e),i=a)}));var a=JSON.stringify(r);O.trace("RetryMessageBuffer -- Saving primary buffer",a);try{this.storage.setItem(this.bufferKey,a)}catch(e){O.warn("RetryMessageBuffer -- Failed to save to primary buffer",{e:e})}}}],[{key:"deleteQueue",value:function(){var e=Zl.getInstance();(new ye).removeItem("_hp5_retry_buffer.".concat(e.getEnvironmentId()))}}]),e}(),wr=yr,br=function(){return"visible"===document.visibilityState},_r=function(e,t,n){Math.random()*e<1&&t.apply(null,n)};function kr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ir(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ir(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ir(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Sr=function(){function e(t){var n=this,r=t.client,i=t.flushInterval,o=void 0===i?3e3:i,s=t.maxBufferSize,c=void 0===s?10:s,l=t.initialRetryDelay,f=void 0===l?2e3:l,d=t.maxRetryDelay,v=void 0===d?5e3:d,h=t.maxRetries,p=void 0===h?3:h,g=t.maxLifetimeOfRequestsInSeconds,m=void 0===g?C:g,y=t.maxBatchSize,w=void 0===y?10:y;u(this,e),a(this,"backlogFailedRequests",(function(e){var t=e.originalBufferedMessages.filter((function(e){return!vr(e.timestamp,n.maxLifetimeOfRequestsInSeconds)}));n.retryBuffer.addMessages(t)})),O.trace("Creating network."),e.instance=this,this.client=r,this.batchBuffer=new gr,this.retryBuffer=new wr,this.flushInterval=o,this.maxBufferSize=c,this.flushTimeout=null,this.maxRetryDelay=v,this.initialRetryDelay=f,this.maxRetries=p,this.maxLifetimeOfRequestsInSeconds=m,this.maxBatchSize=w,this.sendStatus={isSending:!1,numMessagesSending:null},this.flushRetryBuffer(),this.flushBufferOnInterval(),O.trace("Initialized network")}var r,i,o,c;return l(e,[{key:"getBufferSize",value:function(){return this.batchBuffer.getBufferSize()}},{key:"addMessages",value:function(e){var t=e.map($n).filter((function(e){return hr(e)}));O.trace("Network -- schematized messages",{before:e,after:t}),t.length>0&&this.batchBuffer.addMessages(t);var n=e.some((function(e){return e.type===_.METADATA_SESSION||e.type===_.METADATA_USER||e.type===_.METADATA_PAGEVIEW}));(this.batchBuffer.getBufferSize()>=this.maxBufferSize&&!this.sendStatus.isSending||n)&&this.flushBuffer()}},{key:"flushBuffer",value:(c=t(s().mark((function e(){var t,n,r,i,a,o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==this.batchBuffer.getBufferSize()&&!this.sendStatus.isSending){e.next=5;break}return this.flushBufferOnInterval(),e.abrupt("return");case 5:this.sendStatus={isSending:!0,numMessagesSending:null},this.flushTimeout&&window.clearTimeout(this.flushTimeout),this.sendStatus.numMessagesSending=this.batchBuffer.getBufferSize(),t=this.batchBuffer.peakBuffer(this.sendStatus.numMessagesSending),O.trace("Network -- flushing buffer",t),n=kr(t);try{for(n.s();!(r=n.n()).done;)i=r.value,(a=i.timestamp)&&(o=Date.now(),u=o-a,c=Wn[i.type],_r(1e4,this.recordData.bind(this),["Message processing delay",{messageType:c,delay:u}]),u>5e3&&(O.warn("Network -- ".concat(c," processing delay"),{timeDiff:u}),_r(100,this.recordData.bind(this),["High message processing delay",{messageType:c,delay:u}])))}catch(e){n.e(e)}finally{n.f()}return l=this.formRequests(t),e.next=15,this.retryAllRequestsUntilSuccess(l);case 15:this.batchBuffer.commitPop(this.sendStatus.numMessagesSending),this.sendStatus={isSending:!1,numMessagesSending:null},O.trace("Network -- removing ".concat(this.sendStatus.numMessagesSending," messages, ").concat(this.batchBuffer.getBufferSize()," messages remaining")),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),O.error("Network -- error flushing buffer",{exception:e.t0});case 23:return e.prev=23,this.flushBufferOnInterval(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[0,20,23,26]])}))),function(){return c.apply(this,arguments)})},{key:"flushRetryBuffer",value:(o=t(s().mark((function e(){var t,n,r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==(t=this.retryBuffer.getBufferSize())){e.next=4;break}return e.abrupt("return");case 4:return n=this.retryBuffer.peakBuffer(t),O.debug("Network -- flushing retry buffer on initial page load",n),r=this.formRequests(n),e.next=9,Promise.all(r.map((function(e){return i.sendSingleRequestWithBackoff(e,i.initialRetryDelay,Number.MAX_VALUE)})));case 9:O.trace("Network -- successfully flushed "),this.retryBuffer.commitPop(t),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),O.error("Network -- error flushing retry buffer, discarding messages",{exception:e.t0});case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return o.apply(this,arguments)})},{key:"flushBufferOnUnload",value:function(){try{var e=this.batchBuffer.getBufferSize();if(0===e)return void O.trace("Network -- no messages to flush on unload");var t=this.batchBuffer.peakBuffer(e);this.formRequests(t).map((function(e){return(0,e.sendFunction)(e.payload,!0)})),O.debug("Network -- attempted to send requests on unload")}catch(e){O.warn("Network -- error flushing buffer on unload",{exception:e})}}},{key:"retryAllRequestsUntilSuccess",value:(i=t(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return n.sendSingleRequestWithBackoff(e,n.initialRetryDelay,0)})));case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"sendSingleRequestWithBackoff",value:(r=t(s().mark((function e(t,n,r){var i,a,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.sendFunction(t.payload);case 3:if(i=e.sent,a=i.ok,o=i.statusCode,!(!a&&o&&o>=500)){e.next=11;break}O.error("Network -- Request failed with 5xx, skipping immediate retry",{request:t}),this.backlogFailedRequests(t),e.next=13;break;case 11:if(a){e.next=13;break}throw new Error("Request failed with retryable status code ".concat(o));case 13:e.next=25;break;case 15:if(e.prev=15,e.t0=e.catch(0),!(r>=this.maxRetries)){e.next=20;break}return this.backlogFailedRequests(t),e.abrupt("return");case 20:return e.next=22,new Promise((function(e){return window.setTimeout(e,n)}));case 22:return u=Math.min(Math.pow(n,2),this.maxRetryDelay),O.error("Network -- Retrying request",{exception:e.t0}),e.abrupt("return",this.sendSingleRequestWithBackoff(t,u,r+1));case 25:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"formRequests",value:function(t){var n,r=this,i=e.groupByMessageType(t);O.info("Network -- Messages being sent to server",t);var o=function(e,t){return e.reduce((function(e,n,r){var i=Math.floor(r/t);return e[i]||(e[i]=[]),e[i].push(n),e}),[])}(i[Wn.Track],this.maxBatchSize),s=(a(n={},Wn.Track,o.map((function(e){return{payload:mr(e),sendFunction:r.client.sendEvent,originalBufferedMessages:e}}))),a(n,Wn.AUP,i[Wn.AUP].map((function(e){return{payload:(t=e,n=t.payload,new On(n).toBinary()),sendFunction:r.client.sendAUP,originalBufferedMessages:[e]};var t,n}))),a(n,Wn.Identify,i[Wn.Identify].map((function(e){return{payload:(t=e,n=t.payload,new Rn(n).toBinary()),sendFunction:r.client.sendIdentify,originalBufferedMessages:[e]};var t,n}))),n),u=[].concat(w(s[Wn.AUP]),w(s[Wn.Track]),w(s[Wn.Identify]));return O.trace("Network -- Formed requests",u),u}},{key:"flushBufferOnInterval",value:function(){var e=this;this.flushTimeout&&window.clearTimeout(this.flushTimeout),br()?ri.getInstance().getShouldStopTracking()||(this.flushTimeout=n.g.setTimeout(t(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.flushBuffer();case 2:case"end":return t.stop()}}),t)}))),this.flushInterval)):O.trace("Network -- disabling network flush interval on inactive tab")}},{key:"recordError",value:function(e,t){try{var n="";t&&(t.stack?n=(n=t.stack.length>500?t.stack.substring(0,500):t.stack).replace(/\n/g," "):t.name&&(n=t.name)),this.client.sendTelemetry({type:"error",cm:e,str:n})}catch(e){O.trace("Network -- error sending telemetry",{e:e})}}},{key:"recordData",value:function(e,t){try{this.client.sendTelemetry({type:"data",cm:e,val:t||0===t?t:""})}catch(e){O.trace("Network -- error sending telemetry",{e:e})}}}],[{key:"getInstance",value:function(t){if(!t&&!e.instance)throw new Error("Network instance not initialized");return e.instance?e.instance:new e(t)}},{key:"groupByMessageType",value:function(e){var t;return e.reduce((function(e,t){var n=t.type;return e[n]||(e[n]=[]),e[n].push(t),e}),(a(t={},Wn.Track,[]),a(t,Wn.AUP,[]),a(t,Wn.Identify,[]),t))}}]),e}(),Er=Sr;function Tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ar=function(){function e(t){u(this,e),a(this,"_dualWriteToV4",new Ae),this.storageType=t,this._storage=this._getStorageType()}return l(e,[{key:"_isStorageBlocked",value:function(){return ri.getInstance().getShouldStopTracking()}},{key:"_getStorageType",value:function(){var e=ri.getInstance().getConfig(),t=this.storageType||e.eventPropertiesStorage;return(null==t?void 0:t.toLowerCase())===I.LOCAL_STORAGE?new ye:new Ms}},{key:"_getStorageKey",value:function(){var e=Zl.getInstance();return"".concat("_hp5_event_props",".").concat(e.getEnvironmentId())}},{key:"clearProperties",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object.keys(this.getProperties()).length;t&&Er.getInstance().recordData("eventPropertiesTelemetry - removed properties",t),this._storage.removeItem(this._getStorageKey()),O.debug("Cleared event properties in persistent storage"),e&&this._dualWriteToV4.shouldWriteToV4()&&this._dualWriteToV4.updateEventProperties({})}},{key:"addProperties",value:function(e){if(!this._isStorageBlocked()){var t=this.getProperties(),n=Or(Or({},t),e);this._storage.setItem(this._getStorageKey(),n,{expires:j}),O.debug("Updated event property values in persistent storage",{before:t,after:n});var r=Object.keys(e).length;r>0&&Er.getInstance().recordData("eventPropertiesTelemetry - added new properties",r),this._dualWriteToV4.shouldWriteToV4()&&this._dualWriteToV4.updateEventProperties(n)}}},{key:"getProperties",value:function(){return this._storage.getItem(this._getStorageKey())||{}}},{key:"removeEventProperty",value:function(e){var t=Or({},this.getProperties());t[e]?(delete t[e],O.debug("EventPropertiesStore -- Removed event property ".concat(e," from persistent storage"),{before:this.getProperties(),after:t}),this._storage.setItem(this._getStorageKey(),t,{expires:j}),Er.getInstance().recordData("eventPropertiesTelemetry - removed properties",1),this._dualWriteToV4.shouldWriteToV4()&&this._dualWriteToV4.updateEventProperties(t)):O.debug("EventPropertiesStore -- event property ".concat(e," was not set"))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),Pr=function(){function e(){u(this,e)}return l(e,[{key:"setUserAgentClientHints",value:function(e){this.userAgentClientHints=e}},{key:"getUserAgentClientHints",value:function(){return this.userAgentClientHints}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();function Nr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Cr=function(e){if(!U(e))return"";var t=new RegExp("#.*");return e.replace(t,"")},xr=function(e,t){t=t||window.location.search,e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);if(null===n)return"";try{return decodeURIComponent(n[1].replace(/\+/g," "))}catch(e){return""}},Dr=function(e){if(!e)return e;var t=new RegExp("^(?:(?:https?|ftp):)/*(?:[^@]+@)?([^:/#]+)").exec(e);return t?t[1]:e},jr=function(){var e=Zl.getInstance().getTemporaryReferrer();return Cr(e||document.referrer)},Br=function(e){var t,n=Dr(e);if(!n)return"";var r=e.slice(e.indexOf("?"));if(n.search("google.([^/?]*)$")>=0||n.search("bing.com$")>=0)t="q";else{if(!(n.search("yahoo.com$")>=0))return"";t="p"}return window.decodeURIComponent(xr(t,r))},Mr=function(){return{source:xr("utm_source"),medium:xr("utm_medium"),term:xr("utm_term"),content:xr("utm_content"),campaign:xr("utm_campaign")}},Ur=function(){return{domain:window.location.hostname,path:window.location.pathname,query:me(window.location.search),hash:me(window.location.hash)}},Lr=function(){var e=Pr.getInstance().getUserAgentClientHints();return Rr({user_agent:navigator.userAgent},e&&{uach:e})},Fr=function(){var e=ri.getInstance();return{name:"web",version:e.getSdkVersion(),platform:"web",properties:{library_domain:e.getLibraryDomain()}}},zr=function(){return Ar.getInstance().getProperties()};function qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Hr=function e(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",a={},o=0,s=Object.entries(t);o<s.length;o++){var u=P(s[o],2),c=u[0],l=u[1],f=n?"".concat(n).concat(i).concat(c):c;l&&"object"===r(l)&&!Array.isArray(l)?a=Vr(Vr({},a),e(l,f,i)):void 0!==l&&(a[f]=l)}return a},Jr=function(e){var t,n=Hr(e);return t=n,Object.entries(t).map((function(e){var t=P(e,2),n=t[0],r=t[1];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(String(r)))})).join("&")};function Kr(e){var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=e[n],a=n.toLowerCase();i&&"object"===r(i)?Array.isArray(i)?t[a]=i:t[a]=Kr(i):t[a]=i}return t}function Qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Gr={disabletextcapture:"disableTextCapture",enablesecurecookies:"enableSecureCookies",securecookie:"secureCookie",trackingserver:"trackingServer",loglevel:"logLevel",metadatastorage:"metadataStorage",eventpropertiesstorage:"eventPropertiesStorage",customevents:"customEvents",disableinteractionevents:"disableInteractionEvents",classicsdkcompatibility:"classicSDKCompatibility",supporteddomains:"supportedDomains",salesforceaura:"salesforceAura",disablesessionreplay:"disableSessionReplay",cleareventpropertiesonnewuser:"clearEventPropertiesOnNewUser",disablepageviewautocapture:"disablePageviewAutocapture",sdk:"sdk",compresscookies:"compressCookies",ingestserver:"ingestServer",cssettings:"csSettings"},Yr={domain:"domain",version:"version",isexperimentalversion:"isExperimentalVersion",plugins:"plugins"},Wr={csprojectid:"csProjectId",cshashedprojid:"csHashedProjId",heaptagstatus:"heapTagStatus"},Xr=function(e){var t=Kr(e);return e=Object.keys(t).reduce((function(e,n){var r=Gr[n];if("sdk"===r){var i=t[n];return i&&(e[r]=Object.keys(i).reduce((function(e,t){var n=Yr[t];return Zr(Zr({},e),{},a({},n,i[t]))}),{})),e}if("csSettings"!==r)return Zr(Zr({},e),{},a({},r,t[n]));var o=t[n];return o&&(e[r]=Object.keys(o).reduce((function(e,t){var n=Wr[t];return Zr(Zr({},e),{},a({},n,o[t]))}),{})),e}),{})};function $r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ei(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ti=function(e){return e.PRIVACY="privacy",e.INGEST_SERVER="ingestServer",e.METADATA_STORAGE="metadataStorage",e.EVENT_PROPERTIES_STORAGE="eventPropertiesStorage",e.CUSTOM_EVENTS="customEvents",e.DISABLE_INTERACTION_EVENTS="disableInteractionEvents",e.CLASSIC_SDK_COMPATIBILITY="classicSDKCompatibility",e.SUPPORTED_DOMAINS="supportedDomains",e.SALESFORCE_AURA="salesforceAura",e.DISABLE_SESSION_REPLAY="disableSessionReplay",e.CLEAR_EVENT_PROPERTIES_ON_NEW_USER="clearEventPropertiesOnNewUser",e.DISABLE_PAGEVIEW_AUTOCAPTURE="disablePageviewAutocapture",e.SDK="sdk",e.CS_SETTINGS="csSettings",e.COMPRESS_COOKIES="compressCookies",e}(ti||{}),ni=["clearEventPropertiesOnNewUser","classicSDKCompatibility","compressCookies","customEvents","csSettings","disableInteractionEvents","disablePageviewAutocapture","disableSessionReplay","eventPropertiesStorage","ingestServer","appServer","metadataStorage","privacy","salesforceAura","supportedDomains"],ri=function(){function e(){u(this,e),a(this,"shouldStopTracking",!1),a(this,"safestSettings",{privacy:{enableSecureCookies:!0,disableTextCapture:!0}}),a(this,"config",{})}return l(e,[{key:"setShouldStopTracking",value:function(e){this.shouldStopTracking=e}},{key:"getShouldStopTracking",value:function(){return this.shouldStopTracking}},{key:"_getEnableSecureCookiesFromClientSideConfig",value:function(e){return F(null==e?void 0:e.enableSecureCookies)?null==e?void 0:e.enableSecureCookies:F(null==e?void 0:e.secureCookie)?null==e?void 0:e.secureCookie:void 0}},{key:"normalizeClientSideConfigToHeapConfig",value:function(e){if(!e)return{};var t={disableTextCapture:e.disableTextCapture,enableSecureCookies:this._getEnableSecureCookiesFromClientSideConfig(e)},n=e.ingestServer||e.trackingServer,r=e.metadataStorage,i=e.eventPropertiesStorage,a=e.customEvents,o=e.disableInteractionEvents,s=e.classicSDKCompatibility,u=e.supportedDomains,c=e.salesforceAura,l=e.disableSessionReplay,f=e.clearEventPropertiesOnNewUser,d=e.disablePageviewAutocapture,v=e.sdk,h=e.csSettings,p=e.compressCookies;return $({ingestServer:n,privacy:$(t),metadataStorage:r,eventPropertiesStorage:i,customEvents:a,disableInteractionEvents:o,classicSDKCompatibility:s,supportedDomains:u,salesforceAura:c,disableSessionReplay:l,clearEventPropertiesOnNewUser:f,disablePageviewAutocapture:d,sdk:v,csSettings:h,compressCookies:p})}},{key:"_resolveToClientConfigIfAvailable",value:function(e,t){return e||t}},{key:"_resolveSdk",value:function(e,t){return{domain:(null==e?void 0:e.domain)||(null==t?void 0:t.domain),version:(null==e?void 0:e.version)||(null==t?void 0:t.version),isExperimentalVersion:(null==t?void 0:t.isExperimentalVersion)||!1,plugins:null==t?void 0:t.plugins}}},{key:"_resolvePrivacyConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ei({},t),r=this.safestSettings.privacy;return Object.keys(e).forEach((function(i){var a,o=e[i];i in r&&i in t&&t[i]!==o?(a=r[i],O.debug("ConfigStore -- Disagreement between client & server-side configs: Using value ".concat(a," for ").concat(i," as safest value"))):a=o,n[i]=a})),n}},{key:"_resolveStorageConfig",value:function(e){return!e||!U(e)||e.toLowerCase()!==I.LOCAL_STORAGE&&e.toLowerCase()!==I.COOKIES?I.COOKIES:e.toLowerCase()}},{key:"_resolveBoolean",value:function(e,t){return F(e)?e:!!F(t)&&t}},{key:"_isValidClientCsSettings",value:function(e){return!(null==e||!e.csProjectId||null==e||!e.heapTagStatus)&&!(null!=e&&e.heapTagStatus&&![se.CsSideloadsHeap,se.MappingOnly].includes(e.heapTagStatus))}},{key:"_resolveCsSettings",value:function(e,t){if(t)return this._isValidClientCsSettings(e)?e:(null==t?void 0:t.heapTagStatus)===se.CsSideloadsHeap&&(null==e?void 0:e.heapTagStatus)!==se.CsSideloadsHeap?(O.debug("ConfigStore -- _resolveCsSettings -- Disagreement between client & server-side configs for ".concat(se.CsSideloadsHeap,": Using value ").concat(se.MappingOnly)),{heapTagStatus:se.MappingOnly}):t}},{key:"_resolveAppServer",value:function(e,t){if(t)return t;if(e){var n=e.match(/https:\/\/c\.(\w+)\.heap-api\.com/),r=n?n[1]:null;if(r&&"us"!==r)return"https://".concat(r,".heapanalytics.com")}return"https://heapanalytics.com"}},{key:"resolveConfig",value:function(e,t){var n;e&&(e=Xr(e));var r=(a(n={},ti.PRIVACY,this._resolvePrivacyConfig.bind(this)),a(n,ti.INGEST_SERVER,this._resolveToClientConfigIfAvailable.bind(this)),a(n,ti.METADATA_STORAGE,this._resolveStorageConfig.bind(this)),a(n,ti.EVENT_PROPERTIES_STORAGE,this._resolveStorageConfig.bind(this)),a(n,ti.CUSTOM_EVENTS,this._resolveToClientConfigIfAvailable.bind(this)),a(n,ti.DISABLE_INTERACTION_EVENTS,this._resolveToClientConfigIfAvailable.bind(this)),a(n,ti.CLASSIC_SDK_COMPATIBILITY,this._resolveBoolean.bind(this)),a(n,ti.SUPPORTED_DOMAINS,this._resolveToClientConfigIfAvailable.bind(this)),a(n,ti.SALESFORCE_AURA,this._resolveBoolean.bind(this)),a(n,ti.DISABLE_SESSION_REPLAY,this._resolveBoolean.bind(this)),a(n,ti.CLEAR_EVENT_PROPERTIES_ON_NEW_USER,this._resolveBoolean.bind(this)),a(n,ti.DISABLE_PAGEVIEW_AUTOCAPTURE,this._resolveBoolean.bind(this)),a(n,ti.SDK,this._resolveSdk.bind(this)),a(n,ti.CS_SETTINGS,this._resolveCsSettings.bind(this)),a(n,ti.COMPRESS_COOKIES,this._resolveBoolean.bind(this)),n),i=this.normalizeClientSideConfigToHeapConfig(e),o=ei({},t);return Object.keys(r).forEach((function(e){var n=r[e](null==i?void 0:i[e],null==t?void 0:t[e]);o[e]=n})),o.appServer=this._resolveAppServer(o.ingestServer,o.appServer),O.trace("ConfigStore -- resolved config",{clientSideConfig:e,normalizedClientSideConfig:i,serverSideConfig:t,resolvedConfig:o}),o}},{key:"setConfig",value:function(e){this.config=e}},{key:"getConfig",value:function(){return this.config}},{key:"getEnableSecureCookies",value:function(){var e;return!(null===(e=this.config.privacy)||void 0===e||!e.enableSecureCookies)}},{key:"getIntegrations",value:function(){return this.config.integrations||[]}},{key:"getIngestServer",value:function(){return this.getConfig().ingestServer||"https://c.us.heap-api.com"}},{key:"getSdkVersion",value:function(){var e,t=null!==(e=this.getConfig().sdk)&&void 0!==e?e:{},n=t.version,r=t.isExperimentalVersion;return void 0===n?"Unknown version (v5)":r?"".concat(n," (v5 experiment)"):n}},{key:"getLibraryDomain",value:function(){var e,t;return null!==(e=Dr(null===(t=this.getConfig().sdk)||void 0===t?void 0:t.domain))&&void 0!==e?e:"Unknown"}},{key:"getMetadataStorageType",value:function(){return this.config.metadataStorage||I.COOKIES}},{key:"getEventPropertiesStorageType",value:function(){return this.config.eventPropertiesStorage||I.COOKIES}},{key:"isSessionReplayDisabled",value:function(){return this.config.disableSessionReplay}},{key:"getClearEventPropertiesOnNewUser",value:function(){return this.config.clearEventPropertiesOnNewUser}},{key:"getDisablePageviewAutocapture",value:function(){return this.config.disablePageviewAutocapture}},{key:"getCsHeapTagStatus",value:function(){var e,t;return null===(e=this.config)||void 0===e||null===(t=e.csSettings)||void 0===t?void 0:t.heapTagStatus}},{key:"getShouldCompressCookies",value:function(){var e;return!this.config.classicSDKCompatibility&&!(null===(e=this.config)||void 0===e||!e.compressCookies)}},{key:"getIsTextCaptureDisabled",value:function(){var e;return null===(e=this.config.privacy)||void 0===e?void 0:e.disableTextCapture}},{key:"setDisableTextCapture",value:function(e){var t;F(e)&&(this.config.privacy=null!==(t=this.config.privacy)&&void 0!==t?t:{},this.config.privacy.disableTextCapture=e,O.debug("ConfigStore -- setDisableTextCapture -- disableTextCapture set to ".concat(e)))}},{key:"getConfigTelemetry",value:function(){var e=this.getConfig();return Object.keys(e).reduce((function(t,n){return ni.includes(n)&&(t[n]=e[n]),t}),{})}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),ii=function(e){return e.None="None",e.Lax="Lax",e}({}),ai=function(){return navigator.userAgent},oi=function(){return e=12,!!(t=ai().match(/\(iP.+; CPU .*OS (\d+)[_\d]*.*\) AppleWebKit\//))&&parseInt(t[0],10)===e||function(e,t){var n=ai().match(/\(Macintosh;.*Mac OS X (\d+)_(\d+)[_\d]*.*\) AppleWebKit\//);if(!n)return!1;var r=parseInt(n[0],10),i=parseInt(n[1],10);return r===e&&i===t}(10,14)&&(/Version\/.* Safari/.test(ai())&&!ui()||si());var e,t},si=function(){return/^Mozilla\/[.\d]+ \(Macintosh;.*Mac OS X [_\d]+\) AppleWebKit\/[.\d]+ \(KHTML, like Gecko\)$/.test(ai())},ui=function(){return/Chrom(e|ium)/.test(ai())},ci=function(e){var t=ai().match(/Chrom[^ /]+\/(\d+)[.\d]* /),n=0;return t&&(n=parseInt(t[0],10)),n>=e},li=function(){return/UCBrowser\//.test(ai())?!function(e,t,n){var r=ai().match(/UCBrowser\/(\d+)\.(\d+)\.(\d+)[.\d]* /);if(!r)return!1;if(0===r.length)return!1;var i=parseInt(r[0],10),a=parseInt(r[1],10),o=parseInt(r[2],10);return i!==e?i>e:a!==t?a>t:o>=n}(12,13,2):ui()&&ci(51)&&!ci(67)},fi=function(e){return oi()||li()?null:e?ii.None:ii.Lax};function di(e){let t=e.length;for(;--t>=0;)e[t]=0}const vi=256,hi=286,pi=30,gi=15,mi=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),yi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),wi=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_i=new Array(576);di(_i);const ki=new Array(60);di(ki);const Ii=new Array(512);di(Ii);const Si=new Array(256);di(Si);const Ei=new Array(29);di(Ei);const Ti=new Array(pi);function Oi(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let Ai,Pi,Ni;function Ri(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}di(Ti);const Ci=e=>e<256?Ii[e]:Ii[256+(e>>>7)],xi=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Di=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,xi(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ji=(e,t,n)=>{Di(e,n[2*t],n[2*t+1])},Bi=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Mi=(e,t,n)=>{const r=new Array(16);let i,a,o=0;for(i=1;i<=gi;i++)o=o+n[i-1]<<1,r[i]=o;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Bi(r[t]++,t))}},Ui=e=>{let t;for(t=0;t<hi;t++)e.dyn_ltree[2*t]=0;for(t=0;t<pi;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Li=e=>{e.bi_valid>8?xi(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Fi=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},zi=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Fi(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Fi(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},qi=(e,t,n)=>{let r,i,a,o,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?ji(e,i,t):(a=Si[i],ji(e,a+vi+1,t),o=mi[a],0!==o&&(i-=Ei[a],Di(e,i,o)),r--,a=Ci(r),ji(e,a,n),o=yi[a],0!==o&&(r-=Ti[a],Di(e,r,o)))}while(s<e.sym_next);ji(e,256,t)},Vi=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let o,s,u,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<a;o++)0!==n[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=c<2?++c:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,i&&(e.static_len-=r[2*u+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)zi(e,n,o);u=a;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zi(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,n[2*u]=n[2*o]+n[2*s],e.depth[u]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,n[2*o+1]=n[2*s+1]=u,e.heap[1]=u++,zi(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,u=t.stat_desc.max_length;let c,l,f,d,v,h,p=0;for(d=0;d<=gi;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)l=e.heap[c],d=n[2*n[2*l+1]+1]+1,d>u&&(d=u,p++),n[2*l+1]=d,l>r||(e.bl_count[d]++,v=0,l>=s&&(v=o[l-s]),h=n[2*l],e.opt_len+=h*(d+v),a&&(e.static_len+=h*(i[2*l+1]+v)));if(0!==p){do{for(d=u-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[u]--,p-=2}while(p>0);for(d=u;0!==d;d--)for(l=e.bl_count[d];0!==l;)f=e.heap[--c],f>r||(n[2*f+1]!==d&&(e.opt_len+=(d-n[2*f+1])*n[2*f],n[2*f+1]=d),l--)}})(e,t),Mi(n,c,e.bl_count)},Hi=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<u&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))},Ji=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<u&&i===o)){if(s<c)do{ji(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(ji(e,i,e.bl_tree),s--),ji(e,16,e.bl_tree),Di(e,s-3,2)):s<=10?(ji(e,17,e.bl_tree),Di(e,s-3,3)):(ji(e,18,e.bl_tree),Di(e,s-11,7));s=0,a=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4)}};let Ki=!1;const Qi=(e,t,n,r)=>{Di(e,0+(r?1:0),3),Li(e),xi(e,n),xi(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Zi=(e,t,n,r)=>{let i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<vi;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Vi(e,e.l_desc),Vi(e,e.d_desc),o=(e=>{let t;for(Hi(e,e.dyn_ltree,e.l_desc.max_code),Hi(e,e.dyn_dtree,e.d_desc.max_code),Vi(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*bi[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?Qi(e,t,n,r):4===e.strategy||a===i?(Di(e,2+(r?1:0),3),qi(e,_i,ki)):(Di(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(Di(e,t-257,5),Di(e,n-1,5),Di(e,r-4,4),i=0;i<r;i++)Di(e,e.bl_tree[2*bi[i]+1],3);Ji(e,e.dyn_ltree,t-1),Ji(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),qi(e,e.dyn_ltree,e.dyn_dtree)),Ui(e),r&&Li(e)},Gi={_tr_init:e=>{Ki||((()=>{let e,t,n,r,i;const a=new Array(16);for(n=0,r=0;r<28;r++)for(Ei[r]=n,e=0;e<1<<mi[r];e++)Si[n++]=r;for(Si[n-1]=r,i=0,r=0;r<16;r++)for(Ti[r]=i,e=0;e<1<<yi[r];e++)Ii[i++]=r;for(i>>=7;r<pi;r++)for(Ti[r]=i<<7,e=0;e<1<<yi[r]-7;e++)Ii[256+i++]=r;for(t=0;t<=gi;t++)a[t]=0;for(e=0;e<=143;)_i[2*e+1]=8,e++,a[8]++;for(;e<=255;)_i[2*e+1]=9,e++,a[9]++;for(;e<=279;)_i[2*e+1]=7,e++,a[7]++;for(;e<=287;)_i[2*e+1]=8,e++,a[8]++;for(Mi(_i,287,a),e=0;e<pi;e++)ki[2*e+1]=5,ki[2*e]=Bi(e,5);Ai=new Oi(_i,mi,257,hi,gi),Pi=new Oi(ki,yi,0,pi,gi),Ni=new Oi(new Array(0),wi,0,19,7)})(),Ki=!0),e.l_desc=new Ri(e.dyn_ltree,Ai),e.d_desc=new Ri(e.dyn_dtree,Pi),e.bl_desc=new Ri(e.bl_tree,Ni),e.bi_buf=0,e.bi_valid=0,Ui(e)},_tr_stored_block:Qi,_tr_flush_block:Zi,_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Si[n]+vi+1)]++,e.dyn_dtree[2*Ci(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Di(e,2,3),ji(e,256,_i),(e=>{16===e.bi_valid?(xi(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Yi=(e,t,n,r)=>{let i=65535&e,a=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{i=i+t[r++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16};const Wi=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Xi=(e,t,n,r)=>{const i=Wi,a=r+n;e^=-1;for(let n=r;n<a;n++)e=e>>>8^i[255&(e^t[n])];return~e},$i={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ea={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ta,_tr_stored_block:na,_tr_flush_block:ra,_tr_tally:ia,_tr_align:aa}=Gi,{Z_NO_FLUSH:oa,Z_PARTIAL_FLUSH:sa,Z_FULL_FLUSH:ua,Z_FINISH:ca,Z_BLOCK:la,Z_OK:fa,Z_STREAM_END:da,Z_STREAM_ERROR:va,Z_DATA_ERROR:ha,Z_BUF_ERROR:pa,Z_DEFAULT_COMPRESSION:ga,Z_FILTERED:ma,Z_HUFFMAN_ONLY:ya,Z_RLE:wa,Z_FIXED:ba,Z_DEFAULT_STRATEGY:_a,Z_UNKNOWN:ka,Z_DEFLATED:Ia}=ea,Sa=258,Ea=262,Ta=42,Oa=113,Aa=666,Pa=(e,t)=>(e.msg=$i[t],t),Na=e=>2*e-(e>4?9:0),Ra=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Ca=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let xa=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Da=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},ja=(e,t)=>{ra(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Da(e.strm)},Ba=(e,t)=>{e.pending_buf[e.pending++]=t},Ma=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ua=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=Yi(e.adler,t,i,n):2===e.state.wrap&&(e.adler=Xi(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},La=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match;const u=e.strstart>e.w_size-Ea?e.strstart-(e.w_size-Ea):0,c=e.window,l=e.w_mask,f=e.prev,d=e.strstart+Sa;let v=c[a+o-1],h=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,c[n+o]===h&&c[n+o-1]===v&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d);if(r=Sa-(d-a),a=d-Sa,r>o){if(e.match_start=t,o=r,r>=s)break;v=c[a+o-1],h=c[a+o]}}}while((t=f[t&l])>u&&0!=--i);return o<=e.lookahead?o:e.lookahead},Fa=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ea)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Ca(e),r+=t),0===e.strm.avail_in)break;if(n=Ua(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=xa(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=xa(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ea&&0!==e.strm.avail_in)},za=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==ca||t===oa||n!==r+e.strm.avail_in))break;o=t===ca&&n===r+e.strm.avail_in?1:0,na(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Da(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ua(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==oa&&t!==ca&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Ua(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===ca)&&t!==oa&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=t===ca&&0===e.strm.avail_in&&n===r?1:0,na(e,e.block_start,n,o),e.block_start+=n,Da(e.strm)),o?3:1)},qa=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ea){if(Fa(e),e.lookahead<Ea&&t===oa)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=xa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Ea&&(e.match_length=La(e,n)),e.match_length>=3)if(r=ia(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=xa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=xa(e,e.ins_h,e.window[e.strstart+1]);else r=ia(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(ja(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ca?(ja(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ja(e,!1),0===e.strm.avail_out)?1:2},Va=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ea){if(Fa(e),e.lookahead<Ea&&t===oa)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=xa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ea&&(e.match_length=La(e,n),e.match_length<=5&&(e.strategy===ma||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=ia(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=xa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(ja(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=ia(e,0,e.window[e.strstart-1]),r&&ja(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=ia(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ca?(ja(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ja(e,!1),0===e.strm.avail_out)?1:2};function Ha(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const Ja=[new Ha(0,0,0,0,za),new Ha(4,4,8,4,qa),new Ha(4,5,16,8,qa),new Ha(4,6,32,32,qa),new Ha(4,4,16,16,Va),new Ha(8,16,32,32,Va),new Ha(8,16,128,128,Va),new Ha(8,32,128,256,Va),new Ha(32,128,258,1024,Va),new Ha(32,258,258,4096,Va)];function Ka(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ia,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ra(this.dyn_ltree),Ra(this.dyn_dtree),Ra(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ra(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ra(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Qa=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ta&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Oa&&t.status!==Aa?1:0},Za=e=>{if(Qa(e))return Pa(e,va);e.total_in=e.total_out=0,e.data_type=ka;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Ta:Oa,e.adler=2===t.wrap?0:1,t.last_flush=-2,ta(t),fa},Ga=e=>{const t=Za(e);var n;return t===fa&&((n=e.state).window_size=2*n.w_size,Ra(n.head),n.max_lazy_match=Ja[n.level].max_lazy,n.good_match=Ja[n.level].good_length,n.nice_match=Ja[n.level].nice_length,n.max_chain_length=Ja[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Ya=(e,t,n,r,i,a)=>{if(!e)return va;let o=1;if(t===ga&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==Ia||r<8||r>15||t<0||t>9||a<0||a>ba||8===r&&1!==o)return Pa(e,va);8===r&&(r=9);const s=new Ka;return e.state=s,s.strm=e,s.status=Ta,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=a,s.method=n,Ga(e)};var Wa={deflateInit:(e,t)=>Ya(e,t,Ia,15,8,_a),deflateInit2:Ya,deflateReset:Ga,deflateResetKeep:Za,deflateSetHeader:(e,t)=>Qa(e)||2!==e.state.wrap?va:(e.state.gzhead=t,fa),deflate:(e,t)=>{if(Qa(e)||t>la||t<0)return e?Pa(e,va):va;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Aa&&t!==ca)return Pa(e,0===e.avail_out?pa:va);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Da(e),0===e.avail_out)return n.last_flush=-1,fa}else if(0===e.avail_in&&Na(t)<=Na(r)&&t!==ca)return Pa(e,pa);if(n.status===Aa&&0!==e.avail_in)return Pa(e,pa);if(n.status===Ta&&0===n.wrap&&(n.status=Oa),n.status===Ta){let t=Ia+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=ya||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Ma(n,t),0!==n.strstart&&(Ma(n,e.adler>>>16),Ma(n,65535&e.adler)),e.adler=1,n.status=Oa,Da(e),0!==n.pending)return n.last_flush=-1,fa}if(57===n.status)if(e.adler=0,Ba(n,31),Ba(n,139),Ba(n,8),n.gzhead)Ba(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ba(n,255&n.gzhead.time),Ba(n,n.gzhead.time>>8&255),Ba(n,n.gzhead.time>>16&255),Ba(n,n.gzhead.time>>24&255),Ba(n,9===n.level?2:n.strategy>=ya||n.level<2?4:0),Ba(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ba(n,255&n.gzhead.extra.length),Ba(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Xi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ba(n,0),Ba(n,0),Ba(n,0),Ba(n,0),Ba(n,0),Ba(n,9===n.level?2:n.strategy>=ya||n.level<2?4:0),Ba(n,3),n.status=Oa,Da(e),0!==n.pending)return n.last_flush=-1,fa;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,Da(e),0!==n.pending)return n.last_flush=-1,fa;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-r,r)),Da(e),0!==n.pending)return n.last_flush=-1,fa;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ba(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-r,r)),Da(e),0!==n.pending)return n.last_flush=-1,fa;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ba(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Xi(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Da(e),0!==n.pending))return n.last_flush=-1,fa;Ba(n,255&e.adler),Ba(n,e.adler>>8&255),e.adler=0}if(n.status=Oa,Da(e),0!==n.pending)return n.last_flush=-1,fa}if(0!==e.avail_in||0!==n.lookahead||t!==oa&&n.status!==Aa){let r=0===n.level?za(n,t):n.strategy===ya?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Fa(e),0===e.lookahead)){if(t===oa)return 1;break}if(e.match_length=0,n=ia(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ja(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ca?(ja(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ja(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===wa?((e,t)=>{let n,r,i,a;const o=e.window;for(;;){if(e.lookahead<=Sa){if(Fa(e),e.lookahead<=Sa&&t===oa)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){a=e.strstart+Sa;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=Sa-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=ia(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=ia(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ja(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ca?(ja(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ja(e,!1),0===e.strm.avail_out)?1:2})(n,t):Ja[n.level].func(n,t);if(3!==r&&4!==r||(n.status=Aa),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),fa;if(2===r&&(t===sa?aa(n):t!==la&&(na(n,0,0,!1),t===ua&&(Ra(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Da(e),0===e.avail_out))return n.last_flush=-1,fa}return t!==ca?fa:n.wrap<=0?da:(2===n.wrap?(Ba(n,255&e.adler),Ba(n,e.adler>>8&255),Ba(n,e.adler>>16&255),Ba(n,e.adler>>24&255),Ba(n,255&e.total_in),Ba(n,e.total_in>>8&255),Ba(n,e.total_in>>16&255),Ba(n,e.total_in>>24&255)):(Ma(n,e.adler>>>16),Ma(n,65535&e.adler)),Da(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?fa:da)},deflateEnd:e=>{if(Qa(e))return va;const t=e.state.status;return e.state=null,t===Oa?Pa(e,ha):fa},deflateSetDictionary:(e,t)=>{let n=t.length;if(Qa(e))return va;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==Ta||r.lookahead)return va;if(1===i&&(e.adler=Yi(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Ra(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Fa(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=xa(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Fa(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=i,fa},deflateInfo:"pako deflate (from Nodeca project)"};const Xa=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var $a=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Xa(n,t)&&(e[t]=n[t])}}return e},eo=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length}return n};let to=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){to=!1}const no=new Uint8Array(256);for(let e=0;e<256;e++)no[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;no[254]=no[254]=1;var ro=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},io=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let o=no[t];if(o>4)a[i++]=65533,r+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&r<n;)t=t<<6|63&e[r++],o--;o>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&to)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(a,i)},ao=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+no[e[n]]>t?n:t};var oo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const so=Object.prototype.toString,{Z_NO_FLUSH:uo,Z_SYNC_FLUSH:co,Z_FULL_FLUSH:lo,Z_FINISH:fo,Z_OK:vo,Z_STREAM_END:ho,Z_DEFAULT_COMPRESSION:po,Z_DEFAULT_STRATEGY:go,Z_DEFLATED:mo}=ea;function yo(e){this.options=$a({level:po,method:mo,chunkSize:16384,windowBits:15,memLevel:8,strategy:go},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oo,this.strm.avail_out=0;let n=Wa.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==vo)throw new Error($i[n]);if(t.header&&Wa.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?ro(t.dictionary):"[object ArrayBuffer]"===so.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Wa.deflateSetDictionary(this.strm,e),n!==vo)throw new Error($i[n]);this._dict_set=!0}}function wo(e,t){const n=new yo(t);if(n.push(e,!0),n.err)throw n.msg||$i[n.err];return n.result}yo.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?fo:uo,"string"==typeof e?n.input=ro(e):"[object ArrayBuffer]"===so.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===co||a===lo)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Wa.deflate(n,a),i===ho)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Wa.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===vo;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},yo.prototype.onData=function(e){this.chunks.push(e)},yo.prototype.onEnd=function(e){e===vo&&(this.result=eo(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bo={Deflate:yo,deflate:wo,deflateRaw:function(e,t){return(t=t||{}).raw=!0,wo(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,wo(e,t)},constants:ea};const _o=16209;var ko=function(e,t){let n,r,i,a,o,s,u,c,l,f,d,v,h,p,g,m,y,w,b,_,k,I,S,E;const T=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),i=e.next_out,E=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=T.dmax,u=T.wsize,c=T.whave,l=T.wnext,f=T.window,d=T.hold,v=T.bits,h=T.lencode,p=T.distcode,g=(1<<T.lenbits)-1,m=(1<<T.distbits)-1;e:do{v<15&&(d+=S[n++]<<v,v+=8,d+=S[n++]<<v,v+=8),y=h[d&g];t:for(;;){if(w=y>>>24,d>>>=w,v-=w,w=y>>>16&255,0===w)E[i++]=65535&y;else{if(!(16&w)){if(64&w){if(32&w){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=_o;break e}y=h[(65535&y)+(d&(1<<w)-1)];continue t}for(b=65535&y,w&=15,w&&(v<w&&(d+=S[n++]<<v,v+=8),b+=d&(1<<w)-1,d>>>=w,v-=w),v<15&&(d+=S[n++]<<v,v+=8,d+=S[n++]<<v,v+=8),y=p[d&m];;){if(w=y>>>24,d>>>=w,v-=w,w=y>>>16&255,16&w){if(_=65535&y,w&=15,v<w&&(d+=S[n++]<<v,v+=8,v<w&&(d+=S[n++]<<v,v+=8)),_+=d&(1<<w)-1,_>s){e.msg="invalid distance too far back",T.mode=_o;break e}if(d>>>=w,v-=w,w=i-a,_>w){if(w=_-w,w>c&&T.sane){e.msg="invalid distance too far back",T.mode=_o;break e}if(k=0,I=f,0===l){if(k+=u-w,w<b){b-=w;do{E[i++]=f[k++]}while(--w);k=i-_,I=E}}else if(l<w){if(k+=u+l-w,w-=l,w<b){b-=w;do{E[i++]=f[k++]}while(--w);if(k=0,l<b){w=l,b-=w;do{E[i++]=f[k++]}while(--w);k=i-_,I=E}}}else if(k+=l-w,w<b){b-=w;do{E[i++]=f[k++]}while(--w);k=i-_,I=E}for(;b>2;)E[i++]=I[k++],E[i++]=I[k++],E[i++]=I[k++],b-=3;b&&(E[i++]=I[k++],b>1&&(E[i++]=I[k++]))}else{k=i-_;do{E[i++]=E[k++],E[i++]=E[k++],E[i++]=E[k++],b-=3}while(b>2);b&&(E[i++]=E[k++],b>1&&(E[i++]=E[k++]))}break}if(64&w){e.msg="invalid distance code",T.mode=_o;break e}y=p[(65535&y)+(d&(1<<w)-1)]}}break}}while(n<r&&i<o);b=v>>3,n-=b,v-=b<<3,d&=(1<<v)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),T.hold=d,T.bits=v};const Io=15,So=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Eo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),To=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Oo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ao=(e,t,n,r,i,a,o,s)=>{const u=s.bits;let c,l,f,d,v,h,p=0,g=0,m=0,y=0,w=0,b=0,_=0,k=0,I=0,S=0,E=null;const T=new Uint16Array(16),O=new Uint16Array(16);let A,P,N,R=null;for(p=0;p<=Io;p++)T[p]=0;for(g=0;g<r;g++)T[t[n+g]]++;for(w=u,y=Io;y>=1&&0===T[y];y--);if(w>y&&(w=y),0===y)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(m=1;m<y&&0===T[m];m++);for(w<m&&(w=m),k=1,p=1;p<=Io;p++)if(k<<=1,k-=T[p],k<0)return-1;if(k>0&&(0===e||1!==y))return-1;for(O[1]=0,p=1;p<Io;p++)O[p+1]=O[p]+T[p];for(g=0;g<r;g++)0!==t[n+g]&&(o[O[t[n+g]]++]=g);if(0===e?(E=R=o,h=20):1===e?(E=So,R=Eo,h=257):(E=To,R=Oo,h=0),S=0,g=0,p=m,v=a,b=w,_=0,f=-1,I=1<<w,d=I-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){A=p-_,o[g]+1<h?(P=0,N=o[g]):o[g]>=h?(P=R[o[g]-h],N=E[o[g]-h]):(P=96,N=0),c=1<<p-_,l=1<<b,m=l;do{l-=c,i[v+(S>>_)+l]=A<<24|P<<16|N}while(0!==l);for(c=1<<p-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,g++,0==--T[p]){if(p===y)break;p=t[n+o[g]]}if(p>w&&(S&d)!==f){for(0===_&&(_=w),v+=m,b=p-_,k=1<<b;b+_<y&&(k-=T[b+_],!(k<=0));)b++,k<<=1;if(I+=1<<b,1===e&&I>852||2===e&&I>592)return 1;f=S&d,i[f]=w<<24|b<<16|v-a}}return 0!==S&&(i[v+S]=p-_<<24|64<<16),s.bits=w,0};const{Z_FINISH:Po,Z_BLOCK:No,Z_TREES:Ro,Z_OK:Co,Z_STREAM_END:xo,Z_NEED_DICT:Do,Z_STREAM_ERROR:jo,Z_DATA_ERROR:Bo,Z_MEM_ERROR:Mo,Z_BUF_ERROR:Uo,Z_DEFLATED:Lo}=ea,Fo=16180,zo=16190,qo=16191,Vo=16192,Ho=16194,Jo=16199,Ko=16200,Qo=16206,Zo=16209,Go=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Yo(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wo=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Fo||t.mode>16211?1:0},Xo=e=>{if(Wo(e))return jo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Fo,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Co},$o=e=>{if(Wo(e))return jo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Xo(e)},es=(e,t)=>{let n;if(Wo(e))return jo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?jo:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,$o(e))},ts=(e,t)=>{if(!e)return jo;const n=new Yo;e.state=n,n.strm=e,n.window=null,n.mode=Fo;const r=es(e,t);return r!==Co&&(e.state=null),r};let ns,rs,is=!0;const as=e=>{if(is){ns=new Int32Array(512),rs=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ao(1,e.lens,0,288,ns,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ao(2,e.lens,0,32,rs,0,e.work,{bits:5}),is=!1}e.lencode=ns,e.lenbits=9,e.distcode=rs,e.distbits=5},os=(e,t,n,r)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var ss={inflateReset:$o,inflateReset2:es,inflateResetKeep:Xo,inflateInit:e=>ts(e,15),inflateInit2:ts,inflate:(e,t)=>{let n,r,i,a,o,s,u,c,l,f,d,v,h,p,g,m,y,w,b,_,k,I,S=0;const E=new Uint8Array(4);let T,O;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wo(e)||!e.output||!e.input&&0!==e.avail_in)return jo;n=e.state,n.mode===qo&&(n.mode=Vo),o=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,c=n.hold,l=n.bits,f=s,d=u,I=Co;e:for(;;)switch(n.mode){case Fo:if(0===n.wrap){n.mode=Vo;break}for(;l<16;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,E[0]=255&c,E[1]=c>>>8&255,n.check=Xi(n.check,E,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Zo;break}if((15&c)!==Lo){e.msg="unknown compression method",n.mode=Zo;break}if(c>>>=4,l-=4,k=8+(15&c),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=Zo;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:qo,c=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(n.flags=c,(255&n.flags)!==Lo){e.msg="unknown compression method",n.mode=Zo;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Zo;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=Xi(n.check,E,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,n.check=Xi(n.check,E,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=Xi(n.check,E,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=Xi(n.check,E,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(v=n.length,v>s&&(v=s),v&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+v),k)),512&n.flags&&4&n.wrap&&(n.check=Xi(n.check,r,v,a)),s-=v,a+=v,n.length-=v),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===s)break e;v=0;do{k=r[a+v++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&v<s);if(512&n.flags&&4&n.wrap&&(n.check=Xi(n.check,r,v,a)),s-=v,a+=v,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===s)break e;v=0;do{k=r[a+v++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&v<s);if(512&n.flags&&4&n.wrap&&(n.check=Xi(n.check,r,v,a)),s-=v,a+=v,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Zo;break}c=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=qo;break;case 16189:for(;l<32;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}e.adler=n.check=Go(c),c=0,l=0,n.mode=zo;case zo:if(0===n.havedict)return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=c,n.bits=l,Do;e.adler=n.check=1,n.mode=qo;case qo:if(t===No||t===Ro)break e;case Vo:if(n.last){c>>>=7&l,l-=7&l,n.mode=Qo;break}for(;l<3;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}switch(n.last=1&c,c>>>=1,l-=1,3&c){case 0:n.mode=16193;break;case 1:if(as(n),n.mode=Jo,t===Ro){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Zo}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Zo;break}if(n.length=65535&c,c=0,l=0,n.mode=Ho,t===Ro)break e;case Ho:n.mode=16195;case 16195:if(v=n.length,v){if(v>s&&(v=s),v>u&&(v=u),0===v)break e;i.set(r.subarray(a,a+v),o),s-=v,a+=v,u-=v,o+=v,n.length-=v;break}n.mode=qo;break;case 16196:for(;l<14;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Zo;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.lens[A[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},I=Ao(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,I){e.msg="invalid code lengths set",n.mode=Zo;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[c&(1<<n.lenbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=l);){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(y<16)c>>>=g,l-=g,n.lens[n.have++]=y;else{if(16===y){for(O=g+2;l<O;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(c>>>=g,l-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=Zo;break}k=n.lens[n.have-1],v=3+(3&c),c>>>=2,l-=2}else if(17===y){for(O=g+3;l<O;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}c>>>=g,l-=g,k=0,v=3+(7&c),c>>>=3,l-=3}else{for(O=g+7;l<O;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}c>>>=g,l-=g,k=0,v=11+(127&c),c>>>=7,l-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Zo;break}for(;v--;)n.lens[n.have++]=k}}if(n.mode===Zo)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Zo;break}if(n.lenbits=9,T={bits:n.lenbits},I=Ao(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,I){e.msg="invalid literal/lengths set",n.mode=Zo;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},I=Ao(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,I){e.msg="invalid distances set",n.mode=Zo;break}if(n.mode=Jo,t===Ro)break e;case Jo:n.mode=Ko;case Ko:if(s>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=c,n.bits=l,ko(e,d),o=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,c=n.hold,l=n.bits,n.mode===qo&&(n.back=-1);break}for(n.back=0;S=n.lencode[c&(1<<n.lenbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=l);){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(m&&!(240&m)){for(w=g,b=m,_=y;S=n.lencode[_+((c&(1<<w+b)-1)>>w)],g=S>>>24,m=S>>>16&255,y=65535&S,!(w+g<=l);){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}c>>>=w,l-=w,n.back+=w}if(c>>>=g,l-=g,n.back+=g,n.length=y,0===m){n.mode=16205;break}if(32&m){n.back=-1,n.mode=qo;break}if(64&m){e.msg="invalid literal/length code",n.mode=Zo;break}n.extra=15&m,n.mode=16201;case 16201:if(n.extra){for(O=n.extra;l<O;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[c&(1<<n.distbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=l);){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(!(240&m)){for(w=g,b=m,_=y;S=n.distcode[_+((c&(1<<w+b)-1)>>w)],g=S>>>24,m=S>>>16&255,y=65535&S,!(w+g<=l);){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}c>>>=w,l-=w,n.back+=w}if(c>>>=g,l-=g,n.back+=g,64&m){e.msg="invalid distance code",n.mode=Zo;break}n.offset=y,n.extra=15&m,n.mode=16203;case 16203:if(n.extra){for(O=n.extra;l<O;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Zo;break}n.mode=16204;case 16204:if(0===u)break e;if(v=d-u,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Zo;break}v>n.wnext?(v-=n.wnext,h=n.wsize-v):h=n.wnext-v,v>n.length&&(v=n.length),p=n.window}else p=i,h=o-n.offset,v=n.length;v>u&&(v=u),u-=v,n.length-=v;do{i[o++]=p[h++]}while(--v);0===n.length&&(n.mode=Ko);break;case 16205:if(0===u)break e;i[o++]=n.length,u--,n.mode=Ko;break;case Qo:if(n.wrap){for(;l<32;){if(0===s)break e;s--,c|=r[a++]<<l,l+=8}if(d-=u,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?Xi(n.check,i,d,o-d):Yi(n.check,i,d,o-d)),d=u,4&n.wrap&&(n.flags?c:Go(c))!==n.check){e.msg="incorrect data check",n.mode=Zo;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,c+=r[a++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Zo;break}c=0,l=0}n.mode=16208;case 16208:I=xo;break e;case Zo:I=Bo;break e;case 16210:return Mo;default:return jo}return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,n.hold=c,n.bits=l,(n.wsize||d!==e.avail_out&&n.mode<Zo&&(n.mode<Qo||t!==Po))&&os(e,e.output,e.next_out,d-e.avail_out),f-=e.avail_in,d-=e.avail_out,e.total_in+=f,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?Xi(n.check,i,d,e.next_out-d):Yi(n.check,i,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===qo?128:0)+(n.mode===Jo||n.mode===Ho?256:0),(0===f&&0===d||t===Po)&&I===Co&&(I=Uo),I},inflateEnd:e=>{if(Wo(e))return jo;let t=e.state;return t.window&&(t.window=null),e.state=null,Co},inflateGetHeader:(e,t)=>{if(Wo(e))return jo;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Co):jo},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,a;return Wo(e)?jo:(r=e.state,0!==r.wrap&&r.mode!==zo?jo:r.mode===zo&&(i=1,i=Yi(i,t,n,0),i!==r.check)?Bo:(a=os(e,t,n,n),a?(r.mode=16210,Mo):(r.havedict=1,Co)))},inflateInfo:"pako inflate (from Nodeca project)"};var us=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const cs=Object.prototype.toString,{Z_NO_FLUSH:ls,Z_FINISH:fs,Z_OK:ds,Z_STREAM_END:vs,Z_NEED_DICT:hs,Z_STREAM_ERROR:ps,Z_DATA_ERROR:gs,Z_MEM_ERROR:ms}=ea;function ys(e){this.options=$a({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oo,this.strm.avail_out=0;let n=ss.inflateInit2(this.strm,t.windowBits);if(n!==ds)throw new Error($i[n]);if(this.header=new us,ss.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ro(t.dictionary):"[object ArrayBuffer]"===cs.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=ss.inflateSetDictionary(this.strm,t.dictionary),n!==ds)))throw new Error($i[n])}function ws(e,t){const n=new ys(t);if(n.push(e),n.err)throw n.msg||$i[n.err];return n.result}ys.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?fs:ls,"[object ArrayBuffer]"===cs.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=ss.inflate(n,o),a===hs&&i&&(a=ss.inflateSetDictionary(n,i),a===ds?a=ss.inflate(n,o):a===gs&&(a=hs));n.avail_in>0&&a===vs&&n.state.wrap>0&&0!==e[n.next_in];)ss.inflateReset(n),a=ss.inflate(n,o);switch(a){case ps:case gs:case hs:case ms:return this.onEnd(a),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||a===vs))if("string"===this.options.to){let e=ao(n.output,n.next_out),t=n.next_out-e,i=io(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==ds||0!==s){if(a===vs)return a=ss.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},ys.prototype.onData=function(e){this.chunks.push(e)},ys.prototype.onEnd=function(e){e===ds&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=eo(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bs={Inflate:ys,inflate:ws,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ws(e,t)},ungzip:ws,constants:ea};const{Deflate:_s,deflate:ks,deflateRaw:Is,gzip:Ss}=bo,{Inflate:Es,inflate:Ts,inflateRaw:Os,ungzip:As}=bs;var Ps=Ss,Ns=As,Rs={userId:"u",sessionId:"s",lastEventTime:"let",sessionProperties:"sp",pageviewProperties:"pp",time:"ts",referrer:"r",id:"id",search_keyword:"e",utm:"utm",source:"us",medium:"um",term:"ut",content:"uc",campaign:"ua",initial_pageview_info:"ipi",title:"t",url:"url",domain:"d",path:"h",query:"q",hash:"g",source_properties:"spx",screen_height:"sch",screen_width:"scw",identity:"i"},Cs=function e(t){var n={};return Object.entries(t).forEach((function(t){var i=P(t,2),a=i[0],o=i[1];n[Rs[a]||a]="object"===r(o)&&null!==o?e(o):o})),n},xs=function e(t){if("string"==typeof t)return t;var n={};return Object.entries(t).forEach((function(t){var i=P(t,2),a=i[0],o=i[1],s=Object.keys(Rs).find((function(e){return Rs[e]===a}))||a;n[s]="object"===r(o)&&null!==o?e(o):o})),n};function Ds(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function js(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ds(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ds(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bs=function(e){return e.BASE_64="base64",e.URI="uri",e.UNKNOWN="unknown",e}(Bs||{}),Ms=function(){function e(){var t=this;u(this,e),a(this,"_findHighestLevelDomain",(function(){for(var e="",n=window.location.hostname||"localhost",r="hld"+R(),i="_hp2_".concat(r),a=n.split("."),o=a.length-1;o>=0;o--)t.getItem(i)!==r&&(e=a.slice(o,a.length).join("."),t.setItem(i,r,{expires:15e4,domain:e}));t.setItem(i,r,{expires:-1,domain:e});var s=!e.match(/[a-zA-Z]/),u=e.indexOf(".")<0;return(s||u)&&(e=null),e})),a(this,"setItem",(function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.encodeValue(n),o=function(e){try{return(new TextEncoder).encode(e).length}catch(e){return 0}}(i);if(o>3500)return"Cookie size of ".concat(o," bytes is larger than ").concat(3500," bytes");var s,u="".concat(encodeURIComponent(e),"=").concat(i),c=!1;r&&r.domain||(s=t._findHighestLevelDomain());var l="https:"===document.location.protocol&&ri.getInstance().getEnableSecureCookies(),f=fi(l);f&&(r=js(js({},r),{},a({},"SameSite",f))),r&&Object.keys(r).map((function(e){var t=r[e];if("expires"===e){var n=new Date,i=n.getTime()+ +r.expires;n.setTime(i),t=n.toUTCString()}t&&(u+="; ".concat(e,"=").concat(t)),"path"===e&&(c=!0),"domain"===e&&(s=t)})),c||(u+="; path=/"),s&&(u+="; domain=.".concat(s)),l&&(u+="; secure"),document.cookie=u})),a(this,"getAllCookiesMatching",(function(e,t){for(var n=new RegExp("(^|;)[ ]*"+e+"=([^;]*)","g"),r=[],i=n.exec(t);i;)r.push(i[2]),i=n.exec(t);return r})),a(this,"getItem",(function(e){var n=t.getAllCookiesMatching(e,document.cookie),r=t.decodeValue(n[0]);if(n.length>1&&window.heap.loaded){t.setItem(e,"delete",{expires:-1});var i=t.getAllCookiesMatching(e,document.cookie),a=n.filter((function(e){return!i.includes(e)}));a.length>0&&(r=t.decodeValue(a[0])),r&&t.setItem(e,r)}if(!r)return null;try{var o=JSON.parse(r);return"number"==typeof o?r:xs(o)}catch(e){return r}})),a(this,"hasExpired",(function(e){return new Date>=e})),a(this,"removeItem",(function(e){t.setItem(e,"",{expires:"-60000"})})),a(this,"getShouldCompressCookies",(function(){ri.getInstance().getShouldCompressCookies()})),a(this,"encodeValue",(function(e){var n,r,i,a,o=ri.getInstance().getShouldCompressCookies();if("string"==typeof e){if(n=e,t.isTimestampString(n))return n}else{var s=o?Cs(e):e;n=JSON.stringify(s)}return o?(r=n,i=(new TextEncoder).encode(r),a=Ps(i),btoa(String.fromCharCode.apply(String,w(a)))):encodeURIComponent(n)})),a(this,"decodeValue",(function(e){if(e)return t.detectEncodingType(e)===Bs.BASE_64?function(e){try{for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return Ns(n,{to:"string"})}catch(t){if("incorrect header check"===t)return e;throw t}}(e):t.tryDecodeURIComponent(e)})),a(this,"detectEncodingType",(function(e){return e?/%[0-9A-Fa-f]{2}/.test(e)?Bs.URI:/^[A-Za-z0-9+/=]+$/.test(e)&&e.length%4==0?Bs.BASE_64:Bs.UNKNOWN:Bs.UNKNOWN}))}return l(e,[{key:"tryDecodeURIComponent",value:function(e){try{return decodeURIComponent(e)}catch(t){return decodeURIComponent(e.replace(/%(?![0-9A-Fa-f]{2})/g,"%25"))}}},{key:"isTimestampString",value:function(e){return/^\d{13}$/.test(e)}}]),e}(),Us=function(){function e(){var t=this;u(this,e),a(this,"storage",{}),a(this,"setItem",(function(e,n,r){t.storage[e]=n})),a(this,"getItem",(function(e){return t.storage[e]})),a(this,"removeItem",(function(e){delete t.storage[e]}))}return l(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),Ls="uach_adapter",Fs=function(){var e=t(s().mark((function e(){var t,n,r,i,a,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=["fullVersionList","platformVersion","model"],e.next=3,null===(t=navigator.userAgentData)||void 0===t?void 0:t.getHighEntropyValues(r);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:return a=i.model,o=i.platformVersion,u="",c=/Chromium/.test(navigator.userAgent)?"Chromium":"Chrome",null===(n=i.fullVersionList)||void 0===n||n.forEach((function(e){var t;(null===(t=e.brand)||void 0===t?void 0:t.indexOf(c))>-1&&(u=e.version)})),e.abrupt("return",{model:a,platform_version:o,browser_version:u});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),zs={name:Ls,fn:function(){var e;null!==(e=navigator.userAgentData)&&void 0!==e&&e.getHighEntropyValues||(O.trace("UACH Adapter -- Browser does not contain UACH APIs, resolving adapter"),yd.markAdapterAsResolved(Ls));try{Fs().then((function(e){O.trace("UACH Adapter -- Setting UACH on store",{uach:e}),Pr.getInstance().setUserAgentClientHints(e)})).finally((function(){yd.markAdapterAsResolved(Ls)}))}catch(e){O.error("UACH Adapter -- exception occurred while getting UACH data, resolving adapter",{error:e}),yd.markAdapterAsResolved(Ls)}}},qs=function(){function e(){u(this,e)}return l(e,[{key:"setAPIDependencies",value:function(e){this.coreAPIs=e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),Vs="_hp_ved",Hs=function(e){return e.Telemetry="telemetry",e.StatusUpdate="status",e}({}),Js=function(e){return e.ReceivedInitMessage="received_init_message",e.PreFetchMetadata="pre_fetch_metadata",e.PostFetchMetadata="post_fetch_metadata",e}({});function Ks(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Qs=function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ks(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ks(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=t(e[r]));return n},Zs=function(){function e(){u(this,e),a(this,"_hasInitialized",!1),this._coreApis=qs.getInstance().coreAPIs,this._storage=new Ms,this._metadataStore=Zl.getInstance()}return l(e,[{key:"_noopHeap",value:function(){var e;null===(e=this._coreApis)||void 0===e||e.logger.trace("Visual Labeler - No-oping window.heap"),window.heap=Qs(window.heap,(function(e){return V(e)?function(){}:e}))}},{key:"getFullUrl",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(null===(e=this._coreApis)||void 0===e?void 0:e.getConfig().appServer).concat(t)}},{key:"_loadVLScript",value:function(){var e,t=document.createElement("script");t.type="text/javascript",t.src=this.getFullUrl("/js/ved.js"),document.head.appendChild(t),null===(e=this._coreApis)||void 0===e||e.logger.trace("Visual Labeler - VL Script has been loaded")}},{key:"_loadVLStyles",value:function(){var e;[this.getFullUrl("/css/ved.css"),this.getFullUrl("/js/ved.css")].forEach((function(e){var t=document.createElement("link");t.rel="stylesheet",t.href=e,document.head.appendChild(t)})),null===(e=this._coreApis)||void 0===e||e.logger.trace("Visual Labeler - VL Styles have been loaded")}},{key:"_setVLCookie",value:function(){var e,t;null===(e=this._coreApis)||void 0===e||e.logger.trace("Visual Labeler - Setting VL cookie"),this._storage.setItem(Vs,"on",{expires:18e5}),null===(t=this._coreApis)||void 0===t||t.logger.trace("VisualLabeler - Cookie has been set",a({},Vs,this._storage.getItem(Vs)))}},{key:"_getVLCookie",value:function(){return this._storage.getItem(Vs)}},{key:"_overrideEnvironmentId",value:function(){var e,t=this._metadataStore.getEnvironmentId();this._metadataStore.setEnvironmentId("3407116132"),wd.appid=this._metadataStore.getEnvironmentId(),null===(e=this._coreApis)||void 0===e||e.logger.trace("Visual Labeler - Overriding App ID",{before:{appId:t},after:{appId:wd.appid}})}},{key:"_initializeHeapV",value:function(e){var t;null===(t=this._coreApis)||void 0===t||t.logger.trace("Visual Labeler - Initializing window.heapV for use in the VL"),window.heapV=Object.assign({},window.heap,{source:null==e?void 0:e.source,uri:this.getFullUrl(),loadArgs:null==e?void 0:e.data.args})}},{key:"initialize",value:function(e){var t,n,r,i,a;this._hasInitialized?null===(i=this._coreApis)||void 0===i||i.logger.trace("Visual Labeler - VL has already been initialized. Exiting"):(null===(t=this._coreApis)||void 0===t||t.logger.trace("Visual Labeler - Intializing"),this._hasInitialized=!0,Er.getInstance().recordData("initiateEv","firstLaunch: ".concat(!this._getVLCookie())),this._setVLCookie(),this._overrideEnvironmentId(),null===(n=this._coreApis)||void 0===n||n.logger.trace("Visual Labeler - Flushing event queue"),null===(r=this._coreApis)||void 0===r||r.flushEventQueue(),this._initializeHeapV(e),window.heapV?(this._loadVLScript(),this._loadVLStyles(),this._noopHeap()):null===(a=this._coreApis)||void 0===a||a.logger.trace("Visual Labeler - heapV not initialized. Exiting"))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();function Gs(e){var t=qs.getInstance().coreAPIs,n=null==t?void 0:t.logger;e.origin===(null==t?void 0:t.getConfig().appServer)&&("object"===r(e.data)?"init"===e.data.message?e.source?(null==n||n.trace("Visual Labeler - Init message received"),Ys(e.source),Zs.getInstance().initialize(e),window.removeEventListener("message",Gs,!1)):null==n||n.trace("Visual Labeler - Post message `source` not provided. Exiting",{event:e}):null==n||n.trace('Visual Labeler - Disregarding non "init" post message',{event:e}):null==n||n.trace("Visual Labeler - Post message `data` is not an object. Exiting",{event:e}))}var Ys=function(e){e.postMessage({type:Hs.StatusUpdate,value:Js.ReceivedInitMessage},{targetOrigin:"*"})},Ws=[{adapter:zs,config:{isBlocking:!0,blockDurationInMs:1e3}},{adapter:{name:"visualLabeler",fn:function(e){var t,n,r;qs.getInstance().setAPIDependencies(e),null==(n=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger)||n.trace("Visual Labeler - Listening for postmessage"),window.addEventListener("message",Gs),r=new Ms,window.top===window.self&&r.getItem(Vs)&&Zs.getInstance().initialize()}},config:{isBlocking:!1}}],Xs="contentsquare",$s="hoh-contentsquare",eu=[Xs,$s],tu=["auryc","session_replay",Xs,$s];function nu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ru(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nu(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var iu=5e3,au=function(){function e(){u(this,e),a(this,"startProcessingTime",Number.MAX_SAFE_INTEGER),a(this,"adapters",[]),a(this,"hasProcessingBeenCalled",!1),a(this,"adapterResolvedState",{})}return l(e,[{key:"registerAdapter",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isBlocking:!1};this.hasProcessingBeenCalled||this.adapters.find((function(t){return t.name===e.name}))||(this.adapters.push({name:e.name,adapterFn:e.fn,config:ru(ru({},n),{},{blockDurationInMs:n.blockDurationInMs&&n.blockDurationInMs<iu?n.blockDurationInMs:iu,rerunOnNewPageview:null!==(t=n.rerunOnNewPageview)&&void 0!==t&&t})}),this.adapterResolvedState[e.name]=!n.isBlocking)}},{key:"markAdapterAsResolved",value:function(e){this.adapterResolvedState[e]?O.trace("AdapterRegistry -- adapter has already been resolved, skipping: ".concat(e)):O.trace("AdapterRegistry -- adapter has been resolved: ".concat(e)),this.adapterResolvedState[e]=!0,this.shouldBlockEventProcessing()||Fl.getInstance().flushTemporaryMetadataQueue()}},{key:"_registerIntegrationAdapters",value:function(){var e=this,t=ri.getInstance(),n=t.getIntegrations(),r=t.isSessionReplayDisabled(),i=t.getCsHeapTagStatus();n.forEach((function(t){var n=t.name,a=t.fn,o=t.config;r&&tu.includes(n)?O.debug("AdapterRegistry -- Session replay is disabled, skipping adapter: ",{name:n}):i!==se.HeapSideloadsCS&&eu.includes(n)?O.debug("AdapterRegistry -- Client config override server config: ",{name:n,heapTagStatus:i}):e.registerAdapter({name:n,fn:a},o)}))}},{key:"_registerDefaultClientsideAdapters",value:function(){var e=this;Ws.forEach((function(t){var n=t.adapter,r=t.config;e.registerAdapter(n,r)}))}},{key:"initializeAdapters",value:function(e){this.dependencies=ru(ru({},e),{},{markAdapterAsResolved:this.markAdapterAsResolved.bind(this)}),this.hasProcessingBeenCalled?O.trace("AdapterRegistry - initializeAdapters has already been called, skipping"):(O.trace("AdapterRegistry -- begin adapter initialization"),this._registerIntegrationAdapters(),this._registerDefaultClientsideAdapters(),this.processAdaptersForPageview(this.adapters))}},{key:"shouldBlockEventProcessing",value:function(){return!!this.adapters.length&&(!(this.startProcessingTime+iu<Date.now())&&(!this.hasProcessingBeenCalled||Object.values(this.adapterResolvedState).some((function(e){return!e}))))}},{key:"processAdaptersForPageview",value:function(e){var t=this;this.hasProcessingBeenCalled=!0,this.startProcessingTime=Date.now(),e.forEach((function(e){var r=e.name,i=e.adapterFn,a=e.config;O.trace("AdapterRegistry -- Processing adapter: ",{name:r,adapterFn:i,config:a}),t.adapterResolvedState[r]=!a.isBlocking;try{i(t.dependencies),O.trace("Adapters -- executed ".concat(r))}catch(e){O.trace("Adapters -- Error executing ".concat(r)),t.markAdapterAsResolved(r)}n.g.setTimeout((function(){t.markAdapterAsResolved(r)}),a.blockDurationInMs)}))}},{key:"reprocessAdaptersForNewPageview",value:function(){O.trace("AdapterRegistry -- Reprocessing adapters for new pageview");var e=this.adapters.filter((function(e){return e.config.rerunOnNewPageview}));this.processAdaptersForPageview(e)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),ou=function(){function e(){u(this,e),a(this,"shouldIgnoreBlockingTransformers",!1)}return l(e,[{key:"setShouldIgnoreBlockingTransformers",value:function(e){this.shouldIgnoreBlockingTransformers=e}},{key:"getShouldIgnoreBlockingTransformers",value:function(){return this.shouldIgnoreBlockingTransformers}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),su=function(){function e(){u(this,e),a(this,"isAsync",!1)}return l(e,[{key:"transformAsync",value:function(e){return Promise.resolve(this.transform(e))}},{key:"relay",value:function(e,t){var n=this.getTarget(t);O.trace("Transformer ".concat(this.name," -- relaying messages to ").concat(n.name)),n.transformAndRelay(e,t)}},{key:"transformAndRelay",value:function(e,t){var r,i,a=this,o=e,s=ou.getInstance().getShouldIgnoreBlockingTransformers();if(this.isAsync&&this.transformAsync){if(s)return O.trace("Transformer ".concat(this.name," -- async and unloading, so running transform version of this transformer")),o=this.transform(e),void this.relay(o,t);Promise.race([this.transformAsync(e),(r=5e3,i=e,new Promise((function(e){n.g.setTimeout((function(){e(i)}),r)})))]).then((function(e){a.relay(e,t)}))}else o=this.transform(e),this.relay(o,t)}}]),e}(),uu=function(e){return e.TRACK_EVENT_CONSTRUCTION="TRACK_EVENT_CONSTRUCTION",e.ENTRY="ENTRY",e.EVENT_METADATA_ENRICHMENT="EVENT_METADATA_ENRICHMENT",e.PROPERTY_SANITIZATION="PROPERTY_SANITIZATION",e.EXIT="EXIT",e.ERROR="ERROR",e.SESSION_REPLAY_ENRICHMENT="SESSION_REPLAY_ENRICHMENT",e}({}),cu=function(e){return e.DEFERRED_PROPERTY_ENRICHMENT="DEFERRED_PROPERTY_ENRICHMENT",e.CS_METADATA_HANDSHAKE="CS_METADATA_HANDSHAKE",e.METADATA_EXIT="META_EXIT",e}({}),lu=function(e){return e.IDENTITY_EVENT_CREATION="IDENTITY_EVENT_CREATION",e.IDENTITY_EXIT="IDENTITY_EXIT",e}({}),fu=function(e){return e.ENTRY="ENTRY",e.PROPERTY_SANITIZATION="PROPERTY_SANITIZATION",e.USER_PROPERTIES_EVENT_CREATION="USER_PROPERTIES_EVENT_CREATION",e}({}),du=function(e){return e.GENERAL="general",e.METADATA="metadata",e.IDENTITY="identity",e.ADD_USER_PROPERTIES="addUserProperties",e}({}),vu=function(e){if(O.trace("Executing posthook"),e&&e.length){var t=function(e){var t=0;return e.forEach((function(e){var n=e.data.time;n&&(!t||n>t)&&(t=n)})),t}(e);if(t)Zl.getInstance().updateLastEventTime(t);else O.trace("updateLastEventTimeHook -- Unable to find most recent event time.",{messages:e})}else O.trace("updateLastEventTimeHook -- No events to update last event time against")},hu=function(e){var t=Zl.getInstance();vu(e),t.setIdentity(e[0].data.identity)};function pu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var gu=function(e){p(n,e);var t=pu(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.EXIT),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"relay",value:function(e,t){nf(e,vu)}},{key:"transform",value:function(e){return e}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su),mu=function(){function e(){u(this,e),a(this,"apiQueue",[]),a(this,"onReadyQueue",[]),a(this,"onReadyQueueHasBeenFlushed",!1)}return l(e,[{key:"enqueueHeapApi",value:function(e){O.debug("enqueuing API function",e),this.apiQueue.push(e)}},{key:"enqueueOnReady",value:function(e){O.debug("enqueueOnReady -- enqueuing onReady function",e),this.onReadyQueue.push(e)}},{key:"dequeueHeapApi",value:function(){return this.apiQueue.shift()}},{key:"dequeueOnReady",value:function(){return this.onReadyQueue.shift()}},{key:"executeHeapApiQueue",value:function(){for(;this.apiQueue.length>0;){var e=this.dequeueHeapApi();try{var t;null==e||null===(t=e.fn)||void 0===t||t.call(e)}catch(t){O.warn("FunctionQueue -- exception thrown when executing API callback, ignoring and continuing",{fn:e})}}}},{key:"executeStopTrackingAndStopRecording",value:function(){var e=[];this.apiQueue=this.apiQueue.filter((function(t){return!["stopTracking","stopRecording"].includes(t.name)||(e.push(t),!1)})),e.forEach((function(e){try{e.fn()}catch(t){O.warn("FunctionQueue -- exception thrown when executing stopTracking/stopRecording API callback, ignoring and continuing",{fn:e})}}))}},{key:"executeOnReadyQueue",value:function(){var e=w(this.onReadyQueue);for(O.debug("executeOnReadyQueue -- executing onReady function queue",{queue:e});this.onReadyQueue.length>0;){var t=this.dequeueOnReady();try{var n;null==t||null===(n=t.fn)||void 0===n||n.call(t)}catch(e){O.warn("FunctionQueue -- exception thrown when executing onReady callback, ignoring and continuing",{fn:t})}}this.onReadyQueueHasBeenFlushed=!0}},{key:"getApiQueue",value:function(){return this.apiQueue}},{key:"getOnReadyQueue",value:function(){return this.onReadyQueue}},{key:"getOnReadyQueueHasBeenFlushed",value:function(){return this.onReadyQueueHasBeenFlushed}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),yu=function(){var e=wu();return O.debug("Webview -- checking webview contents",e),!!e},wu=function(){var e,t,n=new Ms,r=(e="wv_id",t=Zl.getInstance().getEnvironmentId(),"_hp2_".concat(e,".").concat(t)),i=n.getItem(r);if(!i)return null;try{return bu(i)?i:null}catch(e){return null}},bu=function(e){return"sessionId"in e&&"userId"in e&&("string"==typeof e.sessionId&&!isNaN(+e.sessionId)&&"string"==typeof e.userId&&!isNaN(+e.userId))},_u=function(){function e(){u(this,e),a(this,"queue",[])}return l(e,[{key:"flushTemporaryIdentifyQueue",value:function(){this.queue.length&&(O.debug("IdentifyMessageQueue -- flushing the temporary identify queue",{queue:this.queue}),this.queue.forEach((function(e){var t=e.identity,n=e.user_id;xl(t,n)})),this.queue=[])}},{key:"queueIdentityEvent",value:function(e,t){Zl.getInstance().getHasMetadataBeenSentToNetwork()?xl(e,t):(O.trace("IdentifyMessageQueue -- blocking identify event until metadata has been sent to network"),this.queue.push({identity:e,user_id:t}))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),ku=function(){var e=Er.getInstance(),t=ri.getInstance().getEnableSecureCookies();!function(){try{return window.self!==window.top}catch(e){return!1}}()?_r(1e5,e.recordData.bind(e),["non-inline frame",t]):_r(100,e.recordData.bind(e),["inline frame",t])};function Iu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Su=function(e){var t=document.createElement("a");if(t.href=e,""===t.host){var n=t.href;t.href=n}var r=t.pathname;if(U(r))return function(e){return U(e)?e.length>0&&"/"===e[0]?e:"/"+e:e}(r)},Eu=function(){var e=document.referrer;if(e)return Dr(e)===window.location.hostname?Su(e):void 0},Tu=function(){var e=M.map((function(e){return"head title[".concat(e,"]")})).join(", ");return!!document.querySelector(e)},Ou=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=Tu(),n=document.title;return t?"****":W(n,e)},Au=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Iu(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Iu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({screen_height:window.innerHeight||0,screen_width:window.innerWidth||0},null==e?void 0:e.source_properties)},Pu="heap_redacted",Nu=1024,Ru="****",Cu="heap-ignore",xu=[Cu,"data-cs-encrypt"],Du=["data-heap-redact-text","data-cs-mask"],ju=["class","data-com.agilebits.onepassword.initial-value","data-com.onepassword.iv","data-ember-action","data-initial-value","data-previous-value","data-react-checksum","data-reactid","id","maxlength","onclick","onsubmit","style"],Bu=1e5,Mu=function(){var e=Er.getInstance();document.querySelector("[".concat(Cu,"]"))&&_r(Bu,e.recordData.bind(e),["heap-ignore-present",1])},Uu=function(){var e=Er.getInstance(),t=(!!ri.getInstance().getIsTextCaptureDisabled()).toString();_r(Bu,e.recordData.bind(e),["disable-text-capture",t])},Lu=function(){var e;Mu(),e=Er.getInstance(),Tu()&&_r(Bu,e.recordData.bind(e),["page-title-redacted",1]),Uu()},Fu=function(){function e(){u(this,e),a(this,"queue",[])}return l(e,[{key:"flushTemporaryAupQueue",value:function(){this.queue.length&&(O.debug("AupMessageQueue -- flushing the temporary AUP queue",{queue:this.queue}),this.queue.forEach((function(e){var t=e.properties;Dl(t)})),this.queue=[])}},{key:"queueAddUserPropertiesEvent",value:function(e){Zl.getInstance().getHasMetadataBeenSentToNetwork()?Dl(e):(O.trace("AupMessageQueue -- blocking aup event until metadata has been sent to network"),this.queue.push({properties:e}))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();function zu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var qu=function(e){var t,n,r,i,a,o,s,u=Zl.getInstance();yu()&&(t=(new Date).getTime()+B,n=u.getSessionId(),s={type:"heapjs-extend-session",sessionId:n,expirationDate:t},null===(r=window.HeapAndroidBridge)||void 0===r||r.postMessage(JSON.stringify(s)),null===(i=window.webkit)||void 0===i||null===(a=i.messageHandlers)||void 0===a||null===(o=a.HeapSwiftBridge)||void 0===o||o.postMessage(s)),u.setHasMetadataBeenSentToNetwork(!0),function(){var e=Er.getInstance();_r(1e4,e.recordData.bind(e),["secure","https:"===document.location.protocol]);try{var t=ri.getInstance().getConfigTelemetry();_r(100,e.recordData.bind(e),["config",t])}catch(e){O.trace("Metadata Request -- error sending config telemetry",{errorMessage:e.message})}try{ku()}catch(t){e.recordError("Failed to record inline frame telemetry",t)}try{Lu()}catch(t){e.recordError("Failed to record sensitive data API telemetry",t)}}(),mu.getInstance().executeOnReadyQueue(),_u.getInstance().flushTemporaryIdentifyQueue(),Fu.getInstance().flushTemporaryAupQueue()},Vu=function(e){p(n,e);var t=zu(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",cu.METADATA_EXIT),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"relay",value:function(e,t){nf(e,qu)}},{key:"transform",value:function(e){return e}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function Hu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ju(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hu(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ku(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Qu=function(e){p(n,e);var t=Ku(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.EVENT_METADATA_ENRICHMENT),a(f(e),"_normalizeEventTimeAgainstPageviewTime",(function(t,n){var r=t.reduce((function(e,t){return t.data.time<e?t.data.time:e}),t[0].data.time);if(r>n)return t;var i=n-r,a=t.map((function(e){var t=e.data.time+i,n=Ju(Ju({},e.data),{},{time:t});return Ju(Ju({},e),{},{data:n})}));return O.trace("Transformer ".concat(e.name," -- normalized event time against pageview time"),{before:t,after:a,pageviewTime:n}),a})),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_enrichMessageWithMetadataContext",value:function(e){var t=Zl.getInstance(),n=t.getMetadata(),r=n.userId,i=n.pageviewId,a=n.pageviewProperties,o=n.sessionProperties,s=n.identity,u=Lr(),c=Fr(),l={env_id:t.getEnvironmentId(),user_id:r,identity:s,base_library:c,device:u,session_info:o,pageview_info:Ju(Ju({},a),{},{id:i})};return Ju(Ju({},e),{},{data:Ju(Ju({},e.data),l)})}},{key:"transform",value:function(e){var t=this,n=Zl.getInstance();if(n.createNewUserIfNeeded(),n.createNewSessionIfNeeded(),n.createNewPageviewIfNeeded(),!n.hasQueuedMetadataEvents())return[];var r=n.getMetadata().pageviewProperties.time,i=this._normalizeEventTimeAgainstPageviewTime(e,r).map((function(e){return t._enrichMessageWithMetadataContext(e)}));return O.trace("Transformer ".concat(this.name," - added metadata context to event messages"),{before:e,after:i}),i}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function Zu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Gu=function(e){p(n,e);var t=Zu(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.EXIT),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"relay",value:function(e,t){nf(e,hu)}},{key:"transform",value:function(e){return e}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function Yu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yu(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var $u=function(e){p(n,e);var t=Xu(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",fu.USER_PROPERTIES_EVENT_CREATION),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_constructUserPropertiesMessage",value:function(e){var t=Zl.getInstance();return Wu(Wu({},e),{},{data:{time:e.info.time,env_id:t.getEnvironmentId(),user_id:t.getUserId(),properties:e.info.properties,device:Lr(),library:Fr()}})}},{key:"transform",value:function(e){if(!e.length||e.length>1)return O.trace("Transformer ".concat(this.name," -- Invalid number of AUP event messages sent, should always expect 1 message"),{messages:e}),[];var t=e[0];if(0===Object.keys(t.info.properties).length)return O.trace("Transformer ".concat(this.name," -- Invalid properties")),Er.getInstance().recordData("addUserProperties - no valid props"),[];var n=this._constructUserPropertiesMessage(t);return O.trace("Transformer ".concat(this.name," -- creating aup event message"),{before:t,after:n}),[n]}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function ec(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ec(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ec(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var rc=function(e){p(n,e);var t=nc(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.PROPERTY_SANITIZATION),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_sanitizeMessages",value:function(e){var t=e.info.properties;if(!t)return e;var n=e;return t&&(n=tc(tc({},e),{},{info:tc(tc({},e.info),{},{properties:e.info.isAutotrack?t:X(t)})})),n}},{key:"transform",value:function(e){var t=this,n=e.map((function(e){return t._sanitizeMessages(e)}));return O.trace("Transformer ".concat(this.name," -- sanitized event messages"),{before:e,after:n}),n}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function ic(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ac(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ic(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ic(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var sc=function(e){return e.APPCUES="appcues",e.CHAMELEON="chameleon",e.SEGMENT="segment",e.CONTENTSQUARE="contentsquare",e.SHOPIFY="shopify",e}({}),uc=function(e){p(n,e);var t=oc(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.TRACK_EVENT_CONSTRUCTION),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_constructSourceName",value:function(e,t){return-1!==e.toLocaleLowerCase().indexOf(sc.CHAMELEON)?sc.CHAMELEON:t}},{key:"constructCustomTrackPayload",value:function(e,t){var n=t?{source_properties:e.info.properties}:{properties:e.info.properties};return{custom:ac({name:e.info.event},e.info.properties&&n)}}},{key:"constructInteractionTrackPayload",value:function(e){return{interaction:ac({},e.info.properties)}}},{key:"_isSupportedSource",value:function(e){return!!e&&Object.values(sc).includes(e.toLowerCase())}},{key:"_constructSourceLibrary",value:function(e,t){var n,r,i,a;return{source_library:ac(ac({},e.info.source),{},{name:t,version:null!==(n=null===(r=e.info.source)||void 0===r?void 0:r.version)&&void 0!==n?n:"0.0.0",platform:null!==(i=null===(a=e.info.source)||void 0===a?void 0:a.platform)&&void 0!==i?i:"web"})}}},{key:"_getSourceInformation",value:function(e){var t,n={isSupported:!1};return n.name=this._constructSourceName(e.info.event,null===(t=e.info.source)||void 0===t?void 0:t.name),n.isSupported=this._isSupportedSource(n.name),n}},{key:"transform",value:function(e){var t=this,n=e.map((function(e){var n,r,i,a,o=e.info.isAutotrack,s=t._getSourceInformation(e);return ac(ac({},e),{},{data:ac(ac(ac({},e.data),(r=null===(n=e.info.properties)||void 0===n?void 0:n.snapshotProperties,i=null!=r?r:{},a=Rr(Rr({},zr()),i),a&&Object.keys(a).length>0?{properties:a}:null)),{},{event:o?t.constructInteractionTrackPayload(e):t.constructCustomTrackPayload(e,s.isSupported)},s.isSupported&&s.name&&t._constructSourceLibrary(e,s.name))})}));return O.trace("Transformer ".concat(this.name," -- populated track event data"),{before:e,after:n}),n}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function cc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var lc=function(e){p(i,e);var n,r=cc(i);function i(){return u(this,i),r.apply(this,arguments)}return l(i,[{key:"transformAsync",value:(n=t(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(JSON.stringify(t)),e.prev=1,e.next=4,this.transformFnAsync(n);case 4:return r=e.sent,O.debug("CustomTransformer ".concat(this.name," -- transformed messages with async call"),{before:t,after:r}),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(1),O.warn("CustomTransformer ".concat(this.name," -- failed to transform message asynchronously, defaulting to original messages"),{error:e.t0}),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return n.apply(this,arguments)})},{key:"transform",value:function(e){var t=JSON.parse(JSON.stringify(e));try{var n=this.transformFn(t);return O.debug("CustomTransformer ".concat(this.name," -- transformed messages"),{before:e,after:n}),n}catch(t){return O.warn("CustomTransformer ".concat(this.name," -- failed to transform message, defaulting to original messages"),{error:t}),e}}},{key:"getTarget",value:function(e){return Ol(e,this.name)}}]),i}(su);function fc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var dc=function(){function e(){var t;u(this,e),a(this,"pipelineToTransformers",(a(t={},du.GENERAL,[]),a(t,du.ADD_USER_PROPERTIES,[]),a(t,du.IDENTITY,[]),a(t,du.METADATA,[]),t))}return l(e,[{key:"registerTransformer",value:function(e,t){var n=t||du.GENERAL;this.pipelineToTransformers[n].find((function(t){return t.name===e.name}))?O.debug("TransformerRegistry -- Transformer already registered",{transformer:e,pipeline:t}):this.pipelineToTransformers[n].push(e)}},{key:"registerTransformerFn",value:function(e,t,n){var r=function(n){p(i,n);var r=fc(i);function i(){var t;return u(this,i),a(f(t=r.call(this)),"name",e),t}return l(i,[{key:"transformFnAsync",value:function(e){throw new Error("Transformer ".concat(this.name," -- only synchronous method should be called"))}},{key:"transformFn",value:function(e){return t(e)}}]),i}(lc);this.registerTransformer(new r,n)}},{key:"registerTransformerFnAsync",value:function(e,n,r){var i=function(r){p(c,r);var i,o=fc(c);function c(){var t;return u(this,c),a(f(t=o.call(this)),"name",e),a(f(t),"isAsync",!0),t}return l(c,[{key:"transformFnAsync",value:(i=t(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"transformFn",value:function(e){throw new Error("Transformer ".concat(this.name," -- only async method should be called"))}}]),c}(lc);this.registerTransformer(new i,r)}},{key:"removeTransformer",value:function(e,t){var n=t||du.GENERAL,r=this.pipelineToTransformers[n].filter((function(t){return t.name!==e||(O.debug("TransformerRegistry -- Transformer removed",{transformerName:e,targetPipeline:n}),!1)}));this.pipelineToTransformers[n]=r}},{key:"resetTransformers",value:function(){var e;this.pipelineToTransformers=(a(e={},du.GENERAL,[]),a(e,du.ADD_USER_PROPERTIES,[]),a(e,du.IDENTITY,[]),a(e,du.METADATA,[]),e)}},{key:"getCustomTransformers",value:function(e){return this.pipelineToTransformers[e]}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();function vc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vc(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var gc=function(e){p(n,e);var t=pc(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",lu.IDENTITY_EVENT_CREATION),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_constructIdentityMessage",value:function(e){var t=Zl.getInstance();return hc(hc({},e),{},{data:{time:e.info.time,identity:e.info.identity,env_id:t.getEnvironmentId(),user_id:e.info.user_id||t.getUserId(),library:Fr()}})}},{key:"transform",value:function(e){if(!e.length||e.length>1)return O.trace("Transformer ".concat(this.name," -- Invalid number of identity event messages sent, should always expect 1 message"),{messages:e}),[];var t=e[0],n=this._constructIdentityMessage(t);return O.trace("Transformer ".concat(this.name," -- creating identity event message"),{before:t,after:n}),[n]}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su);function mc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var yc=function(e){p(n,e);var t=mc(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.ERROR),e}return l(n,[{key:"getTarget",value:function(e){return gu.getInstance()}},{key:"relay",value:function(e,t){O.error("Transformer ".concat(this.name," --  Error transformer reached."),{messages:e,pipeline:t})}},{key:"transform",value:function(e){return[]}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su),wc=function(e){try{var t="";return window._lr_surl_cb&&window._lr_surl_cb((function(e){return t=e})),t?"logrocket:".concat(function(e,t){var n=Su(e);if(!n)throw new Error("No path present on Logrocket session URL");var r=n.split("/"),i=r[1],a=r[2],o=r[4],s=r[5];if(!(i&&a&&o&&s))throw new Error("Invalid path on Logrocket session URL");return encodeURIComponent("".concat(i,"/").concat(a,"/").concat(o,"/").concat(s,"/").concat(t))}(t,e)):void 0}catch(e){return void O.warn("SessionReplay -- failed to parse logrocket string - ".concat(e))}},bc=function(){try{var e,t,n=null===(e=window._uxa)||void 0===e||null===(t=e.push)||void 0===t?void 0:t.call(e,["getSessionData"]);if(!n)return;var r=n.projectId,i=n.userId,a=n.sessionNumber,o=n.pageNumber,s=n.relativeTimestamp;if(!(r&&i&&a&&o))return;return{cs_pid:r.toString(),cs_pvid:o.toString(),cs_sn:a.toString(),cs_ts:null==s?void 0:s.toString(),cs_uu:i.toString()}}catch(e){return}};function _c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ic(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Sc=function(e){p(n,e);var t=Ic(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.SESSION_REPLAY_ENRICHMENT),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_getSessionReplayString",value:function(e){return[function(e){try{if(window.auryc){var t=window.auryc.getSessionMetadata(),n=t.siteId,r=t.sessionId,i=t.sampled,a=t.isOver;if(i&&!a){var o=encodeURIComponent("".concat(n,"/").concat(r,"/").concat(e));return"auryc:".concat(o)}}return}catch(e){return}}(e.data.time),wc(e.data.time),function(){try{var e="",t=bc();if(t){var n=t.cs_pid,r=t.cs_pvid,i=t.cs_sn,a=t.cs_ts,o=t.cs_uu,s=encodeURIComponent("".concat(n,"/").concat(o,"/").concat(i,"/").concat(r,"/").concat(a));e="cs:".concat(s)}return e}catch(e){return""}}()].filter((function(e){return e})).join(";")||void 0}},{key:"_enrichMessageWithSessionReplayContext",value:function(e){var t=this._getSessionReplayString(e),n=bc()||{};return t?kc(kc({},e),{},{data:kc(kc({},e.data),{},{session_replay:t,cs_properties:n})}):e}},{key:"transform",value:function(e){var t=this,n=e.map((function(e){return t._enrichMessageWithSessionReplayContext(e)}));return O.trace("Transformer ".concat(this.name," - added session replay context to event messages"),{before:e,after:n}),n}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su),Ec=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n=function(){var n,r;t&&(null===(r=window.auryc)||void 0===r||r.clearUserCookie(!1));null===(n=window.auryc)||void 0===n||n.addUserProperties({heap_user_id:e})},r=function(){window.clearInterval(a)},i=function(){return!!(window.auryc&&window.auryc.addUserProperties&&window.auryc.clearUserCookie)};if(i())return void n();var a=window.setInterval((function(){i()&&(r(),n())}),500);window.setTimeout(r,5e3)}catch(e){return}},Tc=function(e){Ec(e)};function Oc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Ac=function(e){p(o,e);var r,i=Oc(o);function o(){var e;u(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(f(e=i.call.apply(i,[this].concat(n))),"name",cu.CS_METADATA_HANDSHAKE),a(f(e),"isAsync",!0),a(f(e),"csHasBeenInitialized",!1),e}return l(o,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"waitForAfterPageviewWithTimeout",value:function(){var e=this;return O.trace("Transformer ".concat(this.name," - blocking queue until cs metadata is available")),new Promise((function(t,r){var i,a,o=!1,s=n.g.setTimeout((function(){r(new Error("Transformer ".concat(e.name," -- cant find cs metadata after 2 seconds, proceeding")))}),2e3),u=Date.now();null===(i=window._uxa)||void 0===i||null===(a=i.push)||void 0===a||a.call(i,["afterPageView",function(r){if(!o&&(n.g.clearTimeout(s),r)){o=!0;var i=Date.now()-u;O.trace("Transformer ".concat(e.name," -- cs metadata is available after ").concat(i," ms, proceeding"),{data:r}),t(r)}}])}))}},{key:"setCsHasBeenInitialized",value:function(e){this.csHasBeenInitialized=e}},{key:"getCsHasBeenInitialized",value:function(){return this.csHasBeenInitialized}},{key:"_handleCsTriggers",value:function(e){if(e.some((function(e){return e.type===_.METADATA_USER})))O.trace("Transformer ".concat(this.name," -- user request found, creating new contentsquare user")),O.debug("Contentsquare -- creating new cs user"),null===(f=window._uxa)||void 0===f||f.push(["session:start:newVisitor"]);else if(e.some((function(e){return e.type===_.METADATA_SESSION})))O.trace("Transformer ".concat(this.name," -- session request found, creating new contentsquare session")),ce()&&(O.debug("Contentsquare -- starting cs session"),null===(c=window._uxa)||void 0===c||null===(l=c.push)||void 0===l||l.call(c,["clearSession"]));else{var t,n,r,i,a=e.find((function(e){return e.type===_.METADATA_PAGEVIEW}));if(a)O.trace("Transformer ".concat(this.name," -- pageview request found, creating new contentsquare pageview"),{path:null===(t=a.data.pageview_info)||void 0===t||null===(n=t.url)||void 0===n?void 0:n.path}),o=null===(r=a.data.pageview_info)||void 0===r||null===(i=r.url)||void 0===i?void 0:i.path,ce()&&(O.debug("Contentsquare -- tracking cs pageview",{path:o}),null===(s=window._uxa)||void 0===s||null===(u=s.push)||void 0===u||u.call(s,["trackPageview",o].filter(Boolean)))}var o,s,u,c,l,f}},{key:"_sendHeapContext",value:function(e){var t,n,r,i,a,o,s,u,c,l,f,d,v,h,p,g,m,y,w,b,k,I=e.find((function(e){return e.type===_.METADATA_PAGEVIEW})),S=e.find((function(e){return e.type===_.METADATA_SESSION}));!function(e){var t,n;ve()&&(O.debug("Contentsquare -- sending heap context",{metadata:e}),null===(t=window._uxa)||void 0===t||null===(n=t.push)||void 0===n||n.call(t,["sendHeapContext",e]))}({hrfs:null==S||null===(t=S.data.session_info)||void 0===t?void 0:t.referrer,hsd:null==S||null===(n=S.data.session_info)||void 0===n||null===(r=n.initial_pageview_info)||void 0===r||null===(i=r.url)||void 0===i?void 0:i.domain,hsp:null==S||null===(a=S.data.session_info)||void 0===a||null===(o=a.initial_pageview_info)||void 0===o||null===(s=o.url)||void 0===s?void 0:s.path,hss:null==S||null===(u=S.data.session_info)||void 0===u||null===(c=u.initial_pageview_info)||void 0===c||null===(l=c.url)||void 0===l?void 0:l.query,hsh:null==S||null===(f=S.data.session_info)||void 0===f||null===(d=f.initial_pageview_info)||void 0===d||null===(v=d.url)||void 0===v?void 0:v.hash,hpd:null==I||null===(h=I.data.pageview_info)||void 0===h||null===(p=h.url)||void 0===p?void 0:p.domain,hpp:null==I||null===(g=I.data.pageview_info)||void 0===g||null===(m=g.url)||void 0===m?void 0:m.path,hps:null==I||null===(y=I.data.pageview_info)||void 0===y||null===(w=y.url)||void 0===w?void 0:w.query,hph:null==I||null===(b=I.data.pageview_info)||void 0===b||null===(k=b.url)||void 0===k?void 0:k.hash})}},{key:"transformAsync",value:(r=t(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ve()&&!le()){e.next=3;break}return O.trace("Transformer ".concat(this.name," -- no sideloading with cs, proceeding"),{messages:t}),e.abrupt("return",t);case 3:return e.prev=3,this._sendHeapContext(t),this.getCsHasBeenInitialized()?(O.trace("Transformer ".concat(this.name," -- cs has already been initialized, proceeding")),this._handleCsTriggers(t)):null===(n=window._uxa)||void 0===n||null===(r=n.push)||void 0===r||r.call(n,["startDataCollection"]),e.next=8,this.waitForAfterPageviewWithTimeout();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),O.warn("Transformer ".concat(this.name," -- error on afterPageView callback"),{e:e.t0});case 13:return e.prev=13,this.setCsHasBeenInitialized(!0),e.finish(13);case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this,[[3,10,13,16]])}))),function(e){return r.apply(this,arguments)})},{key:"transform",value:function(e){var t=this;return O.trace("Transformer ".concat(this.name," - executing transform instead")),this.transformAsync(e).catch((function(e){return O.warn("Transformer ".concat(t.name," -- error in transform"),{e:e})})),e}}],[{key:"getInstance",value:function(){return o.instance||(o.instance=new o),o.instance}}]),o}(su),Pc=function(e){return e.Click="click",e.Change="change",e.Submit="submit",e.Pageview="pageview",e}({}),Nc=function(e){return e.Selector="s",e.TextInNearestElement="t",e.JavaScript="j",e.Form="f",e.Attribute="a",e.ElementExists="ex",e.StaticText="st",e}({}),Rc=Object.entries(Nc).reduce((function(e,t){var n=P(t,2),r=n[0];return e[n[1]]=r,e}),{}),Cc=/([\^$*]=)/,xc=/^\[(\S+)=(.*)\]$/,Dc=/^\[([^=*]*)\]$/,jc=function(e,t){return 0===e.length?null:0===t.length?"[".concat(e,"=*]"):"[".concat(e,"=").concat(t,"]")},Bc=function(e){try{var t,n,r,i;if(a=e,Dc.test(a))return(t=Dc.exec(e))&&null!==(n=jc(t[1],"*"))&&void 0!==n?n:e;if(function(e){return Cc.test(e)}(e))return null!==(r=function(e){var t=Cc.exec(e);if(!t)return e;var n=t[0],r=new RegExp("\\[(\\S+)\\"+n+"(.*)\\]").exec(e);if(!r)return e;var i=r[1],a=r[2];switch(n){case"^=":return jc(i,"".concat(a,"*"));case"$=":return jc(i,"*".concat(a));case"*=":return jc(i,"*".concat(a,"*"));default:return e}}(e))&&void 0!==r?r:e;if(function(e){return xc.test(e)}(e))return(t=xc.exec(e))&&null!==(i=jc(t[1],t[2]))&&void 0!==i?i:e}catch(t){return e}var a;return e},Mc=/^([^#.[].*?)?(#.+?)?((?:\..+?)*)((?:\[.*?\])*)$/,Uc=/\s+(?=(?:(?:[^[\]]*[[\]]){2})*[^[\]]*$)/,Lc=/,+(?=(?:(?:[^[\]]*[[\]]){2})*[^[\]]*$)/,Fc=/.*@.*;.*/,zc=function(){function e(){u(this,e),a(this,"_parsedHierarchyParts",{}),a(this,"_parsedSelectorParts",{})}return l(e,[{key:"max",value:function(e){return e.length?Math.max.apply(Math,w(e)):0}},{key:"size",value:function(e){return e.constructor===Object?Object.keys(e).length:e.length}},{key:"_isSubsetOfSuperset",value:function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;for(var n=0;n<e.length;n++)if(!this.wildcardMatchesAny(e[n],t))return!1;return!0}},{key:"_cssScore",value:function(e){var t=0;return e.tag&&(t+=1),e.id&&(t+=1),t+=e.classes.length+e.attrs.length}},{key:"parseCss",value:function(e){return e.indexOf("[")<0?e.trim().split(/\s+/g):e.split(Uc).map((function(e){return e.trim()})).filter(Boolean)}},{key:"cssToObj",value:function(e){var t=P((e.match(Mc)||[]).slice(1),4),n=t[0],r=t[1],i=t[2],a=t[3];return{tag:n,id:r,classes:(i||"").split(".").filter(Boolean).sort(),attrs:(a||"").split("[").filter(Boolean).sort().map((function(e){return"["+e.replace(/"/g,"")})).map(Bc)}}},{key:"wildcardCanShortcut",value:function(e,t){return!e||!t||-1===e.indexOf("*")}},{key:"convertWildcardStringToRegex",value:function(e){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$")}},{key:"wildcardMatchesAny",value:function(e,t){if(t&&!Array.isArray(t))return this.wildcardMatch(e,t);for(var n=0;n<t.length;n++)if(this.wildcardMatch(e,t[n]))return!0;return!1}},{key:"wildcardMatch",value:function(e,t){if(this.wildcardCanShortcut(e,t))return e===t;var n=this.convertWildcardStringToRegex(e);return null!==t.match(n)}},{key:"_singleHierarchyMatchesSelector",value:function(e,t){if("*"===(e=e.replace("**","*").trim()))try{return Fc.exec(t)?1:0}catch(e){return 0}if(!t)return 0;var n=this._parsedSelectorParts[e];if(!n){var r=(n=this._parsedSelectorParts[e]=this.parseCss(e).map(this.cssToObj)).map(this._cssScore);n._score=r.reduce((function(e,t){return e+=t}),0),this.size(this._parsedSelectorParts)>1e4&&(this._parsedSelectorParts={})}var i=this._parsedHierarchyParts[t];i||(i=this._parsedHierarchyParts[t]=t.split("|").map((function(e){return e.split(";").join("").slice(1)})).map(this.cssToObj),this.size(this._parsedHierarchyParts)>1e4&&(this._parsedHierarchyParts={}));for(var a=0,o=i.length,s=n.length,u=0;u<o;u++){var c=i[u];if(a===s)break;var l=n[a],f=!l.tag||this.wildcardMatch(l.tag,c.tag),d=!l.id||this.wildcardMatch(l.id,c.id),v=!l.classes.length||this._isSubsetOfSuperset(l.classes,c.classes),h=!l.attrs.length||this._isSubsetOfSuperset(l.attrs,c.attrs);f&&d&&v&&h&&a++}return a===n.length&&n._score||0}},{key:"splitComboSelector",value:function(e){return e.split(Lc)}},{key:"hierarchyMatchesSelector",value:function(e,t){var n=this;return e.indexOf(",")<0?this._singleHierarchyMatchesSelector(e,t):this.max(this.splitComboSelector(e).map((function(e){return n._singleHierarchyMatchesSelector(e,t)})))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),qc=function(e){var t=e.target;"composed"in e&&"function"==typeof e.composedPath&&(t=e.composedPath()[0]);return t},Vc=function(e){try{return!(!e||"function"!=typeof e.toString)&&"[object ShadowRoot]"===e.toString()}catch(e){return!1}},Hc=function(e){return"[object String]"===Object.prototype.toString.call(e)},Jc=function(e){return!Kc(e)},Kc=function(e){return 1===e.nodeType&&"http://www.w3.org/2000/svg"===e.namespaceURI},Qc=/(.+):nth-of-type\((\d+)\)$/,Zc=/^\w+(\.[-_\w][-_\w\d]+)*(#[-_\w][-_\w\d]+)?$/,Gc=function(e,t){var n=[];e=function(e){if(!e)return null;for(var t=e,n=0;t&&n<200;)Jc(t)&&(e=t),t=t.previousElementSibling||t.previousSibling,n+=1;return e}(e);for(var r=0,i=!Zc.test(t);e&&r<200;)Jc(e)&&e.matches&&e.matches(t)&&(i||Yc(e)===t)&&n.push(e),e=e.nextElementSibling||e.nextSibling,r+=1;return n},Yc=function(e){if(!e||!e.tagName)return null;var t=[e.tagName.toLowerCase()];if(e.classList.length>0)for(var n=Array.from(e.classList),r=0;r<n.length;++r){var i=n[r];t.push("."+i)}return e.type&&"select"!==e.tagName.toLowerCase()&&t.push('[type="'+e.type+'"]'),e.name&&t.push('[name="'+e.name+'"]'),""!==e.id&&"radio"!==e.type&&"checkbox"!==e.type&&t.push("#"+e.id),t.join("")},Wc=function(e){return Qc.test(e)?e.replace(Qc,"$1"):e},Xc=function(e){if(!e||!e.tagName)return null;var t=e.tagName.toLowerCase();if("input"===t){var n=e;switch(n.type){case"checkbox":case"radio":return n.checked;default:return n.value}}else if("select"===t){var r=e;return r.options[r.selectedIndex].text}return nl(e)},$c=function(e){var t=[],n=function n(r,i){i>=50||(r.querySelectorAll(e).forEach((function(e){return t.push(e)})),r.querySelectorAll("*").forEach((function(e){e.shadowRoot&&n(e.shadowRoot,i+1)})))};return document.querySelectorAll(e).forEach((function(e){return t.push(e)})),document.querySelectorAll("*").forEach((function(e){e.shadowRoot&&n(e.shadowRoot,1)})),t},el=function(e,t){for(var n,r,i=t?t.target:document,a=Wc(e),o=function(e){if(Qc.test(e)){var t=e.replace(Qc,"$2");return parseInt(t,10)}return 1}(e),s=0;s<50;){if(r=[],null!==(n=i instanceof HTMLElement&&i.shadowRoot?i.shadowRoot.querySelectorAll(a):i instanceof Document?$c(a):i.querySelectorAll(a))&&n.length>0&&(r=Gc(n[0],a)),1===r.length)return r[0];if(r.length>=o)return r[o-1];if(null===(i=Vc(i.parentNode)?i.parentNode.host:i.parentElement))return null;s+=1}return null},tl=function e(t,n){return t&&"BODY"!==t.tagName&&"HTML"!==t.tagName?n(t)?t:Vc(t.parentNode)?e(t.parentNode.host,n):null===t.parentElement?null:e(t.parentElement,n):null},nl=function(e){return e.innerText||e.textContent||""},rl=function(e){return e&&e.form||il(e)},il=function(e){for(;e&&"tagName"in e&&(void 0===e.tagName||"form"!==e.tagName.toLowerCase());)e=Vc(e.parentNode)?e.parentNode.host:e.parentNode;return e};function al(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ol=function(e,t){return Kc(e)?(sl(e)||[]).filter((function(e){return e.name.length<t&&(e.name.includes("data-")||["aria-label","href"].includes(e.name))})):(sl(e)||[]).filter((function(n){return n.name.length<t&&!("INPUT"===e.tagName&&"value"===n.name)}))},sl=function(e){for(var t=[],n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,a=r.value;e.value&&a===e.value&&"value"!==i&&(a=Pu),t.push({name:i,value:a})}return t},ul=function(e){var t=e.getAttribute("data-heap-redact-attributes");return t?t.split(","):[]},cl=function(e){var t;return((null===(t=window.UXAnalytics)||void 0===t?void 0:t.Sensitive.getSensitiveAttributes(e))||[]).map((function(e){return e.name}))},ll=function(e){var t=w(ju);return e.map((function(e){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?al(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):al(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return t.push.apply(t,w(e.heapRedactedAttributes)),n.attributes=e.attributes.filter((function(e){return-1===t.indexOf(e.name)})),n}))};function fl(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return dl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function dl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var vl=function(){return document},hl=function(e){if(""!==e.id){var t=vl().querySelector("label#".concat(e.id)),n=null==t?void 0:t.textContent;if(n)return n}return e.value},pl=function(e){switch(e.tagName.toLowerCase()){case"input":var t=e;switch(t.type){case"date":case"email":return function(e){return e.validity.valid?e.value:null}(t);case"password":return"****";case"checkbox":return function(e){var t="input[type=checkbox][name=".concat(e.name,"]"),n=vl().querySelectorAll(t),r=Array.from(n);if(r.length>1){var i,a=[],o=fl(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;s instanceof HTMLInputElement&&s.checked&&a.push(s.value)}}catch(e){o.e(e)}finally{o.f()}return a.join(",")}return e.checked?"true":"false"}(t);case"radio":return function(e){for(var t=vl().querySelectorAll("input[type=radio][name=".concat(e.name,"]")),n=0;n<t.length;n++){var r=t[n];if(r.checked)return hl(r)}return e.checked?"true":"false"}(t);default:return function(e){return e.value}(t)}case"textarea":return function(e){var t=e.value;return t.length>64?t.slice(0,64):t}(e);case"select":return function(e){var t=e.options[e.selectedIndex];return t.value?new RegExp(/^[^\w]/).test(t.value)&&t.value===t.innerHTML?null:t.value:null}(e);default:return"N/A"}},gl=function(e){return U(e)?W(e.trim(),x):e},ml=function(e){try{var t=e();return gl(t)}catch(e){throw new Error(e.message)}},yl=function(e){return{f:function(t){var n=el(t,e);if(!n)return"N/A";var r=pl(n);return gl(r)},t:function(t){var n,r=(n=el(t,e),Xc(n));return gl(r)},s:function(e){var t=$c(e);if(t){var n=Xc(t[0]);return gl(n)}},j:function(e){return ml(e)},a:function(t){var n=el(t.target,e),r=null==n?void 0:n.getAttribute(t.attribute);return r?function(e,t,n,r){if(e&&(null==e?void 0:e.value)===r||(null==t?void 0:t.value)===r)return Pu;var i=ul(t),a=["value"].concat(w(i),w(ju.filter((function(e){return"id"!==e&&"class"!==e}))));return he()&&a.push.apply(a,w(cl(t))),a.includes(n)?Pu:r.length>x?W(r,x):r}(null==e?void 0:e.target,n,t.attribute,r):"N/A"},ex:function(t){return!!el(t,e)},st:function(e){return ml(e)}}},wl=new Map,bl=function(e,t){var n,r=null===(n=ri.getInstance().getConfig().snapshots)||void 0===n?void 0:n[e];if(r){var i,a,o=(i=function(e,t){var n=[];for(var i in r)if("pageview"===e)_l(i,t)&&n.push(r[i]);else{var a=Wc(i);zc.getInstance().hierarchyMatchesSelector(a,t)>0&&n.push(r[i])}return n},a=function(e,t){return e+"."+t},function(){var e=a?a.apply(void 0,arguments):arguments.length<=0?void 0:arguments[0];if(wl.has(e))return wl.get(e);var t=i.apply(void 0,arguments);return wl.set(e,t),t})(e,t);return O.debug("Snapshots -- ".concat(e," definitions for ").concat(t),{snapshotConfig:r,eventType:e,capturedElement:t,snapshots:o}),o}O.debug("Snapshots -- no config found for ".concat(e," snapshots"))},_l=function(e,t){var n;if(""!==e)try{n=encodeURIComponent(t);var r=new RegExp("^"+e.replace(/\*/g,".*")+"$");return r.test(t)||r.test(n)}catch(e){return O.warn("Snapshots - error encoding pageview path",e),!1}return!1},kl=function(e,t){if(e){t=t||window.event;var n=yl(t),r=Object.values(Nc).map((function(t){var r=n[t];if(r){var i=e.map((function(e){return e[t]})).map((function(e){var n,i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a))try{var o=e[a],s=r(o);void 0!==s&&(i[a]=s)}catch(e){O.warn("Snapshots -- Error extracting ".concat(a),{propertyName:a,type:(n=t,Rc[n]),errorMessage:e.message})}return i})).filter((function(e){return 0!==Object.keys(e).length}));return i}})).flat(),i=r.reduce((function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}),{}),a=i?X(i):{};return O.trace("Snapshots -- properties",{snapshotProperties:a}),a}};function Il(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Il(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Il(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function El(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Tl=function(e){p(n,e);var t=El(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",cu.DEFERRED_PROPERTY_ENRICHMENT),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"_getSetPathInfo",value:function(){var e,t=null!==(e=Zl.getInstance().getMetadata().setPath)&&void 0!==e?e:{},n=t.path,r=t.query,i=t.hash;if(n||r||i)return{path:n,query:r,hash:i}}},{key:"_getPageviewSnapshots",value:function(e){if(e){var t=bl(Pc.Pageview,e);return kl(t)}}},{key:"_enrichUserMessages",value:function(e){var t,n,r,i,a,o,s=Zl.getInstance(),u=jr(),c=Lr(),l=this._getSetPathInfo(),f=this._getPageviewSnapshots(null===(t=e.data.user.initial_session_info.initial_pageview_info)||void 0===t||null===(n=t.url)||void 0===n?void 0:n.path),d=Sl(Sl(Sl({},null===(r=e.data.user.initial_session_info.initial_pageview_info)||void 0===r?void 0:r.properties),null===(i=s.getPageviewMetadata())||void 0===i||null===(a=i.pageviewProperties)||void 0===a?void 0:a.properties),f);return Sl(Sl({},e),{},{data:Sl(Sl({},e.data),{},{device:c,user:Sl(Sl({},e.data.user),{},{initial_session_info:Sl(Sl({},e.data.user.initial_session_info),{},{search_keyword:Br(u),referrer:u,initial_pageview_info:Sl(Sl({},e.data.user.initial_session_info.initial_pageview_info),{},{id:e.data.user.initial_session_info.initial_pageview_info.id,time:e.data.user.initial_session_info.initial_pageview_info.time,properties:d,url:Sl(Sl({},null===(o=e.data.user.initial_session_info.initial_pageview_info)||void 0===o?void 0:o.url),l)})})})})})}},{key:"_enrichSessionMessages",value:function(e){var t,n,r,i,a,o,s=Zl.getInstance(),u=jr(),c=Lr(),l=this._getSetPathInfo(),f=this._getPageviewSnapshots(null===(t=e.data.session_info.initial_pageview_info)||void 0===t||null===(n=t.url)||void 0===n?void 0:n.path),d=Sl(Sl(Sl({},null===(r=e.data.session_info.initial_pageview_info)||void 0===r?void 0:r.properties),null===(i=s.getPageviewMetadata())||void 0===i||null===(a=i.pageviewProperties)||void 0===a?void 0:a.properties),f);return Sl(Sl({},e),{},{data:Sl(Sl({},e.data),{},{device:c,session_info:Sl(Sl({},e.data.session_info),{},{search_keyword:Br(u),referrer:u,initial_pageview_info:Sl(Sl({},e.data.session_info.initial_pageview_info),{},{id:e.data.session_info.initial_pageview_info.id,time:e.data.session_info.initial_pageview_info.time,properties:d,url:Sl(Sl({},null===(o=e.data.session_info.initial_pageview_info)||void 0===o?void 0:o.url),l)})})})})}},{key:"_enrichPageviewMessages",value:function(e,t){var n,r,i,a,o,s,u,c,l=Zl.getInstance(),f=jr(),d=Lr(),v=this._getSetPathInfo(),h=this._getPageviewSnapshots(null===(n=e.data.pageview_info)||void 0===n||null===(r=n.url)||void 0===r?void 0:r.path),p=Sl(Sl(Sl({},e.data.pageview_info.properties),null===(i=l.getPageviewMetadata())||void 0===i||null===(a=i.pageviewProperties)||void 0===a?void 0:a.properties),h);return Sl(Sl({},e),{},{data:Sl(Sl(Sl({},e.data),{},{device:d},t>1&&{session_info:Sl(Sl({},e.data.session_info),{},{search_keyword:Br(f),referrer:f,initial_pageview_info:Sl(Sl({},e.data.session_info.initial_pageview_info),{},{id:e.data.session_info.initial_pageview_info.id,time:e.data.session_info.initial_pageview_info.time,properties:p},!(null!==(o=e.data.overridePageviewInfo)&&void 0!==o&&o.url)&&{url:Sl(Sl({},null===(s=e.data.pageview_info)||void 0===s?void 0:s.url),v)})})}),{},{pageview_info:Sl(Sl({},e.data.pageview_info),{},{properties:p},!(null!==(u=e.data.overridePageviewInfo)&&void 0!==u&&u.url)&&{url:Sl(Sl({},null===(c=e.data.pageview_info)||void 0===c?void 0:c.url),v)})})})}},{key:"_enrichMessages",value:function(e,t){var n=Sl({},e);switch(e.type){case _.METADATA_USER:n=this._enrichUserMessages(e);break;case _.METADATA_SESSION:n=this._enrichSessionMessages(e);break;case _.METADATA_PAGEVIEW:n=this._enrichPageviewMessages(e,t);break;default:n=e}return O.trace("Transformer ".concat(this.name," - enriched ").concat(e.type),{before:e,after:n}),n}},{key:"transform",value:function(e){var t=this,n=Zl.getInstance(),r=e.map((function(n){return t._enrichMessages(n,e.length)}));return n.updateMetadataStoreWithMetadataEvents(r),n.deleteSetPathIfExpired(),O.trace("Transformer ".concat(this.name," - added metadata context to event messages"),{before:e,after:r}),r}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su),Ol=function(e,t){var n=function(e){var t=[Nl.getInstance(),Qu.getInstance(),Sc.getInstance(),rc.getInstance(),uc.getInstance()],n=[gu.getInstance()],r=[Tl.getInstance(),Ac.getInstance(),Sc.getInstance()],i=[Vu.getInstance()],a=[gc.getInstance()],o=[Gu.getInstance()],s=[Nl.getInstance(),rc.getInstance(),$u.getInstance()],u=[gu.getInstance()],c=[],l=[],f=dc.getInstance().getCustomTransformers(e);return e===du.GENERAL?(c=t,l=n):e===du.METADATA?(c=r,l=i):e===du.IDENTITY?(c=a,l=o):e===du.ADD_USER_PROPERTIES&&(c=s,l=u),[].concat(w(c),w(f),w(l))}(e),r=n.findIndex((function(e){return e.name===t}));return-1===r?(O.trace("Source transformer not found.",{sourceTransformerName:t,pipeline:e}),yc.getInstance()):r===n.length-1?gu.getInstance():n[r+1]};function Al(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Pl,Nl=function(e){p(n,e);var t=Al(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"name",uu.ENTRY),e}return l(n,[{key:"getTarget",value:function(e){return Ol(e,this.name)}},{key:"transform",value:function(e){return e}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(su),Rl=function(){if(!ri.getInstance().getShouldStopTracking()){O.trace("Begin flushing all messages for processing"),Fl.getInstance().flushTemporaryMetadataQueue();var e=tf();e&&e.length?(O.debug("Flushing the following messages into general event pipeline",e),Nl.getInstance().transformAndRelay(e,du.GENERAL)):O.debug("No messages queued in the EPQ - terminating")}},Cl=function(e){ri.getInstance().getShouldStopTracking()||Tl.getInstance().transformAndRelay(e,du.METADATA)},xl=function(e,t){ri.getInstance().getShouldStopTracking()||gc.getInstance().transformAndRelay([{type:k.CORE_IDENTIFY_v3,id:R(),info:{identity:e,user_id:t,time:(new Date).getTime()}}],du.IDENTITY)},Dl=function(e){ri.getInstance().getShouldStopTracking()||Nl.getInstance().transformAndRelay([{type:k.CORE_ADD_USER_PROPERTIES,id:R(),info:{properties:e,time:(new Date).getTime()}}],du.ADD_USER_PROPERTIES)},jl=function(){ri.getInstance().getShouldStopTracking()||(Pl=n.g.setInterval((function(){var e=ef();e.length&&(O.debug("Sending events from the event processing queue to transformers",{messages:e}),Nl.getInstance().transformAndRelay(e,du.GENERAL))}),2e3))};function Bl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ml(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bl(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ul=function(){function e(){u(this,e)}return l(e,[{key:"_createUserEventMessage",value:function(e){var t=e.time,n=e.userId,r=e.sessionId,i=e.pageviewId,a=Zl.getInstance(),o=Fr();return{time:t,id:n,user_id:n,identity:a.getIdentity()||"",base_library:o,env_id:a.getEnvironmentId(),user:{time:t,id:n,identity:a.getIdentity(),initial_session_info:{time:t,id:r,utm:Mr(),initial_pageview_info:{time:t,id:i,url:Ur(),source_properties:Au()}}}}}},{key:"_createSessionEventMessage",value:function(e){var t=e.time,n=e.sessionId,r=e.userId,i=e.pageviewId,a=Zl.getInstance(),o=Fr(),s=null!=r?r:a.getUserId();return{time:t,id:n,env_id:a.getEnvironmentId(),user_id:s,identity:a.getIdentity()||"",base_library:o,session_info:{time:t,id:n,utm:Mr(),initial_pageview_info:{time:t,id:i,title:Ou(),previous_page:Eu(),url:Ur(),source_properties:Au()}},session:{}}}},{key:"_createPageviewEventMessage",value:function(e){var t,n=e.time,r=e.pageviewId,i=e.sessionMessage,a=e.userId,o=e.overridePageviewInfo,s=Zl.getInstance(),u=null!=a?a:s.getUserId(),c=i?i.session_info:s.getMetadata().sessionProperties,l=Fr();return Ml({time:n,id:r,env_id:s.getEnvironmentId(),user_id:u,identity:s.getIdentity()||"",base_library:l,session_info:c,pageview_info:Ml({time:n,id:r,url:Ur(),title:Ou(),previous_page:Eu(),source_properties:Au(o)},o),pageview:{},properties:null!==(t=zr())&&void 0!==t?t:{}},o&&{overridePageviewInfo:o})}},{key:"createMetadataEvents",value:function(e){if(!e)return[];var t=[],n=e.type,r=e.id,i=e.overrideProps,a=(null==i?void 0:i.time)||(new Date).getTime();if(n===_.METADATA_USER){O.debug("MetadataEventCreation -- Creating user + session + pageview message.");var o=r,s=R(),u=R(),c={type:_.METADATA_USER,id:o,data:this._createUserEventMessage({time:a,userId:o,sessionId:s,pageviewId:u})},l=this._createSessionEventMessage({time:a,sessionId:s,userId:o,pageviewId:u});t=[c,{type:_.METADATA_SESSION,id:s,data:l},{type:_.METADATA_PAGEVIEW,id:u,data:this._createPageviewEventMessage({time:a,pageviewId:u,sessionMessage:l,userId:o,overridePageviewInfo:null==i?void 0:i.pageviewInfo})}]}else if(n===_.METADATA_SESSION){O.debug("MetadataEventCreation -- Creating session + pageview message.");var f=r,d=R(),v=this._createSessionEventMessage({time:a,sessionId:f,pageviewId:d});t=[{type:_.METADATA_SESSION,id:f,data:v},{type:_.METADATA_PAGEVIEW,id:d,data:this._createPageviewEventMessage({time:a,pageviewId:d,sessionMessage:v,overridePageviewInfo:null==i?void 0:i.pageviewInfo})}]}else if(n===_.METADATA_PAGEVIEW){O.debug("MetadataEventCreation -- Creating pageview message");var h=r;t=[{type:_.METADATA_PAGEVIEW,id:h,data:this._createPageviewEventMessage({time:a,pageviewId:h,overridePageviewInfo:null==i?void 0:i.pageviewInfo})}]}return O.trace("MetadataEventCreation -- creating metadata events",{before:e,after:t}),t}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();function Ll(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Fl=function(){function e(){u(this,e),a(this,"queue",[])}return l(e,[{key:"flushTemporaryMetadataQueue",value:function(){this.getQueueLength()&&(O.debug("MetadataMessageQueue -- flushing the temporary metadata queue",{queue:this.queue}),Cl(this.queue),this.queue=[])}},{key:"addToMetadataQueue",value:function(e){var t,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ll(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ll(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.queue);(t=this.queue).push.apply(t,w(e)),O.trace("MetadataMessageQueue -- added messages to queue",{after:this.queue,before:n})}},{key:"getQueueLength",value:function(){return this.queue.length}},{key:"queueMetadataEvent",value:function(e,t,r){var i=this;this.getQueueLength()>0&&this.flushTemporaryMetadataQueue();var a=Ul.getInstance().createMetadataEvents({type:e,id:t,overrideProps:r});au.getInstance().shouldBlockEventProcessing()?(this.addToMetadataQueue(a),O.trace("MetadataMessageQueue -- blocking metadata event until adapters are resolved",{type:e,metadataMessages:a}),n.g.setTimeout((function(){O.trace("MetadataMessageQueue -- 5 seconds has passed, flushing regardless of adapter state"),i.flushTemporaryMetadataQueue()}),iu)):Cl(a)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),zl=["lastEventTime"],ql=["properties","source_properties"];function Vl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vl(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Jl=["pageviewId","pageviewProperties"],Kl=["userId","sessionId","identity","lastEventTime","sessionProperties","setPath"],Ql={expires:j},Zl=function(){function e(t,n){var r=this;u(this,e),a(this,"envId",""),a(this,"_sessionExpirationTime",B),a(this,"_ephemeralStorage",Us.getInstance()),a(this,"_metadataMessageQueue",Fl.getInstance()),a(this,"hasUserBeenQueued",!1),a(this,"hasSessionBeenQueued",!1),a(this,"hasPageviewBeenQueued",!1),a(this,"hasCheckedCrossDomainContext",!1),a(this,"hasMetadataBeenSentToNetwork",!1),a(this,"newUserCreatedCounter",0),a(this,"newSessionCreatedCounter",0),a(this,"truncateLargeCookie",(function(e){var t,n,r,i,a,o,s,u,c,l,f,d,v,h,p,g;return Hl(Hl({},e),{},{sessionProperties:Hl(Hl({},e.sessionProperties),{},{referrer:W(null!==(t=null===(n=e.sessionProperties)||void 0===n?void 0:n.referrer)&&void 0!==t?t:"",D),search_keyword:W(null!==(r=null===(i=e.sessionProperties)||void 0===i?void 0:i.search_keyword)&&void 0!==r?r:"",D),utm:X(null!==(a=null===(o=e.sessionProperties)||void 0===o?void 0:o.utm)&&void 0!==a?a:{}),initial_pageview_info:Hl(Hl({},null===(s=e.sessionProperties)||void 0===s?void 0:s.initial_pageview_info),{},{title:W(null!==(u=null===(c=e.sessionProperties)||void 0===c||null===(l=c.initial_pageview_info)||void 0===l?void 0:l.title)&&void 0!==u?u:"",D),url:X(null!==(f=null===(d=e.sessionProperties)||void 0===d||null===(v=d.initial_pageview_info)||void 0===v?void 0:v.url)&&void 0!==f?f:{}),previous_page:W(null!==(h=null===(p=e.sessionProperties)||void 0===p||null===(g=p.initial_pageview_info)||void 0===g?void 0:g.previous_page)&&void 0!==h?h:"",D)})})})})),a(this,"_reduceToIdMetadataVals",(function(e){var t,n,r,i,a,o;return Hl(Hl({},e),{},{sessionProperties:{id:null===(t=e.sessionProperties)||void 0===t?void 0:t.id,time:null===(n=e.sessionProperties)||void 0===n?void 0:n.time,initial_pageview_info:{id:null===(r=e.sessionProperties)||void 0===r||null===(i=r.initial_pageview_info)||void 0===i?void 0:i.id,time:null===(a=e.sessionProperties)||void 0===a||null===(o=a.initial_pageview_info)||void 0===o?void 0:o.time}}})})),a(this,"updateMetadataStoreWithMetadataEvents",(function(e){if(r.hasQueuedMetadataEvents())O.trace("MetadataStore -- hasQueuedMetadataEvents, exiting");else{var t,n,i,a={};e.forEach((function(e){var r=e.id,o=e.type,s=e.data,u=s.time||0;o===_.METADATA_USER?(t=r,a=Hl(Hl({},a),{},{userId:r})):o===_.METADATA_SESSION?(n=r,a=Hl(Hl({},a),{},{sessionId:r,lastEventTime:u,sessionProperties:s.session_info})):o===_.METADATA_PAGEVIEW&&(i=r,a=Hl(Hl({},a),{},{pageviewId:r,pageviewProperties:s.pageview_info,lastEventTime:u}))})),O.trace("MetadataStore -- Updating metadata store",{metadataObject:a}),r.setMetadata(a),t&&(O.trace("Metadata Request -- User event has been enqueued."),r.setHasUserBeenQueued(!0)),n&&(O.trace("Metadata Request -- Session event has been enqueued."),r.setHasSessionBeenQueued(!0)),i&&(O.trace("Metadata Request -- Pageview event has been enqueued."),r.setHasPageviewBeenQueued(!0))}})),t&&(this.envId=t),n&&(this.storageType=n),this._persistentStorage=this._getStorageType()}return l(e,[{key:"canAccessStorage",value:function(){var e="hld"+R(),t="_hp2_".concat(e);return this._persistentStorage.setItem(t,"test"),!!this._persistentStorage.getItem(t)&&(this._persistentStorage.removeItem(t),!0)}},{key:"_isStorageBlocked",value:function(){return ri.getInstance().getShouldStopTracking()}},{key:"_getStorageType",value:function(){var e=ri.getInstance().getMetadataStorageType(),t=this.storageType||e;return(null==t?void 0:t.toLowerCase())===I.LOCAL_STORAGE?new ye:new Ms}},{key:"_getStorageKey",value:function(){return"".concat("_hp5_meta",".").concat(this.getEnvironmentId())}},{key:"_getLastEventTimeKey",value:function(){return"".concat("_hp5_let",".").concat(this.getEnvironmentId())}},{key:"_extractPersistentMetadata",value:function(e){var t={};return Object.entries(e).forEach((function(e){var n=P(e,2),r=n[0],i=n[1];Kl.includes(r)&&i&&(t[r]=i)})),t}},{key:"_extractEphemeralMetadata",value:function(e){var t={};return Object.entries(e).forEach((function(e){var n=P(e,2),r=n[0],i=n[1];Jl.includes(r)&&i&&(t[r]=i)})),t}},{key:"hasQueuedMetadataEvents",value:function(){return this.hasPageviewBeenQueued&&this.hasSessionBeenQueued&&this.hasUserBeenQueued}},{key:"setMetadata",value:function(e){if(!this._isStorageBlocked()){var t=this.getMetadata(),n=this._extractEphemeralMetadata(t),r=this._extractPersistentMetadata(t),i=this._extractEphemeralMetadata(e),a=this._extractPersistentMetadata(e),o=Hl(Hl({},r),a),s=o.lastEventTime,u=A(o,zl),c=Hl(Hl({},n),i),l=r.lastEventTime||0;(s&&!l||l&&s>=l)&&(this._updateLastEventTimeToOwnStorageKey(s)||(O.trace("MetadataStore -- Failed to set lastEventTime in its own cookie, falling back to adding to metadata"),u.lastEventTime=s)),this._writePersistentMetadata(u)||O.trace("MetadataStore -- Updated metadata values in persistent storage",{before:r,after:u}),this._ephemeralStorage.setItem(this._getStorageKey(),c,Ql),O.trace("Updated metadata values in ephemeral storage",{before:n,after:c});var f=new Ae;f.shouldWriteToV4()&&f.updateMetadata(o)}}},{key:"_removeCustomPropsFromInitialPv",value:function(e){if(!e.sessionProperties||!e.sessionProperties.initial_pageview_info)return e;var t=e.sessionProperties.initial_pageview_info,n=(t.properties,t.source_properties,A(t,ql)),r=Hl(Hl({},e),{},{sessionProperties:Hl(Hl({},e.sessionProperties),{},{initial_pageview_info:Hl({},n)})});return O.trace("MetadataStore -- removing custom properties from initial pageview",{after:r,before:e}),r}},{key:"_writePersistentMetadata",value:function(e){var t;O.trace("MetadataStore -- attempting to update metadata values without alterations");var n=this._removeCustomPropsFromInitialPv(e);if(t=this._persistentStorage.setItem(this._getStorageKey(),n,Ql)){O.debug("MetadataStore -- persistent values larger than max cookie size, attempting truncation");var r=this.truncateLargeCookie(n);if(t=this._persistentStorage.setItem(this._getStorageKey(),r,Ql)){O.debug("MetadataStore -- truncated values larger than max cookie size, setting ids");var i=this._reduceToIdMetadataVals(n);t=this._persistentStorage.setItem(this._getStorageKey(),i,Ql)}}return t&&O.error("MetadataStore -- Unable to update persistent values after truncation and reducing to ids"),t}},{key:"getMetadata",value:function(){var e=this._getStorageKey(),t=this._persistentStorage.getItem(e),n=this._ephemeralStorage.getItem(e),r=this._getLastEventTimeFromOwnStorageKey();return t&&r&&(t.lastEventTime=+r),Hl(Hl({},t),n)}},{key:"deletePersistentMetadata",value:function(){var e=this._getStorageKey(),t=this._getLastEventTimeKey();this._persistentStorage.removeItem(e),this._persistentStorage.removeItem(t)}},{key:"clearPageviewMetadata",value:function(){var e=this._getStorageKey();this._ephemeralStorage.removeItem(e),this.setHasPageviewBeenQueued(!1)}},{key:"clearMetadata",value:function(){var e=this._getStorageKey(),t=this._getLastEventTimeKey();this._persistentStorage.removeItem(e),this._persistentStorage.removeItem(t),this._ephemeralStorage.removeItem(e),this.setHasSessionBeenQueued(!1),this.setHasUserBeenQueued(!1),O.debug("Cleared metadata values in persistent storage")}},{key:"lastEventTimeKey",get:function(){return this._getLastEventTimeKey()}},{key:"lastEventTime",get:function(){var e;return null!==(e=this._getLastEventTimeFromOwnStorageKey())&&void 0!==e?e:this.getMetadata().lastEventTime}},{key:"_getLastEventTimeFromOwnStorageKey",value:function(){var e=this._persistentStorage.getItem(this.lastEventTimeKey);return e?+e:void 0}},{key:"setLastEventTimeInMetadata",value:function(e){if(!this._isStorageBlocked()){var t=this.getMetadata(),n=this._extractPersistentMetadata(t),r=Hl(Hl({},n),{},{lastEventTime:e});this._writePersistentMetadata(r)||O.trace("MetadataStore -- Updated metadata values in persistent storage",{before:n,after:r})}}},{key:"updateLastEventTime",value:function(e){if(e){O.trace("Updating lastEventTime to ".concat(e)),this._updateLastEventTimeToOwnStorageKey(e)||(O.trace("MetadataStore -- Failed to set lastEventTime in its own cookie, falling back to adding to metadata"),this.setLastEventTimeInMetadata(e));var t,n,r=new Ae;r.shouldWriteToV4()&&r.updateSessionPropsExpiration(e),ce()&&(O.debug("Contentsquare -- extending cs session"),null===(t=window._uxa)||void 0===t||null===(n=t.push)||void 0===n||n.call(t,["extendSessionV2"]))}else O.warn("Invalid lastEventTime passed to metadata store")}},{key:"_updateLastEventTimeToOwnStorageKey",value:function(e){return this._persistentStorage.setItem(this.lastEventTimeKey,e.toString(),Ql),this._getLastEventTimeFromOwnStorageKey()===e}},{key:"getPageviewMetadata",value:function(){var e=this.getMetadata();return{pageviewId:e.pageviewId,pageviewProperties:e.pageviewProperties}}},{key:"getSessionId",value:function(){var e;return null===(e=this.getMetadata())||void 0===e?void 0:e.sessionId}},{key:"getUserId",value:function(){var e;return null===(e=this.getMetadata())||void 0===e?void 0:e.userId}},{key:"getIdentity",value:function(){var e;return null===(e=this.getMetadata())||void 0===e?void 0:e.identity}},{key:"setIdentity",value:function(e){this.setMetadata({identity:e})}},{key:"setEnvironmentId",value:function(e){this.envId="".concat(e)}},{key:"getEnvironmentId",value:function(){if(!this.envId)throw O.error("Environment ID is missing"),new Error("heap environment id is missing");return this.envId}},{key:"getHasUserBeenQueued",value:function(){return this.hasUserBeenQueued}},{key:"getHasSessionBeenQueued",value:function(){return this.hasSessionBeenQueued}},{key:"setHasUserBeenQueued",value:function(e){this.hasUserBeenQueued=e}},{key:"setHasSessionBeenQueued",value:function(e){this.hasSessionBeenQueued=e}},{key:"setHasPageviewBeenQueued",value:function(e){this.hasPageviewBeenQueued=e}},{key:"setMetadataStateFromCrossDomainContextIfPresent",value:function(){if(!this._isStorageBlocked()&&!this.hasCheckedCrossDomainContext){this.hasCheckedCrossDomainContext=!0;var e=function(){try{var e=new URL(window.location.href).searchParams.get("_hp5_cdc");if(!e)return{};var t=P(e.split(";"),5);return{envId:t[0],userId:t[1],sessionId:t[2],sessionStartTime:t[3],identity:t[4]}}catch(e){return O.error("getCrossDomainMetadata -- failed to parse metadata from URL, defaulting to normal logic"),{}}}(),t=e.envId,n=e.userId,r=e.sessionId,i=e.identity,a=e.sessionStartTime;if(this.getEnvironmentId()===t&&n&&r)return O.debug("MetadataStore -- cross domain userid found, overriding current user"),this.setMetadata({userId:n,sessionId:r,identity:i,sessionProperties:{id:r,time:parseInt(a,10)},lastEventTime:(new Date).getTime()}),this.setHasUserBeenQueued(!0),this.setHasSessionBeenQueued(!0),void Tc(n)}}},{key:"setMetadataStateFromWebviewIfPresent",value:function(){if(!this._isStorageBlocked()&&yu()){var e,t=null!==(e=wu())&&void 0!==e?e:{},n=t.userId,r=t.sessionId,i=t.identity;if(n&&r)return O.debug("MetadataStore -- webview userid found, overriding current user"),this.setMetadata({userId:n,sessionId:r,identity:i,sessionProperties:{id:r,time:(new Date).getTime()},lastEventTime:(new Date).getTime()}),this.setHasUserBeenQueued(!0),this.setHasSessionBeenQueued(!0),void Tc(n)}}},{key:"getPageviewProperties",value:function(){var e;return null===(e=this.getMetadata())||void 0===e?void 0:e.pageviewProperties}},{key:"getCustomPageviewProperties",value:function(){var e;return null===(e=this.getMetadata())||void 0===e?void 0:e.pageviewProperties.properties}},{key:"addCustomPageviewProperties",value:function(e){var t=this.getPageviewProperties(),n=Hl(Hl({},null==t?void 0:t.properties),e);this.setMetadata({pageviewProperties:Hl(Hl({},t),{},{properties:n})})}},{key:"removeCustomPageviewProperty",value:function(e){var t=Hl({},this.getCustomPageviewProperties());delete t[e],O.debug("Removed custom pageview property ".concat(e," from storage"),{before:this.getCustomPageviewProperties(),after:t});var n=this.getPageviewProperties();this.setMetadata({pageviewProperties:Hl(Hl({},n),{},{properties:t})})}},{key:"clearCustomPageviewProperties",value:function(){var e=this.getPageviewProperties();O.debug("MetadataStore -- clearing custom pageview properties"),this.setMetadata({pageviewProperties:Hl(Hl({},e),{},{properties:{}})})}},{key:"clearEventPropertiesIfNeeded",value:function(){var e=ri.getInstance().getClearEventPropertiesOnNewUser(),t=Ar.getInstance();e&&(O.debug("MetadataStore -- Clearing event properties"),t.clearProperties())}},{key:"createNewUserIfNeeded",value:function(e){var t=this.getMetadata().userId;if(!t||null!=e&&e.newUserId&&t!==e.newUserId||!J(t)){var n;this.clearEventPropertiesIfNeeded(),this.setHasUserBeenQueued(!1),this.setHasSessionBeenQueued(!1),this.setHasPageviewBeenQueued(!1);var r=null!==(n=null==e?void 0:e.newUserId)&&void 0!==n?n:R();null!=e&&e.identity&&xl(e.identity,r),this._metadataMessageQueue.queueMetadataEvent(_.METADATA_USER,r,null==e?void 0:e.overrideProps),rf(),function(e){Ec(e,!0)}(r),this.incrementNewUserCreated()}else this.setHasUserBeenQueued(!0),Tc(t)}},{key:"incrementNewUserCreated",value:function(){this.newUserCreatedCounter++,this.newUserCreatedCounter>2&&(O.warn("MetadataStore -- new user created more than twice",{newUsersCreated:this.newUserCreatedCounter}),Er.getInstance().recordData("metadataTelemetry - new user created more than twice",{count:this.newUserCreatedCounter,url:Ur()}))}},{key:"createNewSessionIfNeeded",value:function(e){if(this.hasUserBeenQueued){var t=this.getMetadata(),n=t.sessionId,r=t.sessionProperties,i=!1;this.hasSessionExpired()?(O.debug("MetadataStore -- session has expired, creating new session"),i=!0):n?J(n)?n!==(null==r?void 0:r.id)?(O.debug("MetadataStore -- session id and session properties don't match, creating new session",{sessionId:n,sessionProperties:r}),i=!0):r.time||(O.debug("MetadataStore -- malformed session, creating new session",{sessionId:n,sessionProperties:r}),i=!0):(O.debug("MetadataStore -- session id is not a number, creating new session"),i=!0):(O.debug("MetadataStore -- missing session id, creating new session"),i=!0),i?(this.setHasSessionBeenQueued(!1),this._metadataMessageQueue.queueMetadataEvent(_.METADATA_SESSION,R(),e),rf(),this.incrementNewSessionCreated()):this.setHasSessionBeenQueued(!0)}}},{key:"incrementNewSessionCreated",value:function(){this.newSessionCreatedCounter++,this.newSessionCreatedCounter>2&&(O.warn("MetadataStore -- new session created more than twice",{newsessionsCreated:this.newSessionCreatedCounter}),Er.getInstance().recordData("medatadaTelemetry - new session created more than twice",{count:this.newSessionCreatedCounter,url:Ur()}))}},{key:"createNewPageviewIfNeeded",value:function(e){if(this.hasUserBeenQueued&&this.hasSessionBeenQueued){var t=this.getMetadata().pageviewId;O.trace("MetadataStore -- createNewPageviewIfNeeded -- ",{pageviewId:t}),t&&J(t)?this.setHasPageviewBeenQueued(!0):(this.setHasPageviewBeenQueued(!1),this._metadataMessageQueue.queueMetadataEvent(_.METADATA_PAGEVIEW,R(),e))}}},{key:"hasSessionExpired",value:function(){if(yu())return!1;var e=this.getMetadata().lastEventTime;return!e||e+this._sessionExpirationTime<(new Date).getTime()}},{key:"deleteSetPathIfExpired",value:function(){var e;(null===(e=this.getMetadata().setPath)||void 0===e?void 0:e.lifespan)===pe.OnNextPageviewOnly&&this.setMetadata({setPath:{path:void 0,query:void 0,hash:void 0,lifespan:void 0}})}},{key:"setHasMetadataBeenSentToNetwork",value:function(e){this.hasMetadataBeenSentToNetwork=e}},{key:"getHasMetadataBeenSentToNetwork",value:function(){return this.hasMetadataBeenSentToNetwork}},{key:"setTemporaryReferrer",value:function(e){this.temporaryReferrer=e}},{key:"getTemporaryReferrer",value:function(){return this.temporaryReferrer}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),Gl=function(e){return e.EVENT_PROCESSING_QUEUE="_hp5_epq",e}({}),Yl=function(){function e(){u(this,e),a(this,"_replacerFunc",(function(){var e=new WeakSet;return function(t,n){if("object"===r(n)&&null!==n){if(e.has(n))return;e.add(n)}return n}}))}return l(e,[{key:"_getQueueIdentifier",value:function(){return"".concat(this.queueName,".").concat(Zl.getInstance().getEnvironmentId())}},{key:"_getQueuedMessages",value:function(){var e,t;return JSON.parse(null!==(e=null===(t=this.storage)||void 0===t?void 0:t.getItem(this._getQueueIdentifier()))&&void 0!==e?e:"[]")}},{key:"_getMessageIds",value:function(e){return e.map((function(e){return e.id}))}},{key:"_syncPersistentStorage",value:function(e){this.storage&&this.storage.setItem(this._getQueueIdentifier(),JSON.stringify(e,this._replacerFunc()))}},{key:"enqueueMessages",value:function(e){var t=this._getQueuedMessages(),n=this._getMessageIds(t),r=e.filter((function(e){var t=e.id;return!n.includes(t)}));t=[].concat(w(t),w(r)),this._syncPersistentStorage(t)}},{key:"dequeueMessages",value:function(e){var t=this._getQueuedMessages(),n=this._getMessageIds(e);this.bufferedIds=this.bufferedIds.filter((function(e){return!n.includes(e)})),t=t.filter((function(e){var t=e.id;return!n.includes(t)})),this._syncPersistentStorage(t)}},{key:"clearStorage",value:function(){var e;null===(e=this.storage)||void 0===e||e.removeItem(this._getQueueIdentifier())}},{key:"clearBuffer",value:function(){this.bufferedIds=[]}},{key:"getMessagesToProcess",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=this._getQueuedMessages().filter((function(t){var n=t.id;return!e.bufferedIds.includes(n)})).slice(0,t);return this.bufferedIds=[].concat(w(this.bufferedIds),w(this._getMessageIds(n))),n.length&&O.trace("".concat(this.queueName," - getting messages for processing"),n),n}}]),e}();function Wl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}var Xl,$l=function(e){p(n,e);var t=Wl(n);function n(){var e;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return a(f(e=t.call.apply(t,[this].concat(i))),"queueName",Gl.EVENT_PROCESSING_QUEUE),a(f(e),"bufferedIds",[]),a(f(e),"storage",Us.getInstance()),e}return l(n,[{key:"_isQueueBlocked",value:function(){var e=Zl.getInstance(),t=au.getInstance();try{e.getEnvironmentId()}catch(e){return!0}return ri.getInstance().getShouldStopTracking()?(O.debug("EventProcessingQueue - blocked, shouldStopTracking is true"),!0):e.getHasMetadataBeenSentToNetwork()?!!t.shouldBlockEventProcessing()&&(O.debug("EventProcessingQueue - blocked, waiting for adapter initialization to complete"),!0):(O.debug("EventProcessingQueue - blocked, waiting for metadata events to be queued"),!0)}},{key:"getMessagesToProcess",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return this._isQueueBlocked()?(O.debug("".concat(this.queueName," - blocked, waiting for unblock before processing")),[]):v(d(n.prototype),"getMessagesToProcess",this).call(this,e)}},{key:"getAndClearAllMessages",value:function(){var e=v(d(n.prototype),"getMessagesToProcess",this).call(this,Number.MAX_SAFE_INTEGER);return this.clearStorage(),this.clearBuffer(),e}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(Yl),ef=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return $l.getInstance().getMessagesToProcess(e)},tf=function(){return $l.getInstance().getAndClearAllMessages()},nf=function(e,t){if(e&&e.length){O.debug("Queue - enqueueing messages for networking and dequeueing from event processing after transformation",e);var n=Er.getInstance();$l.getInstance().dequeueMessages(e),n.addMessages(e),t&&t(e)}},rf=function(){$l.getInstance().clearBuffer()},af=function(e){return Array.from(new Uint8Array(e)).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},of=function(){var e=t(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=af,e.next=3,crypto.subtle.digest(t,n);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),sf=["undefined","anonymous","true","false","not_authenticated","NaN","NA","Na","unique_identifier","0","",'""',"[object Object]","{{ customer.email }}","{{ email }}",/^email$/i,/^none$/i,/^unknown$/i,/^guest$/i,/^null$/i,"hashed_user_id"],uf=function(e){return!(!e||!U(e)&&!L(e)||L(e)&&!isFinite(e)||function(e){for(var t=0,n=sf;t<n.length;t++){var r=n[t];if("string"==typeof r&&e===r)return!0;if(r instanceof RegExp&&r.test(e))return!0}return!1}("".concat(e)))},cf=function(){var e=t(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,of("SHA-256",(new TextEncoder).encode("".concat(t)));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lf=function(e,t){return"heap_autotrack"===e&&!U(t)&&"autotrack"===(null==t?void 0:t.name)},ff=function(e,t,n){return!!lf(e,n)||!(e&&!function(e){return!(!U(e)||!H(e,D))}(e)||t&&!function(e){return!!z(e)}(t)||n&&!function(e){return U(e)?!!H(e,D):!(!U(e.name)||!H(e.name,D)||e.version&&!U(e.version)||e.version&&!H(e.version,D)||e.platform&&!U(e.platform)||e.platform&&!H(e.platform,D))}(n))},df=function(e,t){var n=!1;return function(){if(!n){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];e.apply(undefined,i),n=!0,window.setTimeout((function(){n=!1}),t)}}},vf=function(e){if(z(e)){var t=function(e){var t={};return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&!V(e[t])&&!q(e[t])})).forEach((function(n){z(e[n])?t[n]=Jr(e[n]):t[n]=e[n]})),t}(e),n={};Object.keys(t).forEach((function(e){var r=t[e];U(r)&&""===r||(n[e]=r)}));var r=[];return Object.keys(n).forEach((function(e){r.push(e,t[e].toString())})),r}return[]},hf=(a(Xl={},Wn.Identify,"/api/capture/v2/identify"),a(Xl,Wn.Track,"/api/capture/v2/track"),a(Xl,Wn.AUP,"/api/capture/v2/add_user_properties"),a(Xl,Wn.Telemetry,"/api/telemetry"),Xl),pf=function(){function e(n){var r=this;u(this,e),a(this,"_recordThrottler",df((function(e){new Image(1,1).src=e}),500)),a(this,"sendEvent",(function(e,t){return r.sendRequest(e,r.fullUrlPath(hf[Wn.Track]),t)})),a(this,"sendAUP",(function(e,t){return r.sendRequest(e,r.fullUrlPath(hf[Wn.AUP]),t)})),a(this,"sendIdentify",(function(e,t){return r.sendRequest(e,r.fullUrlPath(hf[Wn.Identify]),t)})),a(this,"sendRequest",function(){var e=t(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.trace("CollectorNetworkClient -- Attempting send to ".concat(n)),e.prev=1,!r){e.next=6;break}return fetch(n,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:t}),O.debug("CollectorNetworkClient -- Fired off a request before unload",{payload:t}),e.abrupt("return",{ok:!1,statusCode:null});case 6:return e.next=8,fetch(n,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:t});case 8:return i=e.sent,a=i.ok,400===i.status&&(O.warn("CollectorNetworkClient -- Bad request to ".concat(n),{payload:t}),a=!0),o={ok:a,statusCode:i.status},O.trace("CollectorNetworkClient -- Response for send to ".concat(n),o),e.abrupt("return",o);case 16:return e.prev=16,e.t0=e.catch(1),e.abrupt("return",{ok:!1,statusCode:null});case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t,n,r){return e.apply(this,arguments)}}()),a(this,"sendTelemetry",(function(e){try{if(!z(e))return;var t=(a=!1,o="",s=0,u=[],c=function(e){try{return encodeURIComponent(e)}catch(t){if(t instanceof URIError)return encodeURIComponent(e.slice(0,-1));throw t}},l=function(e){return null==e||""===e},f=function(e,t){return l(t)?"":"&"+c(e)+"="+c(t)},d=function(e){var t,n;n="";var r=a?s++:"";for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=e[t];if(Array.isArray(i))for(var o=i.length%2==0,u=0;u<i.length;u++){var c=u%2==0,d=u+1<i.length&&l(i[u+1]);o&&c&&d?u+=1:n+=f(t+r,i[u])}else n+=f(t+r,i)}return n},{addSingleEventProps:function(e){var t=d(e);t.length+o.length>3900&&(u.push(o),o="",s=0,t=d(e)),o+=t},build:function(e){if(!e)return o.slice(1);u.push(o);for(var t=0;t<u.length;t++)u[t]=u[t].slice(1);return u}});t.addSingleEventProps({te:vf(e)});var n=t.build(!1),i=r._buildBaseTelemetryUrl(n);r._recordThrottler(i)}catch(e){O.trace("CollectorNetworkClient -- Error sending telemetry",e)}var a,o,s,u,c,l,f,d})),this.apiUrl=n}return l(e,[{key:"fullUrlPath",value:function(e){return"".concat(this.apiUrl).concat(e)}},{key:"_buildBaseTelemetryUrl",value:function(e){var t=Zl.getInstance().getEnvironmentId(),n=ri.getInstance(),r="https://c.us.heap-api.com"===this.apiUrl?"https://heapanalytics.com":this.apiUrl;return"".concat(r).concat(hf[Wn.Telemetry])+"?a="+t+"&"+e+"&st="+(new Date).getTime()+"&hv="+n.getSdkVersion()+"&ld="+n.getLibraryDomain()}}]),e}(),gf=pf,mf=function(e,t){O.debug("enqueueing Heap API call because heap is not loaded");var n={name:e,fn:t};mu.getInstance().enqueueHeapApi(n)},yf=function(e,t){O.debug("enqueueing onReady callback because heap is not loaded");var n={name:e,fn:t};mu.getInstance().enqueueOnReady(n)},wf=function(){!function(){var e=ri.getInstance(),t=e.getIntegrations(),n=e.isSessionReplayDisabled();if(t&&0!==t.length){O.trace("Integrations -- loading");var r=au.getInstance().dependencies;t.forEach((function(e){try{if(n&&tu.includes(e.name))return void O.trace("Integrations -- Skipping session replay adapter: ",{integration:e.name});e.fn(r),O.trace("Integrations -- executed ".concat(e.name))}catch(t){O.trace("Integrations -- Error executing ".concat(e.name))}}))}}(),au.getInstance().reprocessAdaptersForNewPageview()};function bf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var _f=function(){wd.loaded&&Rl()},kf=function(){Zl.getInstance().createNewSessionIfNeeded({time:(new Date).getTime()})},If=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Zl.getInstance();t.clearPageviewMetadata(),wf(),t.createNewPageviewIfNeeded(e)},Sf=function(){var e=Zl.getInstance();return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bf(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({envId:e.getEnvironmentId()},e.getMetadata())},Ef=function(){wd.loaded&&(ou.getInstance().setShouldIgnoreBlockingTransformers(!0),_f(),Rf(!0))},Tf=function(e){if(wd.loaded){var t=Zl.getInstance();t.lastEventTime+B<(new Date).getTime()?O.trace("updateLastEventTime -- session expired, ignoring"):t.updateLastEventTime(e)}},Of=function(e){var t=Zl.getInstance(),n=X(e);n&&t.addCustomPageviewProperties(n)},Af=function(e){Zl.getInstance().setTemporaryReferrer(e)},Pf=!1,Nf=function(){var e=function(){try{if(!wd.loaded||Pf)return;O.debug("Unload -- processing all messages in event processing queue"),Ef()}catch(e){Er.getInstance().recordError("Error in onUnloadHandler.",e)}};document.addEventListener("beforeunload",e,!0),document.addEventListener("visibilitychange",(function(){br()?(Pf=!1,Er.getInstance().flushBufferOnInterval(),ou.getInstance().setShouldIgnoreBlockingTransformers(!1)):e()}),!0),document.addEventListener("pagehide",e,!0)},Rf=function(e){var t=Er.getInstance();if(O.trace("flushNetworkQueue -- number of buffered network events is ".concat(t.getBufferSize())),t.flushBufferOnUnload(),e&&(Pf=!0,t.getBufferSize())){var n=(new Date).getTime(),r=n;do{r=(new Date).getTime()}while(r<n+60)}};function Cf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cf(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Df=function(e){try{var t=new URL(e,window.location.origin);return{domain:t.hostname,path:t.pathname,query:me(t.search),hash:me(t.hash)}}catch(t){return void O.warn("Error parsing URL ".concat(e,":"),t)}},jf="_cs_optout",Bf=function(){return(new Ms).getItem(jf)?(O.debug("".concat(jf," was found in cookies")),!0):new URLSearchParams(window.location.search).has(jf)?(O.debug("".concat(jf," was found in query")),!0):!!window.location.hash.includes(jf)&&(O.debug("".concat(jf," was found in hash")),!0)},Mf=function(e){return e?e.replace(/[[\];|\n]/g,""):e},Uf=function(e,t){return e.map((function(e){return{name:Mf(e.name),value:e.value&&e.value.length<=t?Mf(e.value):""}}))};function Lf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ff(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var zf=function(e,t){if(!Hc(e)||(n=t,"[object Number]"!==Object.prototype.toString.call(n)))return e;var n,r,i="",a=0,o=Lf(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.codePointAt(0),c=u&&u>65535?2:1;if(!(a+c<=t))break;i+=s,a+=c}}catch(e){o.e(e)}finally{o.f()}return i},qf=function(e,t){if(Jf(e)||ve()&&function(e){var t;return null===(t=window.UXAnalytics)||void 0===t?void 0:t.Sensitive.isNodeSensitive(e)}(e))return Ru;var n=nl(e),r=Vf(e),i=Hf(r);return Kf(n,i,t)},Vf=function(e){var t=xu.map((function(e){return"[".concat(e,"]")})),n=Array.prototype.slice.call(e.querySelectorAll(t.join(","))),r=Du.map((function(e){return"[".concat(e,"]")})),i=Array.prototype.slice.call(e.querySelectorAll(r.join(",")));return n.concat(i)},Hf=function(e){return e.map(nl)},Jf=function(e){return!!tl(e,(function(e){return Du.some((function(t){return e.hasAttribute(t)}))}))},Kf=function(e,t,n){var r=function(e){return e.sort((function(e,t){return e.length>=t.length?-1:1}))}(t.map((function(e){return e.trim()}))),i=e;if(r.forEach((function(e){var t;e&&(i=(t={originalText:i,substringToReplace:e,replacementText:Ru}).originalText.replace(new RegExp(t.substringToReplace.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"g"),t.replacementText))})),he()){var a=new oe,o=a.anonymizePII(i);i=a.anonymizeCreditCard(o)}return i=function(e,t){return Hc(e)?e=zf(e.trim(),t):e}(i,n),i},Qf=function(e,t){return e.findIndex((function(e){return e.name===t}))};function Zf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Gf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gf(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Gf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Yf=function(e){var t;return e.length>1?(null===(t=qs.getInstance().coreAPIs)||void 0===t||t.logger.trace("Autocapture -- removing BODY node"),e.filter((function(e){return"body"!==e.tagName.toLowerCase()}))):e},Wf=function(e,t,n){var r=Yf(e);if(0===r.length)return r;var i=function(e){for(var t=-1,n=-1,r=0;r<e.length;r++){var i=e[r],a=Qf(i.attributes,"href")>-1;if(-1===t&&a&&(t=r),(n=i.heapRedactedAttributes.indexOf("href")>-1?r:-1)>-1)break}return function(){if(-1!==t){if(n>=t)return Ru;var r=e[t].attributes;return r[Qf(r,"href")].value}}()}(r);r[0].href=zf(i,Nu);var a=function(e,t){var n,r,i=e,a=null===(n=qs.getInstance().coreAPIs)||void 0===n?void 0:n.getConfig();return!(null!=a&&null!==(r=a.privacy)&&void 0!==r&&r.disableTextCapture)&&"change"!==t&&!i.isContentEditable&&"textarea"!==i.tagName.toLowerCase()&&Hc(nl(i))}(t,n);return r[0].targetText=a?qf(t,64):"",r},Xf=function(e){for(var t,n=e.maxAttributeLength,r=e.targetElement,i=[];r&&"HTML"!==r.tagName;){var a=Jc(t=r)||Kc(t)?ol(r,n):[],o=$f(r),s=ed(r),u=ul(r);if(ve()){var c,l=null!==(c=cl(r))&&void 0!==c?c:[];u=[].concat(w(u),w(l))}var f={tagName:r.tagName.toLowerCase(),id:Mf(o),classes:s.map(Mf),attributes:Uf(a,n),heapRedactedAttributes:u};i.push(f),r=Vc(r.parentNode)?r.parentNode.host:r.parentElement}return i.reverse()},$f=function(e){return rd(e,"id")||null},ed=function(e){return nd(e)?nd(e).split(/\s+/):[]},td=function(e){var t,n=e.topFirstDecomposedHierarchy,r=e.maxHierarchyLength,i="",a=Zf(Yf(n).reverse());try{for(a.s();!(t=a.n()).done;){var o=t.value,s="";s="@".concat(o.tagName,";"),s+=o.id?"#".concat(o.id,";"):"",s+=o.classes.length>0?".".concat(o.classes.sort().join(";."),";"):"";var u=o.attributes.map((function(e){return"[".concat(e.name,"=").concat(e.value,"]")})).sort();if(s+=u.length>0?"".concat(u.join(";"),";"):"",(s+="|").length+i.length>r){var c;null===(c=qs.getInstance().coreAPIs)||void 0===c||c.logger.debug("Autocapture -- truncating hierarchy string as it exceeds ".concat(r));break}i=s+i}}catch(e){a.e(e)}finally{a.f()}return i},nd=function(e){return((Kc(e)?e.className?e.className.baseVal:e.getAttribute("class"):e.className)||"").trim()},rd=function(e,t){return"form"===e.tagName.toLowerCase()?e.getAttribute(t)||"":e[t]},id=function(e){return e.BUILTIN_KIND_CLICK="BUILTIN_KIND_CLICK",e.BUILTIN_KIND_CHANGE="BUILTIN_KIND_CHANGE",e.BUILTIN_KIND_SUBMIT="BUILTIN_KIND_SUBMIT",e}({}),ad=function(){function e(){u(this,e),a(this,"eventHistory",[]),a(this,"clickEventHistory",[])}return l(e,[{key:"addClickEvent",value:function(t){e.isClickEvent(t)&&(this.clickEventHistory.length>e.MAX_CLICK_HISTORY_SIZE&&this.clickEventHistory.shift(),this.clickEventHistory.push({coordinates:{X:t.clientX,Y:t.clientY},time:t.timeStamp}))}},{key:"addEvent",value:function(t){this.eventHistory.length>e.MAX_HISTORY_SIZE&&this.eventHistory.shift(),this.eventHistory.push(t),this.addClickEvent(t)}},{key:"hasMatchingEvent",value:function(e){return this.eventHistory.includes(e)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"resetEventHistory",value:function(){e.instance=new e}},{key:"isClickEvent",value:function(e){return e instanceof MouseEvent}}]),e}();a(ad,"MAX_HISTORY_SIZE",20),a(ad,"MAX_CLICK_HISTORY_SIZE",5);var od=function(){var e=ad.getInstance().clickEventHistory,t=e[e.length-1],n=e[0];return!(t.time-n.time>3e3)},sd=function(){for(var e=ad.getInstance().clickEventHistory,t=0,n=0;n<e.length-1;n++)for(var r=n+1;r<=e.length-1;r++){var i=Math.round(Math.sqrt(Math.pow(e[n].coordinates.X-e[r].coordinates.X,2)+Math.pow(e[n].coordinates.Y-e[r].coordinates.Y,2)));if(i>t&&(t=i),i>100)return!1}return!0},ud=function(e){var t=ad.getInstance().clickEventHistory;return!!(ad.isClickEvent(e)&&t.length>=5)&&(od()&&sd())},cd=function(e){return{click:id.BUILTIN_KIND_CLICK,change:id.BUILTIN_KIND_CHANGE,submit:id.BUILTIN_KIND_SUBMIT}[e]},ld=function(e){var t={};return ud(e)&&(t.rage_click=!0),t},fd=function(e){var t,n,r=qc(e),i="mouseup"===e.type?"click":e.type,a=function(e){var t=e.targetElement,n=e.type,r=e.maxAttributeLength,i=e.maxHierarchyLength,a=Xf({targetElement:t,maxAttributeLength:r}),o=JSON.parse(JSON.stringify(a)),s=ll(a),u=td({topFirstDecomposedHierarchy:s,maxHierarchyLength:i}),c=Wf(o.reverse(),t,n);return{hierarchyString:u,topFirstNodes:ll(c.reverse())}}({targetElement:r,type:i,maxAttributeLength:255,maxHierarchyLength:Nu}),o=a.hierarchyString,s=a.topFirstNodes,u=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.getSnapshotDefinitions(i,o),c=null===(n=qs.getInstance().coreAPIs)||void 0===n?void 0:n.getSnapshotProperties(u,e),l=function(e,t){if(JSON.stringify(e).length<=t)return e;for(var n=[],r="",i=0;i<e.length;i++){var a=e[i],o=JSON.stringify(a);if(r.length+o.length>t)break;n.push(a),r+=o}return n}(s.reverse(),2048);return{kind:cd(i),hierarchy:o,nodes:l,source_properties:ld(e),snapshotProperties:c}},dd=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger,i=e.target;if(("mousedown"===e.type||"mousemove"===e.type)&&!n)return!0;if(!i)return null==r||r.trace("Autocapture -- event missing a target, ignoring",{event:e}),!0;if(!i.tagName)return null==r||r.trace("Autocapture -- event target is missing a tagName, ignoring",{event:e}),!0;if(3===i.nodeType)return null==r||r.trace("Autocapture -- event target is a text node, ignoring",{event:e}),!0;var a,o,s;return ve()&&((a=i).firstChild&&(null===(o=window.UXAnalytics)||void 0===o||null===(s=o.Encryption)||void 0===s?void 0:s.shouldEncrypt(a.firstChild)))?(null==r||r.trace("Autocapture -- event target is encrypted, ignoring",{event:e}),!0):!!tl(i,(function(e){return xu.some((function(t){return e.hasAttribute(t)}))}))&&(null==r||r.trace("Autocapture -- event is under an ignored attribute element, ignoring",{event:e}),!0)},vd=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger;if(!dd(e,r)){var a=ad.getInstance();if(a.hasMatchingEvent(e)){var o;null==i||null===(o=i.trace)||void 0===o||o.call(i,"".concat(e.type," event has already been seen, ignoring"),{event:e,clickEventHistory:a.eventHistory})}else{a.addEvent(e);var s,u=fd(e);if(r)return null===(s=qs.getInstance().coreAPIs)||void 0===s?void 0:s.track(e.type,u);u.hierarchy||u.nodes&&0!==u.nodes.length?(null===(n=qs.getInstance().coreAPIs)||void 0===n||n.logger.trace("Autocapture -- queuing event",{event:e,props:u}),function(e){var t;null===(t=qs.getInstance().coreAPIs)||void 0===t||t.track("heap_autotrack",e,{name:"autotrack"})}(u)):null==i||i.debug("Autocapture -- discarding event, missing hierarchy",{event:e,props:u})}}},hd=function(e){vd(e,!0)};function pd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pd(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var md,yd={addAdapter:function(e,t){!function(e){return!!e&&!(!U(e.name)||!V(e.fn))}(e)?O.warn("addAdapter called with an invalid adapter",{adapter:e}):!t||z(t)?(O.trace("Adding adapter to registry",{adapter:e,config:t}),au.getInstance().registerAdapter(e,t)):O.warn("addAdapter called with an invalid configuration",{config:t})},markAdapterAsResolved:function(e){e&&U(e)?au.getInstance().markAdapterAsResolved(e):O.warn("markAdapterAsResolved called with an invalid adapterName",{adapterName:e})},addTransformer:function(e,t){!function(e){return!!e&&!!(U(e.name)&&V(e.getTarget)&&V(e.transform)&&V(e.transformFn))}(e)?O.warn("addTransformer called with an invalid transformer",{transformer:e}):!t||[du.GENERAL,du.METADATA].includes(t)?(O.trace("Adding transformer to registry",{transformer:e,pipelineName:t}),dc.getInstance().registerTransformer(e,t)):O.warn("addTransformer called with an invalid pipeline, can only be general or metadata",{pipelineName:t})},addTransformerFn:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:du.GENERAL,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&t&&U(e)&&V(t)?!n||[du.GENERAL,du.METADATA].includes(n)?(O.trace("Adding transformer function to registry",{name:e,transformerFn:t,pipelineName:n}),r?dc.getInstance().registerTransformerFnAsync(e,t,n):dc.getInstance().registerTransformerFn(e,t,n)):O.warn("addTransformerFn called with an invalid pipeline, can only be general or metadata",{pipelineName:n}):O.warn("Transformer function must have a valid name and a function",{name:e,transformerFn:t})},removeTransformer:function(e){e&&U(e)?dc.getInstance().removeTransformer(e):O.warn("removeTransformer called with an invalid transformer name",{transformerName:e})},resetTransformers:function(){dc.getInstance().resetTransformers()},addNetworkClient:function(e){}},wd=gd(gd({appid:"",loaded:!1,config:{}},yd),{},{init:function(e,t,n){try{if(wd.loaded)return void O.debug("heap.init was called multiple times. duplicate calls will have no effect");var r=(new Date).getTime(),i=O.getLogLevelFromStorage(e);if(i?O.setLogLevel(i):null!=t&&t.logLevel&&O.setLogLevel(t.logLevel),O.trace("Initializing heap"),!e||!U(e))return void O.error("heap.init was called with an invalid environment ID: ".concat(e));var a=ri.getInstance();a.setConfig(a.resolveConfig(t,n));var o=Zl.getInstance();if(o.setEnvironmentId(e),!o.canAccessStorage())return void O.warn("No storage access - exiting initialization");var s=mu.getInstance();if(s.executeStopTrackingAndStopRecording(),ri.getInstance().getShouldStopTracking())return void O.warn("Heap has been disabled for this client, preventing initialization");if(Bf())return void O.debug("Terminating heap initialization");wd.loaded=!0,wd.appid=e,wd.config=a.getConfig(),function(){O.trace("Initializing Network");var e,t=ri.getInstance().getIngestServer(),n=new gf((e=t).startsWith("http://")||e.startsWith("https://")?e:"https://".concat(e));new Er({client:n})}(),jl(),Oe(),function(){var e=Zl.getInstance(),t=e.getEnvironmentId(),n=ri.getInstance().getMetadataStorageType()===I.COOKIES?I.LOCAL_STORAGE:I.COOKIES,r=new Zl(t,n),i=e.getMetadata(),a=r.getMetadata(),o=i.lastEventTime,s=a.lastEventTime;o&&s?s>o&&e.setMetadata(a):s&&e.setMetadata(a),r.deletePersistentMetadata()}(),u=Ar.getInstance(),c=ri.getInstance().getEventPropertiesStorageType()===I.COOKIES?I.LOCAL_STORAGE:I.COOKIES,l=new Ar(c),f=u.getProperties(),d=xf(xf({},l.getProperties()),f),u.addProperties(d),l.clearProperties(!1),s.executeHeapApiQueue(),o.setMetadataStateFromCrossDomainContextIfPresent(),o.setMetadataStateFromWebviewIfPresent(),o.createNewUserIfNeeded({overrideProps:{time:r}}),o.createNewSessionIfNeeded({time:r}),o.createNewPageviewIfNeeded({time:r}),au.getInstance().initializeAdapters({getSnapshotProperties:kl,getSnapshotDefinitions:bl,track:wd.track,logger:O,getConfig:wd.getConfig,getSessionMetadata:Sf,createNewSessionIfNeeded:kf,createNewPageview:If,flushQueueOnUnload:Ef,flushEventQueue:_f,addTransformerFn:yd.addTransformerFn,addPageviewProperties:Of,setReferrer:Af,updateLastEventTime:Tf,onReady:wd.onReady,queueCustomEvent:hd}),O.debug("Heap initialization is complete"),Nf()}catch(e){wd.loaded=!1,O.error("Failed to initialize heap",e)}var u,c,l,f,d},startRecording:function(e,t){},stopRecording:function(){},stopTracking:function(e){O.debug("heap.stopTracking was called"),wd.loaded=!1,ri.getInstance().setShouldStopTracking(!0),n.g.clearInterval(Pl),e&&(O.debug("heap.stopTracking -- clearing state"),Zl.getInstance().clearMetadata(),Ar.getInstance().clearProperties(),gr.deleteQueue(),wr.deleteQueue(),Ae.deleteV4Cookies())},track:function(e,t,n){if(ff(e,t,n)){var r=R(),i=U(n)?{name:n,version:"0.0.0",platform:"web"}:n;!function(e){e&&e.length&&(O.debug("".concat(Gl.EVENT_PROCESSING_QUEUE," - enqueueing messages from adapters to EPQ"),e),$l.getInstance().enqueueMessages(e))}([{id:r,type:k.CORE_TRACK,info:{event:e,properties:t,source:i,isAutotrack:lf(e,i)},data:{id:r,time:(new Date).getTime()}}])}else O.debug("heap.track was called with bad arguments.",{event:e,properties:t,sourceInfo:n})},trackPageview:function(e){if(wd.loaded){var t=Zl.getInstance();Rl();var n=function(e){if(e){var t,n,r,i,a;e.url&&U(e.url)&&(t=Df(e.url)),e.properties&&(n=X(e.properties)),e.source_properties&&(r=X(e.source_properties)),e.previous_page&&U(e.previous_page)&&(i=e.previous_page),e.title&&(a=W(e.title,x)),void 0!==e.disableTextCapture&&ri.getInstance().setDisableTextCapture(e.disableTextCapture);var o=$({title:a,url:t,source_properties:r,properties:n,previous_page:i});return O.info("Validating pageview properties -- ",{before:e,after:o}),o}}(e);t.createNewUserIfNeeded({overrideProps:{pageviewInfo:n,time:(new Date).getTime()}}),t.createNewSessionIfNeeded({pageviewInfo:n,time:(new Date).getTime()}),If({pageviewInfo:n,time:(new Date).getTime()})}else mf("trackPageview",(function(){wd.trackPageview(e)}))},identify:function(e){if(!yu()){if(!uf(e))return O.warn("heap.identify was called with a bad identity",{identity:e}),void Er.getInstance().recordData("Obviously wrong identify call made",e);if(O.debug("heap.identify was called with",{identity:e}),wd.loaded){var t=Zl.getInstance(),n=t.getIdentity(),r=W("".concat(e),x);n!==r&&n?(Er.getInstance().recordData("resetIdentityTelemetry - identified user"),Rl(),O.trace("Clearing current identity ".concat(n," and creating a new user")),t.clearMetadata(),t.createNewUserIfNeeded({identity:r,overrideProps:{time:(new Date).getTime()}})):(t.createNewSessionIfNeeded({time:(new Date).getTime()}),_u.getInstance().queueIdentityEvent(r))}else yf("identify",(function(){wd.identify(e)}))}},identifyHashed:(md=t(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uf(t)){e.next=3;break}return O.warn("heap.identifyHashed was called with a bad identity",{identity:t}),e.abrupt("return");case 3:return e.prev=3,e.next=6,cf(t);case 6:n=e.sent,wd.identify(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),O.error("heap.identifyHashed -- error hashing identity",{e:e.t0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])}))),function(e){return md.apply(this,arguments)}),resetIdentity:function(){if(!yu())if(wd.loaded){var e=Zl.getInstance(),t=e.getIdentity();if(!t)return O.debug("heap.resetIdentity called on an anonymous user - no action"),void Er.getInstance().recordData("resetIdentityTelemetry - anonymous user");Er.getInstance().recordData("resetIdentityTelemetry - identified user"),Rl(),O.trace("Clearing current identity ".concat(t," and creating a new user")),e.clearMetadata(),e.createNewUserIfNeeded({overrideProps:{time:(new Date).getTime()}})}else yf("resetIdentity",(function(){wd.resetIdentity()}))},addUserProperties:function(e){if(function(e){return!(!z(e)||0===Object.keys(e).length)}(e)){var t=Zl.getInstance().getUserId();wd.loaded&&t?Dl(e):Fu.getInstance().queueAddUserPropertiesEvent(e)}else O.warn("heap.addUserProperties was called with bad properties: ".concat(e))},addEventProperties:function(e){if(z(e))if(wd.loaded){var t=X(e);Ar.getInstance().addProperties(t)}else mf("addEventProperties",(function(){wd.addEventProperties(e)}));else O.warn("heap.addEventProperties was called with bad properties: ".concat(e))},removeEventProperty:function(e){U(e)?wd.loaded?Ar.getInstance().removeEventProperty(e):mf("removeEventProperty",(function(){wd.removeEventProperty(e)})):O.warn("heap.removeEventProperty was called with a bad value: ".concat(e))},clearEventProperties:function(){wd.loaded?Ar.getInstance().clearProperties():mf("clearEventProperties",(function(){wd.clearEventProperties()}))},addPageviewProperties:function(e){if(z(e))if(wd.loaded){var t=Zl.getInstance(),n=X(e);n&&t.addCustomPageviewProperties(n)}else mf("addPageviewProperties",(function(){wd.addPageviewProperties(e)}));else O.warn("heap.addPageviewProperties was called with bad properties: ".concat(e))},removePageviewProperty:function(e){U(e)?wd.loaded?Zl.getInstance().removeCustomPageviewProperty(e):mf("removePageviewProperty",(function(){wd.removePageviewProperty(e)})):O.warn("heap.removePageviewProperty was called with a bad value: ".concat(e))},clearPageviewProperties:function(){wd.loaded?Zl.getInstance().clearCustomPageviewProperties():mf("clearPageviewProperties",(function(){wd.clearPageviewProperties()}))},getPageviewMetadata:function(e){var t=Zl.getInstance().getPageviewMetadata();return e&&e(t),t},getSessionId:function(e){var t=Zl.getInstance();if(t.hasSessionExpired())return O.debug("heap.getSessionId - session has expired"),e&&e(null),null;if(t.getHasSessionBeenQueued()){var r=t.getSessionId();return e&&e(r),r}if(O.debug("heap.getSessionId - session has not been instantiated"),e){var i=n.g.setInterval((function(){if(O.trace("heap.getSessionId - checking if session has been created"),t.getHasSessionBeenQueued()){n.g.clearInterval(i);var r=t.getSessionId();e(r)}}),200);n.g.setTimeout((function(){n.g.clearInterval(i)}),3e3)}return null},getUserId:function(e){var t=Zl.getInstance();if(t.getHasUserBeenQueued()){var r=t.getUserId();return e&&e(r),r}if(O.debug("heap.getUserId - user has not been instantiated"),e){var i=n.g.setInterval((function(){if(O.trace("heap.getUserId - checking if user has been created"),t.getHasUserBeenQueued()){n.g.clearInterval(i);var r=t.getUserId();e(r)}}),200);n.g.setTimeout((function(){n.g.clearInterval(i)}),3e3)}return null},getIdentity:function(e){var t=Zl.getInstance().getIdentity()||null;return e&&e(t),t},getConfig:function(){return ri.getInstance().getConfig()},setLogLevel:function(e){Object.values(b).includes(e)&&O.setLogLevel(e,wd.appid)},onReady:function(e){mu.getInstance().getOnReadyQueueHasBeenFlushed()?(O.debug("heap.onReady -- heap is already loaded, executing function",{callback:e}),e()):yf("onReady",e)},getReplayId:function(){return function(){if(!window.auryc)return"Auryc object is not present in this window";var e=window.auryc.getSessionMetadata(),t=e.replayUrl,n=e.siteId,r=e.sessionId,i=e.sampled,a=e.isOver;return i&&!a?{aurycParams:encodeURIComponent("".concat(n,"/").concat(r,"/").concat((new Date).getTime())),replayUrl:t}:"Session Replay is not active or is over for this session."}()},setPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe.UserSession;if(U(e)&&Object.values(pe).includes(t))if(wd.loaded){O.debug("heap.setPath was called with ",{path:e,lifespan:t});var n=Df(e);if(n&&n.path)Zl.getInstance().setMetadata({setPath:{path:null==n?void 0:n.path,query:null==n?void 0:n.query,hash:null==n?void 0:n.hash,lifespan:t}})}else mf("setPath",(function(){wd.setPath(e,t)}));else O.warn("heap.setPath was called with a bad value:",{path:e,lifespan:t})}}),bd=function(e){var t,n,r=((null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.getConfig().disableInteractionEvents)||[]).includes(e);r&&(null===(n=qs.getInstance().coreAPIs)||void 0===n||n.logger.info("Autocapture -- ".concat(e," capture has been disabled")));return r},_d="change",kd=function(){return navigator.appVersion},Id=function(){return kd().indexOf("Safari")>-1},Sd=function(){var e=navigator.userAgent,t=e.match(/iPad/i)||e.match(/iPhone/i),n=e.match(/WebKit/i);return t&&n&&!e.match(/CriOS/i)},Ed=function(e){var t=e.tagName.toLowerCase(),n=Hc(e.type)?e.type.toLowerCase():e.type;return null!==rl(e)&&("input"===t&&["submit","image"].includes(n)||"button"===t&&!["reset","button"].includes(n))},Td=function(e){return Od(e)?e.animVal:e},Od=function(e){return"string"==typeof e.animVal},Ad=function(e,t){return e.hasAttribute?e.hasAttribute(t):function(e,t){var n=e.getAttributeNode(t);return!(!n||!n.specified&&!n.nodeValue)}(e,t)},Pd=function(e){if(!e||!e.href)return!1;if(function(e){return Ad(e,"data-turbo-frame")||Ad(e,"data-heap-turbo")}(e))return!1;var t=Td(e.href),n=Ad(e,"download"),r=new RegExp("^\\s*("+window.location.href.split(window.location.hash||"#")[0].replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")+")?#").test(t),i=/^\s*javascript:/.test(t),a=/^\s*(mailto|tel):/.test(t)&&Id(),o="ar"===e.rel&&/\.usdz/i.test(t)&&Id();return!(e.isContentEditable||n||r||i||a||o)},Nd=function(e,t){window.addEventListener(e.type,(function n(r){window.removeEventListener(r.type,n),r!==e||r.defaultPrevented||t(r)}))},Rd=function(e,t){var r,i;null===(r=qs.getInstance().coreAPIs)||void 0===r||r.logger.debug("Autocapture -- flushing queue before leaving page",{event:e});var a,o,s=(a=t,o=!1,function(){if(!o){o=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.apply(void 0,t)}});!function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(e),n.g.setTimeout(s,300),null===(i=qs.getInstance().coreAPIs)||void 0===i||i.flushQueueOnUnload()},Cd=function(){function e(){u(this,e),this.clickedSubmitEventElements=[]}return l(e,[{key:"addEvent",value:function(e){this.clickedSubmitEventElements.push(e)}},{key:"getEvents",value:function(){return this.clickedSubmitEventElements}},{key:"clearEvents",value:function(){this.clickedSubmitEventElements=[]}},{key:"findLast",value:function(e){for(var t=this.clickedSubmitEventElements.length-1;t>=0;t--){var n=this.clickedSubmitEventElements[t];if(e(n))return n}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),xd=function(e){var t,n,r,i=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger;if(e&&e.href){var a=new URL(document.location.href),o=new URL(e.href);if(a.hostname!==o.hostname){var s=function(e){var t;return((null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.getConfig().supportedDomains)||[]).some((function(t){var n=e.hostname.split("."),r=t.split(".");return n.slice(-r.length).join(".")===t}))}(o);if(s){null===(n=qs.getInstance().coreAPIs)||void 0===n||n.createNewSessionIfNeeded();var u=null===(r=qs.getInstance().coreAPIs)||void 0===r?void 0:r.getSessionMetadata();if(u){var c=u.envId,l=u.userId,f=u.sessionId,d=u.identity,v=u.sessionProperties.time,h="".concat(c,";").concat(l,";").concat(f,";").concat(null!=v?v:"",";").concat(null!=d?d:""),p=new URL(e.href);p.searchParams.set("_hp5_cdc",h),e.href=p.toString()}else null==i||i.error("decorateLink -- Unable to receive metadata from core API dependencies on decorator")}else null==i||i.trace("decorateLink -- Redirecting to unsupported domain, no need to decorate")}else null==i||i.trace("decorateLink -- Redirecting to the same domain, no need to decorate")}},Dd="click",jd=function(e){var t,n,r,i=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger;if(null==i||i.trace("Autocapture -- click event",{event:e}),"click"===e.type){var a=Cd.getInstance();if(vd(e),r=1&(n=e).button?1:0,1===(n.which||void 0===n.button?n.which:r)){var o=qc(e),s=tl(o,Ed),u=null!==s,c="__impl4cf1e782hg__"in e&&void 0!==e.__impl4cf1e782hg__;u?(a.addEvent([e,s]),null==i||i.trace("Autocapture -- clicked event is form submit click",{event:e,clickedSubmitEventElements:a.getEvents()})):!c&&function(e){return!(e.metaKey||e.shiftKey||e.ctrlKey||e.altKey)}(e)&&Nd(e,(function(){null==i||i.trace("Autocapture -- event fully propagated");var t=function(e){for(;e&&(void 0===e.tagName||"a"!==e.tagName.toLowerCase()||!e.href);)e=e.parentNode;return e}(o);try{xd(t)}catch(e){null==i||i.trace("Autocapture CDT -- Failed to decorate link for CDT, continuing",{error:e})}if(Pd(t)){var n=Td(t.href),r=t.target||(document.getElementsByTagName("base")[0]||{}).target;null==i||i.trace("Autocapture -- should intercept href",{target:r}),r&&"_self"!==Td(r).toLowerCase()?r.match(/^_(parent|top)$/i)&&Rd(e,(function(){window.open(n,r)})):Rd(e,(function(){document.location.href=n}))}}))}}},Bd="submit",Md=function(e){var t,i=null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.logger,a=e||window.event;if(null==i||i.trace("Autocapture -- submit event",{event:a}),vd(a),o=kd(),s=null,o&&(o.indexOf("MSIE 6.")>-1?s=6:o.indexOf("MSIE 7.")>-1?s=7:o.indexOf("MSIE 8.")>-1?s=8:o.indexOf("MSIE 9.")>-1&&(s=9)),!s){var o,s,u,c,l=a.target,f=Cd.getInstance(),d=f.findLast((function(e){var t=e[1];return rl(t)===l}));f.clearEvents(),d&&(u=d[0],c=d[1]),Nd(a,(function(){var e,t=(e=c)?["formAction","formEnctype","formMethod","formNoValidate","formTarget","name","type","value"].reduce((function(t,n){return Ad(e,n)&&(t[n]=e[n]),t}),{}):{},o=(c||{}).tagName;"_blank"!==(null==l?void 0:l.target)&&Rd(a,(function(){try{var e,a,s,f={};try{var d=(Array.from(l.querySelectorAll("input"))||[]).filter((function(e){if(!e.inputmask)return!1;var t=e.inputmask._valueSet&&e.inputmask._valueGet&&e.inputmask.unmaskedvalue,n=e.inputmask.userOptions&&e.inputmask.userOptions.removeMaskOnSubmit||e.inputmask.opts&&e.inputmask.opts.removeMaskOnSubmit;return t&&n})),v=d.map((function(e){return e.inputmask._valueGet()}));d.forEach((function(e){e.inputmask._valueSet(e.inputmask.unmaskedvalue())})),n.g.setTimeout((function(){d.forEach((function(e,t){e.inputmask._valueSet(v[t])}))}),0)}catch(e){null==i||i.error("Autocapture -- Error extracting values from form submission",{event:e})}if(c){var h=t.type,p=Hc(h)?h.toLowerCase():h;if("input"===o.toLowerCase()&&"image"===p){var g=t.name,m=function(e){var t=e,n=t.target||t.srcElement;if(0===t.screenX&&0===t.screenY||!n)return[0,0];var r=n instanceof Element&&n.getBoundingClientRect();if(!r)return[0,0];var i=Math.floor(t.clientX-r.left),a=Math.floor(t.clientY-r.top),o=!(void 0===t.offsetX&&void 0===t.offsetY||0===t.offsetX&&0===t.offsetY);return[o?t.offsetX:i,o?t.offsetY:a]}(u);(a=document.createElement("input")).type="hidden",a.name=g?g+".x":"x",a.value=m[0].toString(),(s=document.createElement("input")).type="hidden",s.name=g?g+".y":"y",s.value=m[1].toString(),l.appendChild(a),l.appendChild(s)}else{(e=document.createElement("input")).type="hidden","name"in t&&(e.name=t.name);var y=t.value;null!=y&&""!==y&&(e.value=t.value),l.appendChild(e)}["action","enctype","method","noValidate","target"].forEach((function(e){var n,r="form"+(0===(n=e).length?n:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase());r in t&&(f[e]=l[e],l[e]=t[r])}))}if("dialog"===l.method)try{var w=tl(l,(function(e){return"dialog"===e.tagName.toLowerCase()})),b=u.target,_=u.target&&b.value;w&&w.close&&_&&w.close(_)}catch(e){null==i||i.warn("Failed to close dialog for a form submission with method=dialog")}var k=document.createElement("form");document.body.appendChild(k),k.submit.apply(l),document.body.removeChild(k),function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(n&&"object"===r(n))for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}}(l,f),e&&l.removeChild(e),a&&s&&(l.removeChild(a),l.removeChild(s))}catch(e){null==i||i.error("Autocapture -- Error preventing form submission",{event:e})}}))}))}},Ud=function(e){var t;if(e&&e.querySelectorAll){var n=(null===(t=qs.getInstance().coreAPIs)||void 0===t?void 0:t.flushQueueOnUnload)||function(){};e.querySelectorAll("a").forEach((function(e){e.addEventListener("click",n)})),e.querySelectorAll("form").forEach((function(e){e.addEventListener("submit",n)})),e.querySelectorAll("[onClick]").forEach((function(e){e.addEventListener("click",n)}))}};function Ld(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ld(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ld(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zd=function(){return window.location.pathname+window.location.hash+window.location.search},qd=zd(),Vd=function(){var e,t=qs.getInstance(),r=null===(e=t.coreAPIs)||void 0===e?void 0:e.logger,i=zd();if(qd!==i){var a;null==r||r.trace("recordPageview -- current path differs from last path",{lastPageviewPath:qd,currentPageviewPath:i}),null===(a=t.coreAPIs)||void 0===a||a.flushEventQueue();var o=qd;qd=i;var s=o&&Su(o),u=Fd({url:Ur()},s&&{previous_page:s});n.g.setTimeout((function(){var e;null===(e=t.coreAPIs)||void 0===e||e.createNewPageview({pageviewInfo:u,time:(new Date).getTime()})}),0)}},Hd=function(e){if(e.persisted){var t,r,i=(new S).getItem("previousPage"),a=qs.getInstance();null===(t=a.coreAPIs)||void 0===t||null===(r=t.logger)||void 0===r||r.trace("recordPageview -- recording pageview from bfCache");var o=Fd({url:Ur()},i&&{previous_page:i});n.g.setTimeout((function(){var e;null===(e=a.coreAPIs)||void 0===e||e.createNewPageview({pageviewInfo:o,time:(new Date).getTime()})}),0)}},Jd=function(e){if(e.persisted){var t,n,r;null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.trace("handleBfCache -- user clicked back/forward, storing previous page value",{event:e});var i=new S,a=Zl.getInstance().getPageviewProperties();null!=a&&null!==(r=a.url)&&void 0!==r&&r.path&&i.setItem("previousPage",a.url.path)}},Kd=function(){var e;(null===(e=qs.getInstance().coreAPIs)||void 0===e?void 0:e.getConfig().disablePageviewAutocapture)||(!function(){if(history.heappushstate=history.heapreplacestate=Vd,"pushState"in window.history){var e=function(e,t,n){var r=e[t];e[t]=function(){var t=r.apply(e,arguments);return V(e[n])&&e[n](),t}};e(window.history,"pushState","heappushstate"),e(window.history,"replaceState","heapreplacestate")}}(),window.addEventListener("popstate",Vd,!0),window.addEventListener("hashchange",Vd,!0),window.addEventListener("pageshow",Hd,!0),window.addEventListener("pagehide",Jd,!0))},Qd=function(){var e,t=null===(e=qs.getInstance().coreAPIs)||void 0===e?void 0:e.getConfig();return((null==t?void 0:t.customEvents)||[]).filter((function(e){return e&&!["click","change","submit"].includes(e)}))};function Zd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Gd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gd(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Gd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Yd,Wd,Xd=function e(t){var n=[];if(t.shadowRoot){n.push(t.shadowRoot);var r,i=Zd(t.shadowRoot.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;n=n.concat(e(a))}}catch(e){i.e(e)}finally{i.f()}}var o,s=Zd(t.children);try{for(s.s();!(o=s.n()).done;){var u=o.value;n=n.concat(e(u))}}catch(e){s.e(e)}finally{s.f()}return n},$d=function(e){try{if(!e)return!0;for(var t=e;t;){if("BODY"===t.tagName||"HTML"===t.tagName)return!1;if(Vc(t.parentNode)){if("open"!==t.parentNode.mode)return!0;t=t.parentNode.host}else t=t.parentElement}return!0}catch(e){var n,r;return null===(n=qs.getInstance().coreAPIs)||void 0===n||null===(r=n.logger)||void 0===r||r.error("Failed to determine closed context, defaulting to no capture"),!0}},ev=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=bd("change"),i=bd("submit"),a=bd("click"),o=Xd(document.body).filter((function(e){return!n.includes(e)}));null===(e=qs.getInstance().coreAPIs)||void 0===e||null===(t=e.logger)||void 0===t||t.trace("attaching event listeners on shadow roots",{openShadowRoots:o});var s=Qd();return o.forEach((function(e){try{r||e.addEventListener("change",vd,!0),i||e.addEventListener("submit",Md,!0),a||e.addEventListener("click",jd,!0),s.forEach((function(t){e.addEventListener(t,hd,!0)}))}catch(e){var t,n;null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.error("Shadow DOM error attaching event listeners",{e:e})}})),o},tv=function(){var e,t=bd("change"),n=bd("submit"),r=bd("click"),i=Qd(),a=function(){var e=Element.prototype.attachShadow;Element.prototype.attachShadow=function(){for(var a=this,o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];var c=e.apply(this,s);if(this.shadowRoot&&"open"===this.shadowRoot.mode){var l=function(e){var t,n;$d(e.target)?null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.trace("Shadow DOM is in an closed context, nooping custom ".concat(e.type," event listener")):hd(e)};try{t||this.shadowRoot.addEventListener("change",(function(e){var t,n;$d(e.target)?null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.trace("Shadow DOM is in an closed context, nooping change event listener"):vd(e)}),!0),n||this.shadowRoot.addEventListener("submit",(function(e){var t,n;$d(e.target)?null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.trace("Shadow DOM is in an closed context, nooping submit event listener"):Md(e)}),!0),r||this.shadowRoot.addEventListener("click",(function(e){var t,n;$d(e.target)?null===(t=qs.getInstance().coreAPIs)||void 0===t||null===(n=t.logger)||void 0===n||n.trace("Shadow DOM is in an closed context, nooping click event listener"):jd(e)}),!0),i.forEach((function(e){a.shadowRoot.addEventListener(e,l,!0)}))}catch(e){var f,d;null===(f=qs.getInstance().coreAPIs)||void 0===f||null===(d=f.logger)||void 0===d||d.error("Shadow DOM error attaching event listeners",{e:e})}}return c}};if(null===(e=qs.getInstance().coreAPIs)||void 0===e?void 0:e.getConfig().salesforceAura){var o=[],s=!1,u=function(){var e=ev(o);o=[].concat(w(o),w(e))},c=window.setInterval((function(){var e,t;Element.prototype.attachShadow.toString().includes("[native code]")||(null===(e=qs.getInstance().coreAPIs)||void 0===e||null===(t=e.logger)||void 0===t||t.trace("SFAura -- attachShadow overwritten for SFAura, overriding with heap handlers"),window.clearInterval(l),window.clearInterval(c),u(),a(),s=!0)}),200),l=window.setInterval(u,400);window.setTimeout((function(){var e,t,n,r;(window.clearInterval(l),window.clearInterval(c),s)?null===(e=qs.getInstance().coreAPIs)||void 0===e||null===(t=e.logger)||void 0===t||t.trace("SFAura -- 7 seconds passed but handler has been attached, nooping"):(null===(n=qs.getInstance().coreAPIs)||void 0===n||null===(r=n.logger)||void 0===r||r.trace("SFAura -- 7 seconds passed, clearing interval and attaching heap handler"),u(),a())}),7e3)}else ev(),a()},nv=function(){if(window.auryc&&!window._uxa){var e,t=(new Date).getTime();null===(e=qs.getInstance().coreAPIs)||void 0===e||e.updateLastEventTime(t)}},rv=function(e){var t=qs.getInstance();t.setAPIDependencies(e),bd(_d)||window.addEventListener(_d,vd,!0),bd(Dd)||window.addEventListener(Dd,jd,!0),bd(Bd)||window.addEventListener(Bd,Md,!0),function(){if(Sd()){var e,t=(null===(e=qs.getInstance().coreAPIs)||void 0===e?void 0:e.flushQueueOnUnload)||function(){};addEventListener("blur",t,!0),addEventListener("pagehide",t,!0),Ud(document),new MutationObserver((function(e){return e.filter((function(e){return"childList"===e.type})).forEach((function(e){e.addedNodes.forEach((function(e){Ud(e)}))}))})).observe(document,{childList:!0,subtree:!0})}}(),Kd(),Qd().forEach((function(e){window.addEventListener(e,hd,!0)}));try{tv()}catch(e){var n,r;null===(n=t.coreAPIs)||void 0===n||null===(r=n.logger)||void 0===r||r.trace("Autocapture -- error adding shadowdom handler",{e:e})}["mousemove","mouseup","mousedown","keydown","keypress","keyup","mouseenter","scroll","resize","dblclick","touchstart","touchmove","touchend","touchcancel","pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave"].forEach((function(e){try{window.addEventListener(e,df(nv,3e4),!0)}catch(n){var t;null===(t=qs.getInstance().coreAPIs)||void 0===t||t.logger.warn("Autocapture -- Adding session replay event listener failed for ".concat(e))}}))},iv=["onReady","identify","addUserProperties"];null!==(Yd=window)&&void 0!==Yd&&null!==(Wd=Yd.heap)&&void 0!==Wd&&Wd.appid||(window.heap=wd,window.heap.addAdapter({name:"autocapture",fn:rv},{isBlocking:!1}),function(){var e=window.heapReadyCb;if(e){var t=e.find((function(e){return"init"===e.name}));if(t&&e.splice(e.indexOf(t),1),e.length>0){var n=mu.getInstance();e.forEach((function(e){iv.includes(e.name)?n.enqueueOnReady(e):n.enqueueHeapApi(e)})),window.heapReadyCb=[]}t&&t.fn()}}())}()}();